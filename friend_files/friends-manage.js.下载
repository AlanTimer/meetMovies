define("friends/log",function(require,e){e.logRcd=function(e){var t=[];t.push(nx.user.id),t.push(e.actionTag),t.push(e.getUserId||"default"),t.push(e.targetTag||"default"),t.push(e.targetIds||"default"),t.push(e.sourceTag||"default"),t.push(e.algorithms||"default")}}),define("friends/util",function(require,e){function t(e){e=e||"服务器异常，请稍后再试!",s("<div>"+e+"</div>").dialog({buttons:{"确定":function(e){e.stopPropagation(),s(this).dialog("destroy")}}})}function n(i){return i.length<1?(t("分组名不能为空."),!1):i.length>10?(t("分组名不能超过10个字."),!1):i===e.conf.nogroup||i===e.conf.all||i===e.conf.special||i===e.conf.latest||"null"==i.toLowerCase()?(t("分组名不合法."),!1):/^[0-9a-zA-Z\u4e00-\u9fa5]*$/i.test(i)?!0:(t("分组名中不能包含特殊符号，请修改后重试~"),!1)}function a(i){return i===e.conf.defaultSpecialDesc?!1:i.length>30?(t("描述信息最多只能为30个字!"),!1):/['"<>\/\\]/.test(i)?(t("请不要输入特殊字符!"),!1):!0}var s=require("jquery");require("ui/dialog"),e.checkGroupName=function(e){return n(e)},e.checkSpecialDesc=function(e){return a(e)},e.showMsg=function(e){t(e)},e.alert=function(e){e=e||"服务器异常，请稍后再试!";var t=s("<div>"+e+"</div>").dialog({}).dialog({dialogClass:"alert"});s(t).fadeOut(2e3),setTimeout(function(){s(t).dialog("destroy")},1e3)},e.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},e.substring=function(e,t,i,n){var a=nx.stringplus.TSubString;return a(e,t,i,n)},e.encode=function(e){return encodeURIComponent(e)},e.dialog=function(e){var t,i,n={};for(i in e)e.hasOwnProperty(i)&&"success"!==i&&"error"!==i&&"body"!==i&&(n[i]=e[i]);return n.buttons={"确定":function(t){t.stopPropagation(),e.success()},"取消":function(t){t.stopPropagation(),e.error(),s(this).dialog("destroy")}},t=s(e.body).dialog(n)},e.conf={all:"全部好友",nogroup:"未分组好友",latest:"最近添加好友",special:"特别好友",add:"添加组员",del:"删除组员",shift:"转移组员",packet:"添加至分组",sameGname:"相同的分组名",defaultSpecialDesc:"添加特别好友描述",deleteSpecial:"为谨慎起见，您每次只能删除一个特别好友，特别关系来之不易，请珍惜！",scrollLen:6,selectedLen:155,includeSlidebar:!1,includeWebpager:!1},e.dataSource={conf:{editing:!1,selected:[],curGroup:e.conf.all,search:!1,list:!1,np:1,ps:24},set:function(e,t){this.conf[e]=t},get:function(e){return this.conf[e]},isEdit:function(){return this.conf.editing===!0},reset:function(){this.conf.editing=!1,this.conf.search=!1}},e.isSupportEvent=function(e,t){var i=document.createElement(e||"div");t="on"+t;var n=t in i;return n||(i.setAttribute(t,"return;"),n="function"==typeof i[t]),i=null,n},e.getParamByUrl=function(e){paramValue="",isFound=!1;try{if(0==window.location.search.indexOf("?")&&window.location.search.indexOf("=")>1)for(arrSource=unescape(window.location.search).substring(1,window.location.search.length).split("&"),i=0;i<arrSource.length&&!isFound;)arrSource[i].indexOf("=")>0&&arrSource[i].split("=")[0].toLowerCase()==e.toLowerCase()&&(paramValue=arrSource[i].split("=")[1],isFound=!0),i++}catch(t){}return paramValue},e.isSupportPlaceHolder=function(){return"placeholder"in document.createElement("input")}(),e.showDebugLog=function(t){1==e.getParamByUrl("bingo")&&console.log(t)}}),define("friends/ajax",function(require,e,t){var i,n=require("jquery"),a=require("friends/util"),i={addFriends:{userInfo:"http://friend.renren.com/friends/api/hostInfo/",recommend:"http://rcd.renren.com/cwf_nget_newsfeed",emptyRecommend:"http://rcd.renren.com/cwf_nget_newsfeed",add_friend_search:"http://friend.renren.com/friends/api/search/",removeRecommend:"http://rcd.renren.com/cwf_nremove_home",circle:"http://friend.renren.com/friends/api/tinyurl",univDepart:"http://www.renren.com/GetDep.do",commonFri:"http://friend.renren.com/friends/api/querycommanfriends",getCollege:"http://www.renren.com/autocomplete_college.jsp",getHighSchool:"http://www.renren.com/autocomplete_highschool.jsp",getJuniorSchool:"http://www.renren.com/autocomplete_juniorhighschool.jsp",getElementarySchool:"http://www.renren.com/autocomplete_elementaryschool.jsp"},manageFriends:{editGroup:"http://friend.renren.com/friends/api/editgroups",batchRemove:"http://friend.renren.com/friends/api/batchremove",batchJoin:"http://friend.renren.com/friends/api/batchaddgroups",recommendSelectorUrl:"http://friend.renren.com/recommendSelector.do",beforeDeleteFriend:"http://friend.renren.com/BeforeDeleteFriend.do",deleteFriend:"http://friend.renren.com/DelFriend.do",specialsRemove:"http://friend.renren.com/friends/api/deletespecialfriends",specialRank:"http://friend.renren.com/friends/api/rankspecialfriends",specialAdd:"http://friend.renren.com/friends/api/addspecialfriend",editSpecialDesc:"http://friend.renren.com/friends/api/addspecialfriendcomment",suggest:"http://friend.renren.com/friends/api/suggestaddgroup",suggestRecommend:"http://rcd.renren.com/cwf_nget_newsfeed",commonFri:"http://friend.renren.com/friends/api/querycommanfriends",manage_friend_search:"http://friend.renren.com/friends/api/searchgroupdata",smart:"http://friend.renren.com/friends/api/getintelligentwithrcdgroupssorted",createSmart:"http://friend.renren.com/friends/api/createintelligentgroups",createSingleSmart:"http://friend.renren.com/friends/api/createsingleintelligentgroupss"},taFriends:{getTaFriends:"http://friend.renren.com/friend/api/getotherfriendsdata",commonFri:"http://friend.renren.com/friends/api/querycommanfriends",ta_friend_search:"http://friend.renren.com/friends/api/otherfriendsearch"},contact:{getContact:"http://friend.renren.com/friends/api/getcontact"}},s={url:[i.manageFriends.beforeDeleteFriend,i.addFriends.add_friend_search,i.taFriends.getTaFriends],noErrorMsgUrl:[i.addFriends.recommend,i.manageFriends.suggestRecommend],ErrorNoShowUrl:[i.manageFriends.suggest]};e.fetch=function(e,t,i,o,r){n.ajax({type:"POST",data:t,dataType:r||"json",url:e,success:function(t){return-1===s.url.indexOf(e)&&t.code&&0!=t.code?(o&&o(t),void(-1==s.noErrorMsgUrl.indexOf(e)&&a.showMsg(t.msg))):void i(t)},error:function(t){-1==s.ErrorNoShowUrl.indexOf(e)&&a.alert("服务器异常，请稍后再试！")}})},e.addFriends={userInfo:function(t,n){e.fetch(i.addFriends.userInfo,"",t,n)},recommend:function(t,n,a){e.fetch(i.addFriends.recommend,t,n,a)},emptyRecommend:function(t,n,a){e.fetch(i.addFriends.emptyRecommend,t,n,a)},search:function(t,n,a){e.fetch(i.addFriends.add_friend_search,t,n,a)},circle:function(t,n,a){var s="p="+encodeURIComponent(t)+"&l=5";e.fetch(i.addFriends.circle,s,n,a)},removeRecommend:function(t,n,a,s){e.fetch(i.addFriends.removeRecommend,'p={"type":"'+n+'","guest":"'+t+'"}',a,s,"text")},commonFri:function(t,n,a){e.fetch(i.addFriends.commonFri,"p="+t,n,a)},getSchoolSuggest:function(t,n,a,s){switch(n){case"univ":e.fetch(i.addFriends.getCollege,"query="+t,a,s,"text");break;case"high":e.fetch(i.addFriends.getHighSchool,"query="+t,a,s,"text");break;case"junior":e.fetch(i.addFriends.getJuniorSchool,"query="+t,a,s,"text");break;case"elementary":e.fetch(i.addFriends.getElementarySchool,"query="+t,a,s,"text");break;default:return}},getDeptSuggest:function(t,n,a){e.fetch(i.addFriends.univDepart,"id="+t,n,a,"html")}},e.group={create:function(t,n){t=a.encode(t),e.fetch(i.manageFriends.editGroup,'p={"action":"create","name":"'+t+'"}',n)},rename:function(t,n,s){n=a.encode(n),t=a.encode(t),e.fetch(i.manageFriends.editGroup,'p={"action":"rename","name":"'+n+'","oldname":"'+t+'"}',s)},addMultGroups:function(t,n){gname=a.encode(gname),e.fetch(i.manageFriends.editGroup,'p={"action":"addmultgroups","names":'+JSON.stringify(n)+',"buddys":"'+t+'"}')},multiAdd:function(t,n,s){n=a.encode(n),e.fetch(i.manageFriends.editGroup,'p={"action":"multiadd","name":"'+n+'","buddys":['+t+"]}",s)},dismiss:function(t,n){t=a.encode(t),e.fetch(i.manageFriends.editGroup,'p={ "action" : "delete", "name" : "'+t+'" }',n)},batchJoin:function(t,n,a,s){e.fetch(i.manageFriends.batchJoin,'p={ "action" : "batchadd", "keep" : "'+(a?1:0)+'","ids":'+JSON.stringify(t)+',"groupsname":'+JSON.stringify(n)+" }",s)},batchRemove:function(t,n,s){n=a.encode(n),e.fetch(i.manageFriends.batchRemove,'p={ "action" : "batchremove", "ids":'+JSON.stringify(t)+',"groupname":"'+n+'" }',s)},beforeDeleteFriend:function(t,n){e.fetch(i.manageFriends.beforeDeleteFriend,"temp="+(new Date).getTime(),t,n)},deleteFriend:function(t,n,a,s,o){e.fetch(i.manageFriends.deleteFriend,"id="+t+"&code="+s+"&codeFlag="+a,o)},commonFri:function(t,n,a){e.fetch(i.manageFriends.commonFri,"p="+t,n,a)}},e.special={remove:function(t,n){e.fetch(i.manageFriends.specialsRemove,"p="+t,n)},saveRank:function(t,n){e.fetch(i.manageFriends.specialRank,"p="+JSON.stringify(t),n)},saveDesc:function(t,n,s){n=a.encode(n),e.fetch(i.manageFriends.editSpecialDesc,'p={"id":'+t+',"comment":"'+n+'"}',s)},edit:function(t,n,a){e.fetch(i.manageFriends.specialAdd,"p="+JSON.stringify(t),n,a)}},e.suggest={join:function(t,n,s){t=a.encode(t),e.fetch(i.manageFriends.suggest,"gname="+t,n,s)},get:function(t,n){e.fetch(i.manageFriends.suggestRecommend,"uid="+nx.user.id+"&limit=8&type=WEB_FRIEND&p=0",t,n)}},e.getContact={fetch:function(t,n){e.fetch(i.contact.getContact,"fid="+t,n)}},e.search=function(t,n,a){e.fetch(i.manageFriends.manage_friend_search,"p="+JSON.stringify(t),n,a)},e.smart={getData:function(t,n){e.fetch(i.manageFriends.smart,"p={t="+Math.random()+"}",t,n)},create:function(t,n,a){e.fetch(i.manageFriends.createSingleSmart,"p="+JSON.stringify(t),n,a)},createAll:function(t,n){e.fetch(i.manageFriends.createSmart,"p="+JSON.stringify(t),n)}},e.taFriends={getTaFriendsData:function(t,n,a){e.fetch(i.taFriends.getTaFriends,t,n,a)},searchTaFriends:function(t,n,a){e.fetch(i.taFriends.ta_friend_search,t,n,a)}}}),define("friends/template",function(require,e){var t,i,n,a,s=(require("jquery"),require("friends/util")),o=require("mustache.js");t={comTpl:'<li class="friend-detail" data-id="{{fid}}" data-type="normal" data-name="{{fname}}" id="friendsli{{fid}}" >			    <a class="tiny_photo userhead" href="http://www.renren.com/profile.do?id={{fid}}" target="_blank">			        <img src="{{url}}" data-list="{{list}}" data-tinyurl="{{tiny_url}}" data-largeurl="{{large_url}}" class="userheadimg large" onload="{{onload}}">			    </a>			    <ul class="friends-item-con">					<li class="username"><a class="name" href="http://www.renren.com/profile.do?id={{fid}}" target="_blank" title="{{fname}}">{{sfname}}</a></li>',normalTpl:'<li class="friends-loc-info">{{info}}</li>					<li class="friends-com-info" data-id="{{fid}}">{{comf}}个共同好友</li>				</ul>				<div class="friends-item-btn" data-id="{{fid}}">					<span class="group-name-list">{{fgroupNames}}</span>				</div>		    </li>',specialTpl:'<li class="special-desc "><a class="png special-desc-edit fl"></a><span class="special-desc-detail">{{sfdesc}}</span></li>                    <li class="special-desc-edit" data-id="{{fid}}" style="display:none;">                        <textarea class="special-desc-input" data-id="{{fid}}">{{sfdesc}}</textarea>                    </li>                </ul>                <div class="friends-item-btn special-item-btn" data-id="{{fid}}">                    <a class="special-up png fl"></a>                    <a class="special-down png fl"></a>                </div>            </li>',sTpl:'<li class="friend-detail" data-id="{{fid}}" data-type="normal" data-name="{{fname}}" id="friendsli{{fid}}" >                <a class="tiny_photo userhead" href="http://www.renren.com/profile.do?id={{fid}}" target="_blank">                    <img src="{{url}}" data-list="{{list}}" data-tinyurl="{{tiny_url}}" data-largeurl="{{large_url}}" class="userheadimg large" onload="{{onload}}">                </a>                <ul class="friends-item-con">                    <li class="username"><a class="name" href="http://www.renren.com/profile.do?id={{fid}}" target="_blank" title="{{fname}}">{{sfname}}</a></li>                    <li class="special-desc clearfix"><span class="special-desc-detail fl" >{{sfdesc}}</span><a class="png special-desc-edit fl"></a></li>                    <li class="special-desc-edit" data-id="{{fid}}" style="display:none;">                        <textarea id="f_desc" rows="2" cols="12" >{{sfdesc}}</textarea>                    </li>                </ul>                <div class="friends-item-btn special-item-btn" data-id="{{fid}}">                    <a class="special-up png fl"></a>                    <a class="special-down png f1"></a>                </div>            </li>',build:function(e,t,i){var n,a,s,o=[];for(a=0,s=e.length;s>a;a++)e[a]&&o.push(this.render(e[a],t,i));return n=o.join(""),o.length=0,n},render:function(e,t,i){var n=e,a=e.fgroups||[],o=[],r="";return n.sfname=s.substring(n.fname,5,"..."),t?(n.url=e.tiny_url,n.onload="",n.list="list"):(n.url=e.large_url,n.onload="photoAdjust(this, 168, 150)",n.list="card"),o=['<li class="friend-detail" data-id="'+n.fid+'" data-type="normal" data-name="'+n.fname+'" id="friendsli'+n.fid+'" >','<a class="tiny_photo userhead" href="http://www.renren.com/profile.do?id='+n.fid+'" target="_blank">','<img src="'+n.url+'" data-list="'+n.list+'" data-tinyurl="'+n.tiny_url+'" data-largeurl="'+n.large_url+'" class="userheadimg large" onload="'+n.onload+'">',"</a>",'<ul class="friends-item-con">','<li class="username"><a class="name" href="http://www.renren.com/profile.do?id='+n.fid+'" target="_blank" title="'+n.fname+'">'+n.sfname+"</a></li>"],i?(n.sfdesc=""===n.fdesc?s.conf.defaultSpecialDesc:n.fdesc,o.push('<li class="special-desc "><a class="png special-desc-edit fl"></a>','<span class="special-desc-detail" >'+n.sfdesc+"</span></li>",'<li class="special-desc-edit" data-id="'+n.fid+'" style="display:none;">','<textarea class="special-desc-input" data-id="'+n.fid+'">'+n.sfdesc+"</textarea>","</li>","</ul>",'<div class="friends-item-btn special-item-btn" data-id="'+n.fid+'">','<a class="special-up png fl"></a>','<a class="special-down png fl"></a>',"</div>","</li>")):(n.fgroupNames=a.length>0?a.join(" | "):s.conf.nogroup,n.fgroupNames=s.substring(n.fgroupNames,11,"..."),o.push('<li class="friends-loc-info" title="'+n.info+'">'+s.substring(n.info,6,"...")+"</li>",'<li class="friends-com-info '+(parseInt(n.comf)>0?"":"no-com")+'" data-id="'+n.fid+'">'+n.comf+"个共同好友</li>","</ul>",'<div class="friends-item-btn" data-id="'+n.fid+'">','<span class="group-name-list">'+n.fgroupNames+"</span>","</div>","</li>")),r=o.join(""),o.length=0,r}},i={tpl:'<li data-name="{{gname}}" class="{{show}} group {{normal}}">		          <a class="{{gclass}}" title="{{gname}}" data-name="{{gname}}" href="javascript:;">		              <span class="gname">{{gsname}}</span><span class="group-num">{{gnum}}</span>		          </a>		      </li>',sTpl:'<li>                    <a href="javascript:;" title="新建分组" class="add png">新建分组</a>                    <div class="new-group " style="display:none;">                        <input class="new-group-name name-num-overflow">                        <span class="new-name-ok">确认</span>                        <span class="new-name-cancel">取消</span>                    </div>               </li>		    <li><a href="javascript:;" class="intellect png">智能分组</a></li>',gTpl:'<li class="group {{on}}">	              <a class="icon png clearfix">	                  <span class="gname fl">{{gname}}</span>	                  <span class="group-num fr">{{gnum}}</span>                  </a>	           </li>',listTpl:'<li class="group{{on}}" data-name="{{gname}}">                      <a class="icon png clearfix">{{sgname}}</a>               </li>',moreTpl:'<li><a class="more png" id="moregroups" href="javascript:;"></a></li>',moreHiddenTpl:'<li><a class="more png" id="moregroups" style="display:none;" href="javascript:;"></a></li>',createTpl:'<div><label for="group-create" />分组名称:<input type="text" id="dialog_group-name" style="margin-left:10px;" /></div>',createTopItemTpl:'<li class="group" data-name="{{gname}}">                               <a class="icon png">{{sgname}}</a>                            </li>',renameTpl:'<div><label for="dialog_group-name">分组名称：</label><input type="text" value="{{gname}}" id="dialog_group-name" style="margin-left:10px;" /></div>',dismissTpl:"<div>你确定要解散该分组吗？</div>",build:function(e){var t,i,n=[],a=0;for(t=0,i=e.length;i>t;t++)e[t]&&(++a,n.push(this.render(e[t],a)));return n.push(this.sTpl),i>8?n.push(this.moreTpl):n.push(this.moreHiddenTpl),n.join("")},buildNew:function(e){var t={gname:e.gname,gsname:s.substring(e.gname,7,"..."),normal:e.normal,show:"on",gnum:e.gnum};return o.to_html(this.tpl,t)},buildGlist:function(e,t){var i,n,a=[],s=e.length;for(n=0;s>n;n++)i=e[n],i&&a.push(this.renderGlist(i,t));return a.join("")},buildList:function(e,t,i,n){var a,s,o=[];for(a=0,s=e.length;s>a;a++)e[a].gname!==i&&o.push(this.renderList(e[a],t,n));return o.join("")},buildNewGroup:function(e,t){return this.renderNewGroup(e,t)},buildTopItem:function(e){var t={gname:e,sgname:s.substring(e,7,"...")};return o.to_html(this.createTopItemTpl,t)},buildRename:function(e){return o.to_html(this.renameTpl,{gname:e})},render:function(e,t){var i=e;return i.gsname=s.substring(i.gname,7,"..."),i.show=t>8?"excess":"","normal"===e.gclass&&(i.normal="normal-group"),o.to_html(this.tpl,i)},renderGlist:function(e,t){var i=e;return i.on=-1===t.indexOf(e.gname)?"":"on",i.gname=s.substring(i.gname,7,"..."),o.to_html(this.gTpl,i)},renderList:function(e,t,i){var n={};return t&&e.gname===s.conf.all?n.on=" on":t||e.gname!=i||(n.on=" on"),n.gname=e.gname,n.sgname=s.substring(e.gname,7,"..."),o.to_html(this.listTpl,n)},renderNewGroup:function(e,t){var i={gname:e,gsname:s.substring(e,7,"..."),normal:"normal-group",show:t||"",gnum:0};return o.to_html(this.tpl,i)}},n={tpl:'<a class="fl selected-wrap" id="batch{{fid}}" href="javascript:;" data-id="{{fid}}">                {{fname}}<span class="batch-selected png "></span></a>',build:function(e){var t,i=[],n=e.length;for(t=0;n>t;t++)e[t]&&i.push(this.render(e[t]));return i.join("")},render:function(e){return o.to_html(this.tpl,e)}};var r={verify:'<p>确定和<b>{{fname}}</b>解除好友关系吗？</p>            <div><label for="verify-code">验证码:</label><input type="text" id="verify-code" />            <img id="verify-code-img" src="http://icode.renren.com/getcode.do?t=delfriend_&temp={{timestamp}}"/>            <a href="javascript:;" onclick="document.getElementById(\'verify-code-img\').src=\'http://icode.renren.com/getcode.do?t=delfriend_&r=\' + Math.random();return false;" >看不清,换一张</a></div>',normal:"确定和<b>{{fname}}</b>解除好友关系吗？",build:function(e,t){return this.render(e,t)},render:function(e,t){var i={fname:e},n=this.normal;return 1==t&&(i.timestamp=(new Date).getTime(),i.random=Math.random(),n=this.verify),o.to_html(n,i)}},l={removeTpl:'<div>确定将<b>{{fname}}</b>移除好友吗？<p>此操作将不会解除你们之间的好友关系。</p>                   <p class="friend-remove">（要解除好友关系请<a href="javascript:;" id="switch-del-friend">点击此处</a>)</p></div>',buildRemove:function(e){return this.renderRemove(e)},renderRemove:function(e){var t={fname:e};return o.to_html(this.removeTpl,t)}},d={headTpl:'  <div class="smart-big-bg" id="smart-big"></div>                <div class="smart-container" id="smart-container" style="width: 612px; height: 579px; left: 600px;">                    <div class="smart-head">                        <div class="smart-title clearfix">                            <h1 class="fl">智能分组</h1>                            <span class="png fr smart-close-icon"></span>                        </div>                        <ul class="smart-tab clearfix" id="smart_nav">',bodyTpl:'       </ul>                    </div>                    <div class="smart-list">                        <div class="fl">                            <ul class="smart-cate-list" id="smart_cate-list">                            </ul>                            <div style="display:none;" id="smart_list-func">                                <a href="javascript:;" class="smart-option-in fl" id="smart_list-in">加入此组</a>                                <a href="javascript:;" class="smart-option-out fl" id="smart_list-out">移出此组</a>                            </div>                        </div>                        <div class="smart-manage fl">                            <div class="smart-option-box" id="smart_option">                                <h5 class="smart-cate-name fl" id="smart_cur-group" style="display:;"></h5>                                <input type="text" value="" maxlength="10" style="display:none;" class="cate-rename smart-cate-rename fl" />                                <span class="cate-rename smart-rename-submit fl" style="display:none;">确认</span>                                <span class="cate-rename smart-rename-cancel fl" style="display:none;">取消</span>                                <span class="cate-created fl" style="display:none;">已创建</span>                                <span class="cate-ignore fl" style="display:none;">已忽略</span>                                <a href="javascript:;" class="fr png smart-list-create">创建此分组</a>                                <a href="javascript:;" class="fr smart-list-ignore">忽略此分组</a>                                <a id="smart_empty" class="smart-empty" style="display:none;">抱歉，没有更多分组了</a>                            </div>                            <ul class="smart-list-con clearfix" id="smart_friend-list" data-start="0" data-count="0">                            </ul>                        </div>                    </div>                    <div class="smart-footer">                        <a class="smart-support" href="http://help.renren.com/helpcenter#http://help.renren.com/support/contomvice?pid=5&selection={couId:%20194,%20proId:%20212,%20cityId:%201000411}" target="_blank">意见反馈</a>                        <a class="smart-create png fr">一键分组</a>                        <a class="smart-close png fr">关闭</a>                    </div>                </div>',smartTpl:'<li class="smart-nav fl {{on}} smart" data-type="smarts"><a class="create ">创建智能分组</a></li>',recommendTpl:'<li class="smart-nav fl {{on}}" data-type="recommend"><a class="perfect">智能完善已有分组</a></li>',groupTpl:'<li class="smart-group {{curClass}}" data-name="{{gname}}">                       <a class="group"><span class="smart-group-name" title="{{gname}}">{{sgname}}</span><span class="fr group-num">{{gnum}}</span></a>                   </li>',friendTpl:'<li data-id="{{fid}}" data-name="{{fname}}" data-url="{{url}}" class="smart-detail fl {{fclass}}">                        <div class="smart-li-cover" style="display: {{show}}"></div>                        <a href="javascript:;" class="smart-img fl">                           <img src="{{url}}" />                        </a>                        <a href="http://www.renren.com/profile.do?id={{fid}}" target="_blank" title="{{fname}}" class="smart-name fl">{{sfname}}</a>                    </li>',build:function(e){var t,i=e.smarts||[],n=e.recommend||[],a="";return t=this.buildNav(i,n),a=this.headTpl+t+this.bodyTpl},buildNav:function(e,t){var i=[],n=!0;return 0===e.length?(n=!1,i.push(this.renderNav("on",n))):(i.push(this.renderNav("on",n)),0!==t.length&&(n=!1,i.push(this.renderNav("",n)))),i.join("")},renderNav:function(e,t){var i={on:e};return t?o.to_html(this.smartTpl,i):o.to_html(this.recommendTpl,i)},buildGroup:function(e){var t,i,n=[];for(t=0,i=e.length;i>t;t++)n.push(this.renderGroup(e[t],t));return n.join("")},renderGroup:function(e,t){var i={};return i.gname=e.gname,i.sgname=s.substring(i.gname,6,"..."),i.gnum=e.created?"已创建":e.gnum,0===t&&(i.curClass="on"),o.to_html(this.groupTpl,i)},buildFriend:function(e){var t,i,n=[];for(t=0,i=e.length;i>t;t++)n.push(this.renderFriend(e[t]));return n.join("")},renderFriend:function(e){var t={};return e.checked===!1?(t.fclass="disable",t.show=""):t.show="none",t.fid=e.fid,t.fname=e.fname,t.sfname=s.substring(t.fname,3,"..."),t.url=e.tiny_url,o.to_html(this.friendTpl,t)}},c={tplHead:'<h3 class="suggest-title fl">你可能认识的人</h3>                <div class="suggest-func fr clearfix">                    <a class="png suggest-prev fl {{no_left}}">向前</a>                    <a class="png suggest-next fl {{no_right}}">向后</a>                    <a class="png suggest-more fl" href="http://friend.renren.com/newfriends"></a>                </div>                <ul class="suggest-friends-list clearfix" id="suggest-list-con">',tplBody:'<li class="suggest-friend fl">                    <a class="suggest-userhead" href="http://www.renren.com/profile.do?id={{id}}" target="_blank" >                        <img class="suggest-head" src="{{tiny_url}}" onload="{{onload}}" width="100" height="100" style="overflow:hidden;"/>                        <div class="head-mask"></div>                    </a>                    <a class="suggest-name" href="http://www.renren.com/profile.do?id={{id}}" target="_blank">{{name}}</a>                    <a class="suggest_follow ui-button ui-button-green suggest-add fr" data-id="{{id}}" data-name="{{name}}" data-flag="0" ><i class="ui-icon ui-iconfont" id="suggest_follow_add">&#xe849;</i>关注好友</a>                </li>',tplFooter:"</ul>",tpl:'<ul class="suggest-list">                <li class="suggest-detail">                    <img class="suggest-head fl" src="{{tinyurl}}" width="30" height="30"/>                    <a class="suggest-name" href="http://www.renren.com/profile.do?id={{id}}" target="_blank">{{name}}</a>                    <span data-id="{{id}}" class="suggest-join fr png"></span>                </li>            </ul>',build:function(e,t){var i,n,a=[];for(a.push('<h3 class="suggest-title">推荐加入['+s.substring(t,8,"...")+"]</h3>"),i=0,n=e.length;n>i;i++)a.push(this.render(e[i]));return a.join("")},render:function(e){return e.name=s.substring(e.name,8,"..."),o.to_html(this.tpl,e)},buildFriend:function(e){var t,i,n={no_left:"no_left",no_right:e.length>4?"":"no_right"},a=[o.to_html(this.tplHead,n)];for(t=0,i=e.length;i>t;t++)a.push(this.renderFriend(e[t]));return a.push(this.tplFooter),a.join("")},renderFriend:function(e){var t={id:e.id,tiny_url:e.large_url,onload:"photoAdjust(this, 100, 100)",name:s.substring(e.name,8,"...")};return o.to_html(this.tplBody,t)}};a={tpl:'<li class="recommend-detail" data-id={{id}} data-name="{{name}}" data-type="{{data_type}}" data-com="{{common_frd_num}}" >                <div class="friends-item-con">                    <a class="userhead" href="http://www.renren.com/profile.do?id={{id}}" target="_blank">                        <img src="{{url}}" onload="{{onload}}" data-list="{{list}}" data-largeUrl="{{large_url}}" data-tinyUrl="{{tiny_url}}" style="display:{{display}};" class="user-head-img {{classType}}">                    </a>                    <ul>                        <li class="username">                            <a href="http://www.renren.com/profile.do?id={{id}}" target="_blank" title="{{name}}" >{{sname}}</a>                        </li>                        <li class="friends-loc-info" title="{{titleInfo1}}">{{sexp1}}</li>                        <li class="friends-com-info {{is_com_info2}} {{no_com}}" >{{sexp2}}</li>                    </ul>                </div>                <div class="friends-item-btn">                        {{{buildRelation}}}                </div>            </li>',shadeTpl:'<div id="friend-head-fn" style="display:none;width:0;height:0;" >                    <a href="javascript:;" class="png x-to-hide" style="display:none;"></a>                    <a href="javascript:;" class="png x-to-hide-tips3" style="display:none;"></a>                    <a href="javascript:;" class="png d-to-select" style="display:none;"></a>                    <a href="javascript:;" class="png x-to-hide-tips2" style="display:none;"></a>                    <div id="friends-common-tip" class="friends-common-fri-tip" style="display:none;">                       <em></em>                       <div id="friends-common-txt" class="friends-common-fri-txt-new"></div>                    </div>                </div>',taShadeTple:'<div id="friend-head-fn" style="display:none;width:0;height:0; " >                                <div id="friends-common-tip" class="friends-common-fri-tip" style="display:none;">                                    <em></em>                                    <div id="friends-common-txt" class="friends-common-fri-txt-new"></div>                                </div>                          </div>',taNoAuthorityTple:'<div class="no-authority"><span>由于对方设置隐私保护，您没有权限查看对方好友！</span></div>',taNoFriendTipTple:'<div class="tip"><span>{{tip}}</span></div>',build:function(e,t,i,n,a){for(var s=[],o=(e.length,4==arguments.length?!1:a),r=t;i>r&&e[r];r++)s[r]=this.render(e[r],n,o);return s.join("")},render:function(e,t,i){var n=e;return n.sname=s.substring(n.name,9,"..."),n.buildRelation=this.getRetion(n.id,n.relation,n.sname),i?(n.sexp1=s.substring(n.exp2,10,"..."),n.sexp1=""==n.sexp1?"":n.sexp1,n.titleInfo1=n.exp2,n.sexp2=s.substring(n.common_frd,10,"..."),n.is_com_info2=-1==n.common_frd.indexOf("共同好友")?"":"is-com-info",n.no_com="0个共同好友"!=n.common_frd?"":"no-com"):(n.sexp1=s.substring(n.exp1,10,"..."),n.sexp1=""==n.sexp1?"":n.sexp1,n.titleInfo1=n.exp1,n.sexp2=s.substring(n.exp2,10,"..."),n.is_com_info2=-1==n.exp2.indexOf("共同好友")?"":"is-com-info",n.no_com="0个共同好友"!=n.exp2?"":"no-com"),t?(n.url=n.tiny_url,n.onload="",n.classType="tiny",n.display="block"):(n.url=n.large_url,n.onload="photoAdjust(this, 168, 150)",n.classType="large"),o.to_html(this.tpl,n)},getRemoveBtnHtml:function(e){var t='<a href="#nogo" class="png x-to-hide" style="display:none"></a>            <div class="png x-to-hide-tips" style="display:none"></div>';return e?t:""},getCommonFriHtml:function(e,t){var i='<div class="friends-common-fri-count">{{count}}</div>                <div class="friends-common-fri" style="display:none">                    <div class="friends-common-fri-agl"></div>                    <div class="friends-common-fri-txt"></div>                </div>';if(e>0){var n={count:e>99?"99+":e,text:t.aSubStringTer(36,"...")};return o.to_html(i,n)}return""},getCommonFriHtmlNew:function(e,t){var i='<div class="friends-common-fri-count">{{count}}</div>                            <div class="friends-common-fri-tip" style="display:none;">                            <em></em>                            <div class="friends-common-fri-txt-new"></div>                        </div>';if(e>0){var n={count:e>99?"99+":e,text:t.aSubStringTer(36,"...")};return o.to_html(i,n)}return""},getRetion:function(e,t,i){return 0==t?'<a href="#nogo" data-id="'+e+'" data-name="'+i+'" data-flag="0" class="ui-button ui-button-green add"><span class="ui-icon ui-iconfont">&#xe849;</span><span class="ui-button-text">关注好友</span></a>':1==t?'<a href="#nogo" data-id="'+e+'" data-name="'+i+'" data-flag="1" class="ui-button ui-button-blue sended"><span class="ui-button-text">已关注</span></a>':2==t?'<a href="#nogo" data-id="'+e+'" data-name="'+i+'" class="ui-button ui-button-blue chat" onclick="window.webpager.talk('+e+');return false;"><span class="ui-icon ui-iconfont">&#xe81f;</span><span class="ui-button-text">聊天</span></a>':void 0},getNoFriendTipTple:function(e){var t=null==e||""==e?"没有找到更多好友...":e,i={tip:t};return o.to_html(taNoFriendTipTple,i)}};var u={tpl:'<li class="recommend-detail" data-id={{fid}} data-name="{{fname}}"  data-com="{{comf}}" >                <div class="friends-item-con">                    <a class="userhead" href="http://www.renren.com/profile.do?id={{fid}}" target="_blank">                        <img src="{{url}}" onload="{{onload}}" data-list="{{list}}" data-largeUrl="{{large_url}}" data-tinyUrl="{{tiny_url}}" style="display:{{display}};" class="user-head-img {{classType}}">                    </a>                    <ul>                        <li class="username">                            <a href="http://www.renren.com/profile.do?id={{fid}}" target="_blank" >{{sname}}</a>                        </li>                        <li class="friends-loc-info " data="{{exp1}}" >{{exp1}}</li>                        <li class="friends-com-info {{is_com_info2}} {{no_com}}">{{exp2}}</li>                    </ul>                </div>                <div class="friends-item-btn">                        {{{buildRelation}}}                </div>            </li>',
shadeTpl:'<div id="friend-head-fn" style="display:none;width:0;height:0;" >                    <a href="javascript:;" class="png x-to-hide" style="display:none;"></a>                    <a href="javascript:;" class="png x-to-hide-tips3" style="display:none;"></a>                    <a href="javascript:;" class="png d-to-select" style="display:none;"></a>                    <a href="javascript:;" class="png x-to-hide-tips2" style="display:none;"></a>                    <div id="friends-common-tip" class="friends-common-fri-tip" style="display:none;">                       <em></em>                       <div id="friends-common-txt" class="friends-common-fri-txt-new"></div>                    </div>                </div>',taShadeTple:'<div id="friend-head-fn" style="display:none;width:0;height:0; " >                                <div id="friends-common-tip" class="friends-common-fri-tip" style="display:none;">                                    <em></em>                                    <div id="friends-common-txt" class="friends-common-fri-txt-new"></div>                                </div>                          </div>',taNoAuthorityTple:'<div class="no-authority"><span>由于对方设置隐私保护，您没有权限查看对方好友！</span></div>',build:function(e,t,i,n,a){for(var s=[],o=(e.length,4==arguments.length?!1:a),r=t;i>r&&e[r];r++)s[r]=this.render(e[r],n,o);return s.join("")},render:function(e,t,i){var n=e;return n.sname=s.substring(n.fname,9,"..."),n.buildRelation=this.getRetion(n.fid,n.relationType,n.sname),n.exp1=s.substring(n.info,10,"..."),n.exp2=n.comf+"个共同好友",n.is_com_info2="is-com-info",n.no_com=parseInt(n.comf)>0?"":"no-com",t?(n.url=n.tiny_url,n.onload="",n.classType="tiny",n.display="block"):(n.url=n.large_url,n.onload="photoAdjust(this, 168, 150)",n.classType="large"),o.to_html(this.tpl,n)},getRetion:function(e,t,i){return 3===t?'<a href="#nogo" data-id="'+e+'" data-name="'+i+'" class="ui-button ui-button-blue chat" onclick="window.webpager.talk('+e+');return false;"><span class="ui-icon ui-iconfont">&#xe81f;</span><span class="ui-button-text">聊天</span></a>':2===t?'<a href="#nogo" data-id="'+e+'" data-name="'+i+'" data-flag="1" class="ui-button ui-button-default add followed"><span class="ui-button-text">已关注</span></a>':'<a href="#nogo" data-id="'+e+'" data-name="'+i+'" data-flag="0" class="ui-button ui-button-green add"><span class="ui-icon ui-iconfont">&#xe849;</span><span class="ui-button-text">关注好友</span></a>'}},f={suggestCommpanyTpl:'<div class="suggest-box company" {{display}}>                                    <a class="input-radio" data-name="{{name}}" union="company" class="input-radio" id="scompany{{i}}" name="suggest-company"></a>                                    <p for="scompany{{i}}">{{name}}</p>                                </div>',suggestUnivTpl:'<div class="suggest-box univ" {{display}}>                                <a class="input-radio" id="suniv{{i}}" union="univ" data-name="{{name}}" data-id="{{id}}" data-year="{{year}}" data-dept="{{depart}}" name="suggest-univ"></a>                                <div for="suniv{{i}}">                                    <p>{{name}}</p>                                    <p>{{depart}}</p>                                    <p>{{year}}年入学</p>                                </div>                            </div>',suggestHighTpl:'<div class="suggest-box high" {{display}}>                                <a class="input-radio" data-name="{{name}}" union="high" id="shigh{{i}}" name="suggest-high"></a>                                <p for="shigh{{i}}">{{name}}</p>                            </div>',suggestJuniorTpl:'<div class="suggest-box high" {{display}}>                                <a data-name="{{name}}" union="junior" class="input-radio" id="sjunior{{i}}" name="suggest-junior"></a>                                <p for="sjunior{{i}}">{{name}}</p>                            </div>',nameTpl:'<li class="item filter-sub-title">                        <span class="sub-title">姓名</span>                    </li>                    <li class="item item-container no-bottom">                        <div class="keyword-name">                            <input class="value-input keyword" type="text" stype="keyword" id="keyword" skey="people" value="你想找谁?" default-value="你想找谁?" placeholder="你想找谁?">                            <a class="filter-input-ok" href="javascript:;"></a>                            <a class="filter-input-clear" href="javascript:;" union="keyword" style="display: none;"></a>                        </div>                    </li>                    <li class="item item-container2">                        <span id="is_friend" class="is-friend"></span>                        <label for="is-friend">仅显示非好友</label>                    </li>',relationTpl:'<li class="item filter-sub-title relation-title">                            <span class="sub-title">按人脉筛选</span>                            <a href="javascript:;" class="filter-circle-tip"></a>                            <a href="javascript:;" class="filter-input-clear" style="display:none;"></a>                        </li>                        <li class="item item-container relation-box">                            <div class="condition-name">                                <input id="circle" class="circle value-input" type="text" stype="relation" default-value="请选择您的好友" placeholder="请选择您的好友" />                                <input type="hidden" id="circleVal" value="" num="0">                                <input type="hidden" id="circleCur" value="-1">                                <input type="hidden" id="circleAll" value="0">                            </div>                            <div class="filter-circle-suggest" style="display:none">                                <ul id="scircle">                                </ul>                            </div>                            <div id="ccfrds" class="selected-friends"></div>                        </li>                     ',conditionTpl:'<li class="item filter-sub-title condition-title">                            <span class="sub-title">按资料筛选</span>                            <a href="javascript:;" class="filter-input-clear" style="display:none;"></a>                         </li>',gendTpl:'<li class="item condition-item">                        <a class="value-option drop-menu-down" data-value id="gend" default-show="yes" stype="base" skey="gend" default-value="性别" name="gend" href="#nogo">性别</a>                        <a href="javascript:;" class="filter-input-clear" union="gend" style="display:none"></a>                        <div id="filter-gend" class="filter-gend menu" style="display:none">                            <ul class="options">                                <li value="" class="option">选择性别</li>                                <li value="男生" class="option">男</li>                                <li value="女生" class="option">女</li>                            </ul>                        </div>                   </li>',ageTpl:'<li class="item condition-item">                    <a class="value-option drop-menu-down" id="age_stage" data-value default-show="yes" stype="age" skey="range" name="range" default-value="年龄" href="#nogo">年龄</a>                    <a href="javascript:;" class="filter-input-clear" union="age_stage" style="display:none"></a>                    <div class="filter-age menu" id="option_age" style="display:none">                            <ul class="options">                                <li value>选择年龄段</li>                                <li value="0">小于15岁</li>                                <li value="1">16-22岁</li>                                <li value="2">23-30岁</li>                                <li value="3">31-40岁</li>                                <li value="4">大于40岁</li>                            </ul>                    </div>                </li>',companyTpl:'<li class="item condition-item item-container company-box" {{display}}>                      <div class="company-name">                            <input type="text" id="company" class="company value-input" skey="company" default-value="公司" placeholder="公司" />                            <a href="javascript:;"  class="filter-input-clear" union="company" style="display:none"></a>                       </div>                       <div id="scompany_box">                        {{{suggest}}}                        </div>                    </li>',univTpl:'<li class="item condition-item" {{display}}>                        <input id="univ" data-value class="condition-univ value-select special-hover" stype="univ" default-value="大学" placeholder="大学">                        <a href="javascript:;"  class="filter-input-clear" union="univ" style="display:none"></a>                        <input type="hidden" name="univ_id" value="" id="univ_id" default-value="" class="input-text s-select s-univ">                     </li>                     <li class="item condition-item" {{display}}>                        <a id="univ_year" data-value class="value-option drop-menu-down" stype="univ" skey="year" default-value="入学时间" href="javascript:;">入学时间</a>                        <a href="javascript:;" class="filter-input-clear" union="univ_year" style="display:none"></a>                        <div id="filter_univ_year" class="filter-univ-year menu" style="display: none">                            <ul class="options over-height">                            {{{age_options}}}                            </ul>                        </div>                     </li>                     <li class="item condition-item" {{display}}>                        <a id="univ_dept" data-value class="value-option drop-menu-down" stype="univ" skey="depart" default-value="所在院系" href="javascript:;">所在院系</a>                        <a href="javascript:;" class="filter-input-clear" union="univ_dept" style="display:none"></a>                        <div id="filter_univ_dept"  class="filter-univ-dept menu"  style="display: none">                            <ul class="options">                                <li value>选择院系</li>                                <li value="其他院系">其他院系</li>                            </ul>                        </div>                        <div id="suniv_box">                            {{{suggest}}}                        </div>                    </li>',highTpl:' <li class="item condition-item" {{display}}>                        <input id="high" data-value class="s-hight value-select" stype="high" default-value="高中" placeholder="高中"/>                        <a href="javascript:;"  class="filter-input-clear" union="high" style="display:none"></a>                        <div id="shigh_box">                            {{{suggest}}}                        </div>                    </li>',techTpl:' <li class="item condition-item" default-show="no" style="display:none;">                        <input id="tech" data-value class="s-tech value-select" stype="techHigh" default-value="中专" placeholder="中专"/>                        <a href="javascript:;"  class="filter-input-clear" union="tech" style="display:none"></a>                    </li>                    ',juniorTpl:'<li class="item condition-item" {{display}}>                        <input id="junior" data-value class="s-junior value-select" default-value="初中" stype="junior"  placeholder="初中" />                        <a href="javascript:;"  class="filter-input-clear" union="junior" style="display:none"></a>                        <div id="sjunior_box">                        {{{suggest}}}                        </div>                    </li>                    ',elemTpl:'  <li class="item condition-item" default-show="no" style="display:none;">                        <input type="text" id="elementary" data-value class="elementary value-select" stype="elementary" name="elementarySchool" default-value="小学" placeholder="小学"/>                        <a href="javascript:;"  class="filter-input-clear" union="elementary" style="display:none"></a>                    </li>                 ',homeTpl:'<li class="item condition-item" default-show="no" style="display:none;">                        <a id="home" data-value class="value-option drop-menu-down" default-value="家乡" stype="base" skey="prov" name="homeProvince" href="javascript:;">家乡</a>                        <a href="javascript:;"  class="filter-input-clear" union="home" style="display:none"></a>                        <div id="filter-home" class="homeProvince menu" style="display:none">                            <ul class="options over-height">                                <li value>选择家乡</li><li value="北京">北京</li><li value="上海">上海</li><li value="天津">天津</li><li value="重庆">重庆</li><li value="黑龙江">黑龙江</li><li value="吉林">吉林</li><li value="辽宁">辽宁</li><li value="山东">山东</li><li value="山西">山西</li><li value="陕西">陕西</li><li value="河北">河北</li><li value="河南">河南</li><li value="湖北">湖北</li><li value="湖南">湖南</li><li value="海南">海南</li><li value="江苏">江苏</li><li value="江西">江西</li><li value="广东">广东</li><li value="广西">广西</li><li value="云南">云南</li><li value="贵州">贵州</li><li value="四川">四川</li><li value="内蒙古">内蒙古</li><li value="宁夏">宁夏</li><li value="甘肃">甘肃</li><li value="青海">青海</li><li value="西藏">西藏</li><li value="新疆">新疆</li><li value="安徽">安徽</li><li value="浙江">浙江</li><li value="福建">福建</li><li value="台湾">台湾</li><li value="香港">香港</li><li value="澳门">澳门</li>                            </ul>                        </div>                   </li>                  ',moreTpl:'<li class="item filter-expand more"></li>',inviteTpl:'<div class="filter-bottom">没有想要找的人？试试<a target="_blank" href="http://invite.renren.com/Invite.do">邀请好友</a></div>',tipTpl:'<a class="filter-circle-tips" style="display:none" href="javascript:;">                 <a class="filter-clear-tips" style="display:none" href="javascript:;">                 ',schoolSelectTpl:'<div id="school_suggest_box" class="school-suggest" style="display:none">                            <ul id="sschools"></ul>                        </div>',buildFilterSuggest:function(e,t){if(!e)return new Array("","");var i="";switch(t){case"company":i=this.suggestCommpanyTpl;break;case"high":i=this.suggestHighTpl;break;case"junior":i=this.suggestJuniorTpl}for(var n=[],a=e.length||0,s=0;a>s;s++){var r={name:e[s],i:s,display:s>0?"default-show=no style=display:none":"default-show=yes"};n[s]=o.to_html(i,r)}return n.join("")},buildUnivSuggest:function(e){if(!e)return new Array("","");for(var t=[],i=e.length||0,n=0;i>n;n++){var a=e[n];a.i=n,a.display=n>0?"default-show=no style=display:none":"default-show=yes",t[n]=o.to_html(this.suggestUnivTpl,a)}return t.join("")},build:function(e){if(e){var t=this,i=this.buildFilterSuggest(e.company,"company"),n=this.buildFilterSuggest(e.junior,"junior"),a=this.buildFilterSuggest(e.high,"high"),s=this.buildUnivSuggest(e.univ),r=new Array;r.push('<ul class="li-list">'),r.push(this.nameTpl),r.push(this.relationTpl),r.push(this.conditionTpl),r.push(this.gendTpl),r.push(this.ageTpl);var l=function(e){return e=e===!1?!1:!0,o.to_html(t.companyTpl,{suggest:i,display:e?"default-show=yes":"default-show=no style=display:none"})},d=function(e){return e=e===!1?!1:!0,o.to_html(t.univTpl,{suggest:s,display:e?"default-show=yes":"default-show=no style=display:none",age_options:function(){for(var e=new Array('<li value="">选择入学时间</li>'),t=(new Date).getFullYear(),i=t;i>=1990;i--)e.push(['<li value="'+i+'">'+i+"</li>"]);return e.join("")}})},c=function(e){return e=e===!1?!1:!0,o.to_html(t.highTpl,{suggest:a,display:e?"default-show=yes":"default-show=no style=display:none"})},u=function(e){return e=e===!1?!1:!0,o.to_html(t.juniorTpl,{suggest:n,display:e?"default-show=yes":"default-show=no style=display:none"})},f=e["default"];switch(f){case"c":case"u":r.push(l()),r.push(d()),r.push(c(!1)),r.push(t.techTpl),r.push(u(!1));break;case"h":r.push(d()),r.push(c()),r.push(l(!1)),r.push(t.techTpl),r.push(u(!1));break;case"j":r.push(c()),r.push(u()),r.push(l(!1)),r.push(d(!1)),r.push(t.techTpl)}return r.push(t.elemTpl),r.push(t.homeTpl),r.push(t.moreTpl),r.push("</ul>"),r.push(t.schoolSelectTpl),r.push(t.tipTpl),r.join("")}}},p={tpl:'<li data-id="{{id}}" id="cc{{i}}" data-index="{{i}}" data-name="{{name}}" data-url="{{tinyurl}}">                    <img src="{{tinyurl}}" width=30 height=30>&nbsp;&nbsp;&nbsp;<span>{{{sname}}}</span>                </li>',build:function(e,t){for(var i=t.length,n=[],a=0;i>a;a++)n.push(this.render(e,t[a],a));return n.join("")},render:function(e,t,i){var n=t;return n.sname=s.substring(n.name,10,"...").replace(e,'<font style="color:#369;">'+e+"</font>"),n.i=i,o.to_html(this.tpl,n)}},h={tpl:'<li data-id="{{id}}" value="{{id}}" data-name="{{sname}}">{{ssname}}</li>',build:function(e,t){for(var i=e.length,n=[],a=0;i>a;a++)n.push(h.render(e[a].firstChild.nodeValue,t[a].firstChild.nodeValue));return n.join("")},render:function(e,t){var i={};return i.sname=t,i.ssname=s.substring(t,14,"..."),i.id=e,o.to_html(this.tpl,i)}};e.group={build:function(e){return i.build(e)},buildGlist:function(e,t){return i.buildGlist(e,t)},buildList:function(e,t,n,a){return i.buildList(e,t,n,a)},buildCreate:function(){return i.createTpl},buildTopItem:function(e){return i.buildTopItem(e)},buildRename:function(e){return i.buildRename(e)},buildNew:function(e){return i.buildNew(e)},buildNewGroup:function(e){return i.buildNewGroup(e)},buildDismiss:function(){return i.dismissTpl}},e.smartGroup={build:function(e){return d.build(e)},buildGroup:function(e){return d.buildGroup(e)},buildFriend:function(e){return d.buildFriend(e)}},e.friend={build:function(e,i,n){return t.build(e,i,n)},buildBeforeDelete:function(e,t){return r.build(e,t)}},e.special={remove:function(e){return l.buildRemove(e)}},e.check={build:function(e){return s.isArray(e)||(e=[e]),n.build(e)}},e.suggest={build:function(e,t){return c.build(e,t)},buildFriend:function(e){return c.buildFriend(e)}},e.addFriends={recommemdBuild:function(e,t,i,n,s){return a.build(e,t,i,n,s)},buildManageFriendsShade:function(){return a.shadeTpl},buildSchoolSuggest:function(e,t){return h.build(e,t)}},e.taFriends={recommemdBuild:function(e,t,i,n,a){return u.build(e,t,i,n,a)},buildTaNoAuthorityTip:function(){return u.taNoAuthorityTple},buildTaManageFriendsShade:function(){return u.taShadeTple},buildTaNoFriendTipTple:function(e){return u.getNoFriendTipTple(e)}},e.buildCircle=function(e,t){return p.build(e,t)},e.buildFilter=function(e){return f.build(e)}}),define("friends/model",function(require,e,t){var i,n,a,s,o,r=require("jquery"),l=require("friends/ajax"),d=require("friends/util"),c={groups:{},specials:[],friends:{},latest:[]};i=function(e){var t=n(e);c.groups=t.groups,c.specials=t.specials,c.friends=t.friends,c.latest=t.latest},n=function(e){function t(e,t){return e>t?1:-1}var i,n,a,s,o,r,l,c,u,f=e.groups||{},p=e.friends||[],h=e.hostFriendCount||e.friends.length,g={friends:{},specials:{friends:e.specialfriends||[],gclass:"special",gname:d.conf.special,gnum:(e.specialfriends||[]).length},groups:{"全部好友":{gclass:"all",gname:d.conf.all,gnum:h,friends:[]},"未分组好友":{gclass:"nogroup",gname:d.conf.nogroup,gnum:0,friends:[]}},latest:{gclass:"latest",gname:d.conf.latest,gnum:0,friends:[]}};if((l=f.length)>0)for(o=0;l>o;o++)u=f[o],u.gclass="normal",u.gnum=0,u.friends=[],g.groups[u.gname]=u;if((l=e.hotFriends.length)>0&&(g.latest.friends=e.hotFriends,g.latest.gnum=l),l=p.length)for(o=0;l>o;o++){if(i=p[o],s=i.pos,n=i.fgroups||[],(c=n.length)>0)for(r=0;c>r;r++)a=n[r],g.groups[a]&&(g.groups[a].friends.push(s),g.groups[a].gnum++);else g.groups["未分组好友"].gnum++,g.groups["未分组好友"].friends.push(s);g.groups["全部好友"].friends[s]=i.fid,g.friends[i.fid]=i}for(a in g.groups)g.groups.hasOwnProperty(a)&&"全部好友"!==a&&(u=g.groups[a],u.friends.sort(t));return g},a={remove:function(e){var t,i,n,a,s=c.friends,o=s[e],r=c.groups["全部好友"];if(o){if(t=o.fgroups,a=t.length,0!==a)for(n=0;a>n;n++)i=t[n],this.singleDel(i,e);else i=d.conf.nogroup,this.singleDel(i,e);var l=c.specials.friends;for(n=0;n<l.length;n++)if(l[n].fid==e){l.splice(n,1),c.specials.gnum-=1;break}r.friends[o.pos]=void 0,r.gnum-=1}},create:function(e){e&&(c.groups[e]={gclass:"normal",gname:e,gnum:0,friends:[]})},rename:function(e,t){if(e&&t){var i=c.groups,n=this.getFriend(e);i[t]=i[e],i[t].gname=t,s.replaceGroup(e,t,n),delete i[e]}},dismiss:function(e){if(e){var t=c.groups,i=this.getFriend(e);s.delGroup(e,i),delete t[e]}},shift:function(e,t,i){var n=c.groups;n[e]&&n[t]&&(this.add(t,i),this.del(e,i))},add:function(e,t){var i,n,a;for(i=0,n=t.length;n>i;i++)a=t[i],this.singleAdd(e,a)},singleAdd:function(e,t){var i,n,a,o;i=c.groups[e],a=c.friends[t],i&&a&&(t=parseInt(t),o=a.pos,n=a.fgroups,this._add(o,i.friends),i.gnum=i.friends.length,(0===n.length||-1!=r.inArray("未分组好友",n))&&this.singleDel("未分组好友",t),s.addGroup(e,[t]))},del:function(e,t){var i,n;for(i=0,n=t.length;n>i;i++)this.singleDel(e,t[i])},singleDel:function(e,t){var i,n,a=c.groups[e],o=c.friends[t];a&&o&&(t=parseInt(t),n=o.pos,this._del(n,a.friends),s.delGroup(e,[t]),i=o.fgroups,e!==d.conf.nogroup&&0===i.length&&this.singleAdd(d.conf.nogroup,t),a.gnum=a.friends.length)},_del:function(e,t){var i;-1!==(i=t.indexOf(e))&&t.splice(i,1)},_add:function(e,t){var i,n=t.length;if(0===n)t.push(e);else{if(-1!==t.indexOf(e))return;if(t[n-1]<e)t.push(e);else if(t[0]>e)t.unshift(e);else for(n>e&&(n=e),i=0;n>i;i++)if(t[i]>e&&t[i-1]<e){t.splice(i,0,e);break}}},getFriend:function(e){var t,i,n,a,s=[];if(n=c.groups[d.conf.all].friends,e===d.conf.all)return c.groups[e].friends;if(e==d.conf.latest)for(a=c.latest.friends,t=0,i=a.length;i>t;t++)s.push(a[t].fid);else if(e==d.conf.special)for(a=c.specials.friends,t=0,i=a.length;i>t;t++)s.push(a[t].fid);else for(a=c.groups[e].friends,t=0,i=a.length;i>t;t++)s.push(n[a[t]]);return s},get:function(e){var t,i,n,a=c.friends,s=c.groups[e],o=[];if(e===d.conf.latest);else if(e===d.conf.special)return c.specials.friends;for(t=e===d.conf.all?s.friends:this.getFriend(e),i=0,n=t.length;n>i;i++)o.push(a[t[i]]);return o},getAll:function(){var e,t=c.groups,i=[];return i.push(t[d.conf.all],t[d.conf.nogroup],c.specials,c.latest),e=this.getNormal(),i.concat(e)},getForAdd:function(){var e=c.groups,t=[];return t.push(e[d.conf.all]),t.push(e[d.conf.nogroup]),t=t.concat(this.getNormal())},getNormal:function(){var e,t,i=c.groups,n=[],a=null;for(a=this.getNames(),e=0,t=a.length;t>e;e++)gname=a[e],n.push(i[gname]);return n},getById:function(t){var i;if(d.dataSource.get("curGroup")!=d.conf.special||e.State.isAdd())return i=c.friends,i[t];i=c.specials.friends;for(var n=0;n<i.length;n++)if(i[n].fid==t)return i[n]},getByIds:function(e){var t,i,n,a=c.friends,s=[];for(t=0,i=e.length;i>t;t++)n=a[e[t]],n&&s.push(n);return s},getNum:function(e){switch(e){case d.conf.special:return c.specials.gnum;case d.conf.latest:return c.latest.gnum;default:return c.groups[e]?c.groups[e].gnum:0}},isEmpty:function(e){return 0===this.getNum(e)?!0:!1},getNames:function(e){var t,i=[],n=c.groups;e&&(i=[d.conf.all,d.conf.nogroup,d.conf.special,d.conf.latest]);for(t in n)n.hasOwnProperty(t)&&t!==d.conf.all&&t!==d.conf.nogroup&&i.push(t);return i},checkGname:function(e){return d.checkGroupName(e)?(d.showDebugLog(c.groups[e]),c.groups[e]?(d.showMsg(d.conf.sameGname),!1):!0):!1},getByName:function(e){return c.groups[e]},unique:function(e,t){var i,n,a,s=[];for(i=Array.isArray(e)?e:this.get(e),a=i.length,n=0;a>n;n++)friend=i[n],friend&&!this._in(friend,t)&&s.push(friend);return s},_in:function(e,t){var i,n=e.fgroups||[];return i=t===d.conf.special?specialOption.indexOf(e.fid):n.indexOf(t),-1===i?!1:!0},_getSortInfo:function(e,t,i){function n(e,t,n){var a=e[n]-t[n]>0?1:-1;return"pos"===n&&(a=-a),i?-a:a}var s,o,r;switch(s=this.get(r),t){case"time":o="timepos";break;case"alpha":o="pos";break;default:o="compos"}return r===d.conf.special?s.sort(function(e,t){var i=a.getById(e.fid),s=a.getById(t.fid);return n(i,s,o)}):s.sort(function(e,t){return n(f1,f2,o)}),s},sort:function(e,t,i,n){function s(e,t,n){var a=e[n]-t[n]>0?1:-1;return"pos"===n&&(a=-a),i?-a:a}var o;switch(t){case"time":o="timepos";break;case"alpha":o="pos";break;default:o="compos"}return n?e.sort(function(e,t){var i=a.getById(e.fid),n=a.getById(t.fid);return s(i,n,o)}):e.sort(function(e,t){return s(e,t,o)}),e}},s={delGroup:function(e,t){var i,n,a,s,o,r=c.friends;for(a=0,s=t.length;s>a;a++)i=r[t[a]],n=i.fgroups||[],o=n.indexOf(e),-1!==o&&n.splice(o,1)},addGroup:function(e,t){var i,n,a,s,o,r=c.friends;for(a=0,s=t.length;s>a;a++)i=r[t[a]],n=i.fgroups||[],o=n.indexOf(e),-1===o&&n.push(e)},replaceGroup:function(e,t,i){var n,a,s,o,r,l,d=c.friends;for(s=0,o=i.length;o>s;s++)n=d[i[s]],a=n.fgroups||[],r=a.indexOf(e),l=a.indexOf(t),-1!==r&&-1===l?a.splice(r,1,t):-1===r&&-1===l?a.push(t):-1!==r&&-1!==l&&a.splice(r,1)},getFgroups:function(e){var t=a.getById(e);return t?t.fgroups:[]}},specialOption={saveDesc:function(e,t){var i=this.getById(e);i.desc=t},checkDesc:function(e,t){var i=this.getById(e);return i.desc===t?!1:d.checkSpecialDesc(t)?!0:!1},saveRank:function(e,t){var i,n,a=c.specials.friends,s=this.getById(e),o=this.getById(t);i=s.pos,n=a[i],a[i]=a[o.pos],a[o.pos]=n,s.pos=o.pos,o.pos=i},remove:function(e){var t,i,n=this.get();for(e=parseInt(e),t=0,i=n.length;i>t;t++)if(n[t].fid===e){n.splice(t,1);break}c.specials.gnum=n.length},add:function(e){var t,i,n,s,o=c.specials;for(n=0,s=e.length;s>n;n++)t=a.getById(e[n]),i={fdesc:"",fid:t.fid,fname:t.fname,large_url:t.large_url,tiny_url:t.tiny_url,pos:o.gnum++},o.friends.push(i)},getById:function(e){var t,i,n=c.specials.friends;for(e=parseInt(e),t=0,i=n.length;i>t;t++)if(n[t].fid===e)return n[t]},getPosById:function(e){return this.getById(e).pos},get:function(){return c.specials.friends},indexOf:function(e){var t,i,n=this.get(),a=-1;for(e=parseInt(e),t=0,i=n.length;i>t;t++)if(n[t].fid==e){a=t;break}return a},getFids:function(){var e,t,i=[],n=this.get();for(e=0,t=n.length;t>e;e++)i.push(n[e].fid);return i}},o={normal:function(e){var t,i,n,s=[];for(i=0,n=e.length;n>i;i++)t=a.getById(e[i].fid),t&&s.push(t);return s}},e.group={create:function(e,t,i){a.checkGname(e)?l.group.create(e,function(i){a.create(e),t&&t(i)}):i()},dismiss:function(e,t){l.group.dismiss(e,function(i){a.dismiss(e),t&&t(i)})},rename:function(e,t,i){a.checkGname(t)&&l.group.rename(e,t,function(n){a.rename(e,t),i&&i(n)})},add:function(e,t,i,n){var s,o,r;l.group.batchJoin(t,e,1,function(n){if(0!=n.code)return void d.alert(n.msg);for(o=0,r=e.length;r>o;o++)s=e[o],a.add(s,t);i&&i(n)})},del:function(e,t,i){l.group.batchRemove(t,e,function(n){return 0!=n.code?void d.alert(n.msg):(a.del(e,t),void(i&&i(n)))})},shift:function(t,i,n,s){e.group.add([i],n,function(o){e.group.del(t,n,function(e){return 0!=e.code?void d.alert(e.msg):(a.shift(t,i,n),void(s&&s(e)))})})},get:function(e){return a.get(e)},getForAdd:function(){return a.getForAdd()},getAll:function(){return a.getAll()},getNormal:function(){return a.getNormal()},getNum:function(e){return a.getNum(e)},getNames:function(){return a.getNames()},sort:function(e){l.sort(e.type,e.up,e.curGname,e.gname,function(t){e.callback&&e.callback(t)})},getByName:function(e){return a.getByName(e)},isEmpty:function(e){return a.isEmpty(e)},unique:function(e,t){return a.unique(e,t)},sort:function(e,t,i,n){return a.sort(e,t,i,n)}},e.friend={beforeDelete:function(e,t){l.group.beforeDeleteFriend(function(t){e&&e(t)},function(){t&&t()})},del:function(e,t,i,n,s){l.group.deleteFriend(e,t,i,n,function(t){a.remove(e),s&&s(t)})},getById:function(e){return a.getById(e)},getByIds:function(e){return a.getByIds(e)},getComInfo:function(e,t){l.group.commonFri(e,function(e){t&&t(e)})},getFgroups:function(e){return s.getFgroups(e)}},e.special={saveDesc:function(e,t,i,n){specialOption.checkDesc(e,t)?l.special.saveDesc(e,t,function(n){specialOption.saveDesc(e,t),i&&i(n)}):n&&n()},del:function(e,t,i){l.special.remove(e,function(i){specialOption.remove(e),t&&t(i)},function(e){i&&i(e)})},add:function(e,t,i){var n=specialOption.getFids();n=n.concat(e),l.special.edit(n,function(i){specialOption.add(e),t&&t(i)},function(e){i&&i(e)})},getPosById:function(e){return specialOption.getById(e).pos},get:function(){return specialOption.get()},getFids:function(){return specialOption.getFids()},up:function(e,t,i,n){l.special.saveRank(i,function(i){specialOption.saveRank(e,t),n&&n(i)})},down:function(e,t,i,n){this.up(e,t,i,n)}},e.search=function(e,t){l.search(e,function(e){var i=o.normal(e.data);t&&t(i)})},e.isAddState=function(){},e.init=function(e){i(e)}}),define("friends/special",function(require,e){var t=require("jquery"),i=require("friends/util"),n=(require("friends/template"),require("friends/model")),a=i.dataSource,s={data:{},init:function(){this.flist=t("#friends-list-con"),this.fHead=t("#f_head-fn")},get:function(e,i){return s.data[e]&&0!==s.data[e].length||(s.data[e]=t(e,i)),s.data[e]}},o={showUpTip:function(){s.get(".special-up-tip",s.fHead).show()},hideUpTip:function(){s.get(".special-up-tip",s.fHead).hide()},showDownTip:function(){s.get(".special-down-tip",s.fHead).show()},hideDownTip:function(){s.get(".special-down-tip",s.fHead).hide()},switchPos:function(e,t){var i=n.special.getPosById(e),a=n.special.getPosById(t),s=n.special.getFids();return tmp=s[i],s[i]=s[a],s[a]=tmp,s}},r={inSpecialUp:function(e){var t;i.dataSource.isEdit()||(t=e.parent("div").parent("li"),0!==t.prev().length&&(e.addClass("hover-up"),o.showUpTip()))},outSpecialUp:function(e){i.dataSource.isEdit()||(e.removeClass("hover-up"),o.hideUpTip())},inSpecialDown:function(e){var t;i.dataSource.isEdit()||(t=e.parent("div").parent("li"),0!==t.next().length&&(e.addClass("hover-down"),o.showDownTip()))},outSpecialDown:function(e){i.dataSource.isEdit()||(e.removeClass("hover-down"),o.hideDownTip())},openEditDesc:function(e){var t,n;i.dataSource.isEdit()||(n=e.parent(),n.hide(),t=n.next(),t.children("textarea").val()==i.conf.defaultSpecialDesc&&t.children("textarea").val(""),t.show(),t.children("textarea").focus())},outSpecialDesc:function(e){var t,n;if(!i.dataSource.isEdit()){if(t=e.prev().text().trim(),n=e.find("textarea"),n.val().trim()!==t)return;e.hide(),e.prev().show()}},saveDesc:function(e){function t(){l.text(a),e.val(a),o.hide(),r.show()}var a=""==e.val()?i.conf.defaultSpecialDesc:e.val(),s=e.attr("data-id"),o=e.parent(),r=o.prev(),l=r.find(".special-desc-detail");return l.text().trim()===a?void t():void n.special.saveDesc(s,a,function(e){t(),i.alert("特别好友描述添加成功!")})},moveUp:function(e){var t,a=e.parent().parent(),r=a.prev(),l=a.attr("data-id"),d=r.attr("data-id");0!==r.length&&(t=o.switchPos(l,d),n.special.up(l,d,t,function(t){e.removeClass("hover-up"),s.get("#f_head-fn").hide(),a.insertBefore(r),i.alert("特别好友排序保存成功!")}))},moveDown:function(e){var t,a=e.parent().parent(),r=a.next(),l=a.attr("data-id"),d=r.attr("data-id");0!==r.length&&(t=o.switchPos(l,d),n.special.up(l,d,t,function(t){e.removeClass("hover-down"),s.get("#f_head-fn").hide(),a.insertAfter(r),i.alert("特别好友排序保存成功!")}))}},l={init:function(){s.flist.delegate(".special-up","mouseover",function(e){r.inSpecialUp(t(this))}).delegate(".special-up","mouseout",function(e){r.outSpecialUp(t(this))}).delegate(".special-up","click",function(e){a.get("editing")||(r.moveUp(t(this)),e.stopPropagation())}).delegate(".special-down","mouseover",function(e){r.inSpecialDown(t(this))}).delegate(".special-down","mouseout",function(e){r.outSpecialDown(t(this))}).delegate(".special-down","click",function(e){a.get("editing")||(r.moveDown(t(this)),e.stopPropagation())}).delegate(".special-desc-edit","click",function(e){t(e.target).hasClass("special-desc-edit")&&r.openEditDesc(t(this))}).delegate(".special-desc-input","blur",function(e){r.saveDesc(t(this))})}};e.init=function(){s.init(),l.init()}}),define("friends/suggest",function(require,e){function t(e){f.add=e.singleJoin,l=e.getById}var n=require("jquery"),a=(require("friends/log"),require("friends/template")),s=require("friends/util"),o=require("friends/ajax"),r=s.dataSource;require("ui/renren/relationFollow");var l,d=[s.conf.all,s.conf.nogroup,s.conf.special,s.conf.latest],c={
container:n("#group_suggest")},u={np:1,ps:4},f={},p={data:{length:0,friends:[]},load:function(){var e=r.get("curGroup");-1!==d.indexOf(e)?(e="",o.suggest.get(p.sFormat,p.error)):o.suggest.join(e,p.format,p.error)},format:function(e){var t,i="";e&&(t=e.recommend,t&&t.length>0?(p.data.length=t.length,p.data.friends=t,i=a.suggest.build(t,e.groupname),p.render(i),c.container.removeClass("suggest-container")):o.suggest.get(p.sFormat,p.error))},sFormat:function(e){var t,i="";e&&(t=e.data.list,t&&t.length?(p.data.length=t.length,p.data.friends=t,i=a.suggest.buildFriend(t),p.render(i),c.container.addClass("suggest-container")):p.error())},error:function(){p.data.length=0,p.data.friends.length=0,p.render("")},render:function(e){u.np=1,""==e?(c.container.hide(),c.container.html(e)):(c.container.html(e),c.container.show())}},h={joinGroup:function(e){var t,i=r.get("curGroup"),o=e.attr("data-id"),d=r.get("list"),c=l(o);f.add(i,o,function(i){0==i.code?(e.parent().remove(),t=a.friend.build([c],d),n("#friends-list-con").prepend(t)):s.alert()})},addFriend:function(e){require(["ui/renren/addfriend"],function(){e.renrenaddfriend({successAction:function(){e.parent().remove(),h.refreshCur()}}),e.trigger("click")})},next:function(){var e=n("#suggest-list-con li"),t=e.length,a=u.np*u.ps,s=a+u.ps,o=[];if(!(a>=t||0>a)){for(i=0;i<t;i++)i>=a&&i<s&&o.push(e[i]);e.hide(),n(o).show(),u.np+=1,s>=t&&n(".suggest-next",c.container).addClass("no_right"),n(".suggest-prev",c.container).removeClass("no_left")}},prev:function(){var e=n("#suggest-list-con li"),t=e.length,a=(u.np-2)*u.ps,s=a+u.ps,o=[];if(!(0>a||a>=t)){for(i=0;i<t;i++)i>=a&&i<s&&o.push(e[i]);e.hide(),n(o).show(),u.np-=1,0>=a&&n(".suggest-prev",c.container).addClass("no_left"),n(".suggest-next",c.container).removeClass("no_right")}},refreshCur:function(){var e=n("#suggest-list-con li"),t=e.length,a=(u.np-1)*u.ps,s=a+u.ps,o=[];if(0>a)return void c.container.hide();if(a>=t)return 0==t?(c.container.hide(),void p.load()):(u.np-=1,void h.refreshCur());for(i=0;i<t;i++)i>=a&&i<s&&o.push(e[i]);e.hide(),n(o).show(),n(".suggest-prev",c.container).removeClass("no_left"),n(".suggest-next",c.container).removeClass("no_right"),0>=a&&n(".suggest-prev",c.container).addClass("no_left"),s>=t&&n(".suggest-next",c.container).addClass("no_right")}},g={init:function(){c.container.delegate(".suggest-join","click",function(e){h.joinGroup(n(this))}).delegate(".add","click",function(e){h.addFriend(n(this))}).delegate(".suggest-prev","click",function(e){h.prev()}).delegate(".suggest-next","click",function(e){h.next()}),c.container.on("mouseover",".suggest-friend",function(e){var t=n(this).find(".suggest-add");t.renrenrelationFollow({addAction:function(e){t.removeClass("ui-button-green suggest_follow").addClass("colorgreen ui-button-default").html("已关注")},friendAction:function(){t.removeClass("ui-button-green add").addClass("ui-button-default sended").html('<span class="ui-button-text">申请中...</span>')},cancelAction:function(){t.removeClass("ui-button-default colorgreen").addClass("ui-button-green suggest_follow").html('<i class="ui-icon ui-iconfont" id="suggest_follow_add" id="">&#xe849;</i>关注好友')}})})}};e.init=function(e){t(e),g.init()},e.load=function(){p.load()}}),define("friends/smart_group",function(require,e){var t=require("jquery"),i=require("friends/template"),n=require("friends/util"),a=require("friends/ajax"),s={data:{},init:function(){this.smart=t("#group-smart-layer")},lazyInit:function(){this.con=t("#smart_list-func"),this.inE=t("#smart_list-in"),this.out=t("#smart_list-out")},get:function(e,i){return this.data[e]&&0!==this.data[e].length||(this.data[e]=t(e,i)),this.data[e]},reset:function(){var e;for(e in s.data)s.data.hasOwnProperty(e)&&delete s.data[e]}},o={data:{},get:function(e){return this.data[e]},set:function(e,t){this.data[e]=t}},r={init:function(){var e=f.getData(),t=i.smartGroup.build(e);s.smart.html(t).show(),this.load()},load:function(e){var t;void 0!==e?t=f.getByType(e):(t=f.getSmart(),0===t.length&&(t=f.getRecommend())),this.build(t)},build:function(e){var n;n=i.smartGroup.buildGroup(e),t("#smart_cate-list").html(n)},getName:function(){var e=this.getCur();return e.attr("data-name")},getCur:function(){return t("#smart_cate-list").find(".on")},getType:function(){var e,t=s.get("#smart_nav"),i=t.find(".on");return e=i.hasClass("smart")?"smarts":"recommend"},ajustNum:function(){var e=t("#smart_cate-list").find(".on"),i=e.attr("data-name"),n=f.getByName(i);e.find(".group-num").text(n.gnum)},rename:function(e){var i,a=this.getName();e=e.trim(),a!==e&&n.checkGroupName(e)&&(f.rename(a,e),i=t("#smart_cate-list").find(".on").attr("data-name",e),e=n.substring(e,6,"..."),i.find(".smart-group-name").text(e),s.get("#smart_cur-group").text(e))},create:function(){function e(e){return 0!==e.code?void n.alert("智能分组创建失败！请稍后重试"):(d.showOption({create:!1,created:!0,ignore:!1,ignored:!1,empty:!1}),f.setCreated(t),r._setCreated(),r.moveNext(),void(o.get("create")||o.set("create",!0)))}var t=this.getName(),i=this.getType(),s=f.getCheckedFids(t),l=null;return 0===s.length?void n.alert("亲，你没选择任何好友！"):void("recommend"===i?a.group.batchJoin(s,[t],1,function(t){e(t)}):(l={data:{gname:t,friends:s,type:"smart"}},a.smart.create(l,function(t){e(t)})))},createAll:function(){var e={data:[]},t=f.getSmart(),i=f.getRecommend();return this._get(t,e.data,"smart"),this._get(i,e.data,"recommend"),0===e.data.length?void n.alert("亲，你没选择任何好友！"):void a.smart.createAll(e,function(e){return 0!==e.code?void n.alert():(n.alert(e.msg||"一键分组成功！"),r._setCreated(!0),c.closeSmart(!0),void 0)})},_setCreated:function(e){e?s.get("#smart_cate-list").find(".group-num").text("已创建"):s.get("#smart_cate-list").find(".on").find(".group-num").text("已创建")},_get:function(e,t,i){var n,a,s,o;for(n=0,a=e.length;a>n;n++)e[n].created||(s=e[n].gname,o=f.getCheckedFids(s),t.push({friends:o,gname:s,type:i}))},ignore:function(){var e=this.getType(),t=this.getCur(),i=this.getName(),n=this;f.ignore(i,e),setTimeout(function(){n.moveNext(),t.remove()},1e3),d.showOption({created:!1,ignored:!0,ignore:!1,create:!1,empty:!1})},moveNext:function(){var e,i=this.getNext(),a=i.find,s=i.name;a?l.load(s):e=n.dialog({title:"提示",body:"<div>所有分组都已经创建！</div>",success:function(){c.closeSmart(),t(e).dialog("destroy")},error:function(){r.showEmpty()}})},getNext:function(){var e,i,n,a,s,o,r=this.getCur(),l=r.index(),d=r.siblings(),c=!1;for(d=t.makeArray(d),e=d.slice(0,l),e.length>0&&(d=d.concat(e)),i=l,n=d.length;n>i;i++)if(next=t(d[i]),s=next.data().name,o=f.getByName(s),!o.created){c=!0,a=s,r.removeClass("on"),next.addClass("on");break}return{find:c,name:a}},showEmpty:function(){s.option.hide(),s.get("#smart_friend-list").html("<li> 没有分组了</li>")}},l={data:{},loading:!1,all:!1,np:1,ps:15,len:function(){return l.data.friends.length},reset:function(){this.data={},this.np=1,this.all=!1},load:function(e){var t,i,n=e||r.getName(),a=r.getType(),s=f.getByType(a);for(this.reset(),t=0,i=s.length;i>t;t++)if(n==s[t].gname){this.data=s[t];break}this.build()},build:function(){var e,t="",n=(this.np-1)*this.ps,a=n+this.ps;if(this.loading=!0,d.hideEmpty(),!this.isEmpty()){if(n>this.len())return void(this.all=!0);e=this.data.friends.slice(n,a),t=i.smartGroup.buildFriend(e),this.np++}2===this.np?s.get("#smart_friend-list").html(t):s.get("#smart_friend-list").append(t),d.setCurGname(),c.cancelRename(),""===t?(s.get("#smart_cur-group").hide(),d.showEmpty(),d.showOption({created:!1,ignored:!1,ignore:!1,create:!1})):(this.setOption(),s.get("#smart_cur-group").show()),this.loading=!1},isEmpty:function(){return void 0===this.data.friends||0===this.data.friends.length},setOption:function(){var e=!0,t=!1,i=!0,n=!1,a=!1;this.data.created&&(t=!0,e=!1,i=!1),d.showOption({created:t,ignored:n,ignore:i,create:e,empty:a})},checked:function(e,t){var i,n=r.getName();i=f.checked(n,e,t),r.ajustNum(i)}},d={ajustLayer:function(){var e=t(window),i=e.width(),a=e.height(),s=0,o=100;i>720&&(s=(i-720)/2),a>500&&(o=(a-490)/2);var r=t("#smart-big");a>r.height()&&r.height(a),n.showDebugLog("friends_smart_group winWidth: "+i+"--winHeight: "+a+" ===="),t("#smart-container").css({left:s,top:o})},showEmpty:function(){s.get("#smart_empty").show()},hideEmpty:function(){s.get("#smart_empty").hide()},setCurGname:function(){var e=r.getName(),t=s.get("#smart_cur-group");t.text(e),t.next().val(e)},showOption:function(e){var i;void 0===s.option&&(s.option=t("#smart_option"),s.create=s.option.find(".smart-list-create"),s.ignore=s.option.find(".smart-list-ignore"),s.created=s.option.find(".cate-created"),s.ignored=s.option.find(".cate-ignore"),s.empty=s.option.find(".smart-empty"));for(i in e)e.hasOwnProperty(i)&&this.setShow(s[i],e[i])},setShow:function(e,t){t?e.show():e.hide()}},c={closeSmart:function(e){function i(){s.reset(),s.smart.hide()}var a;e||o.get("create")||0==f.getAllNum()?(i(),window.location.reload()):a=n.dialog({body:"<div>您没有创建任何分组，确定要退出智能分组吗？</div>",draggable:!0,modal:!0,width:500,height:187,success:function(){t(a).dialog("destroy"),i()},error:function(){}}).dialog({dialogClass:"smart"})},switchTab:function(e){var t;e.hasClass("on")||(e.addClass("on"),e.siblings().removeClass("on"),t=e.data().type,r.load(t),l.load())},switchGroup:function(e){e.hasClass("on")||(e.addClass("on"),e.siblings().removeClass("on"),l.load())},inFriend:function(e){var t=r.getName(),i=f.getByName(t);i.created||(clearTimeout(o.get("friendIn")),e.hasClass("disable")?(e.addClass("hover").siblings().removeClass("hover"),e.append(s.inE),s.con.append(s.out)):(e.addClass("hover-out").siblings().removeClass("hover-out"),e.append(s.out),s.con.append(s.inE)),e.find(".smart-li-cover").hide())},outFriend:function(e){var t=r.getName(),i=f.getByName(t);i.created||(clearTimeout(o.get("friendIn")),e.removeClass("hover").removeClass("hover-out"),o.set("friendIn",setTimeout(function(){s.con.append(s.out).append(s.inE),e.hasClass("disable")&&e.find(".smart-li-cover").show()},0)),e.find(".smart-li-cover").show())},clickFriend:function(e){var t,i=r.getName(),n=f.getByName(i);n.created||(t=e.attr("data-name"),e.hasClass("disable")?(e.removeClass("disable"),e.removeClass("hover").addClass("hover-out"),s.con.append(s.inE),e.append(s.out),l.checked(t,!0)):(e.addClass("disable"),e.removeClass("hover-out").addClass("hover"),s.con.append(s.out),e.append(s.inE),l.checked(t,!1)))},inGname:function(e){var i=s.get(".cate-rename"),n=t("#smart_cur-group"),a=n.text().trim(),r=f.getByName(a);clearTimeout(o.get("rename")),r.created||(i.show(),t(i[0]).focus(),n.hide())},outGname:function(){clearTimeout(o.get("rename")),o.set("rename",setTimeout(function(){var e=t(".cate-rename"),i=t("#smart_cur-group");e.val()===i.text().trim()&&(e.hide(),i.show())},200))},rename:function(e){var t=e.prev().val();r.rename(t),this.cancelRename()},cancelRename:function(){var e,i=r.getName();s.get("#smart_cur-group").show(),e=s.get(".cate-rename").hide()[0],t(e).val(i)},create:function(){r.create()},createAll:function(){r.createAll()},ignore:function(){r.ignore()},loadFriend:function(e){var t,i;l.loading||l.all||(i=e.scrollTop(),t=e.height(),40>t-i-337&&(l.loading=!0,l.build()))}},u={init:function(){this.smart(),this.scroll()},scroll:function(){t("#smart_friend-list").on("scroll",function(e){c.loadFriend(t(this))})},smart:function(){s.smart.delegate(".smart-close-icon","click",function(){c.closeSmart()}).delegate(".smart-nav","click",function(e){c.switchTab(t(this))}).delegate(".smart-group","click",function(e){c.switchGroup(t(this))}).delegate(".smart-detail","mouseover",function(e){c.inFriend(t(this))}).delegate(".smart-detail","mouseout",function(e){c.outFriend(t(this))}).delegate(".smart-detail","click",function(e){c.clickFriend(t(this)),e.preventDefault()}).delegate(".smart-cate-name","mouseover",function(e){c.inGname(t(this))}).delegate(".cate-rename","mouseout",function(e){c.outGname(t(this))}).delegate(".cate-rename","mouseover",function(e){c.inGname()}).delegate(".smart-rename-submit","click",function(e){c.rename(t(this))}).delegate(".smart-rename-cancel","click",function(e){c.cancelRename()}).delegate(".smart-list-create","click",function(e){c.create()}).delegate(".smart-list-ignore","click",function(e){c.ignore()}).delegate(".smart-close","click",function(){c.closeSmart()}).delegate(".smart-create","click",function(){c.createAll()})}},f={data:{},init:function(e){a.smart.getData(function(t){var i=t.data;return 0===i.groupNumber||i.friendsNumber<50?void n.showMsg("非常抱歉，暂时没有帮您找到可识别的智能分组~"):(f.data.recommend=i.recommend,f.data.smarts=i.smarts,f.parse(f.data.smarts,"smart"),f.parse(f.data.recommend,"recommend"),void e())})},parse:function(e,t){var i,n,a;for(i=0,n=e.length;n>i;i++)a=e[i],a.checked=!0,a.created=!1,a.ignore=!1,"recommend"===t&&(a.gnum=a.friends.length)},ignore:function(e,t){var i,n,a=this.getByType(t);for(i=0,n=a.length;n>i&&a[i].gname!==e;i++);a.splice(i,1),a.gnum--},checked:function(e,t,i){var n,a,s=this.getByName(e),o=s.friends;for(n=0,a=o.length;a>n;n++)if(o[n].fname===t){o[n].checked=i,i?s.gnum++:s.gnum--;break}return s.gnum},setCreated:function(e){var t=this.getByName(e);t.created=!0},getCheckedFids:function(e){var t,i,n=this.getByName(e),a=n.friends,s=[];for(t=0,i=a.length;i>t;t++)a[t].checked!==!1&&s.push(a[t].fid);return s},rename:function(e,t){var i=this.getByName(e);i.gname=t},getSmart:function(){return this.data.smarts},getRecommend:function(){return this.data.recommend},getAllNum:function(){var e=this.getSmart(),t=this.getRecommend();return e.length+t.length},getByName:function(e){var t,i,n=this.getSmart(),a=this.getRecommend(),s=n.concat(a);for(t=0,i=s.length;i>t;t++)if(s[t].gname===e)return s[t];return{friends:[]}},getByType:function(e){return this.data[e]},getData:function(){return this.data}};e.init=function(){var e=!0;o.get("init")||(e=!1,o.set("init",!0)),s.init(),f.init(function(t){r.init(),l.load(),d.ajustLayer(),e||(u.init(),s.lazyInit())})}}),define("friends/manage",function(require,e,t){var i=require("jquery"),n=require("friends/template"),a=require("friends/model"),s=require("friends/util"),o=require("friends/suggest"),r=require("friends/special"),l=require("friends/smart_group"),d=s.dataSource,c={cur:"",set:function(e){this.cur=e},get:function(){return this.cur},reset:function(){this.cur=""},isAdd:function(){return"add"===this.cur},isDel:function(){return"delete"===this.cur},isShift:function(){return"shift"===this.cur},isBatch:function(){return"batch"===this.cur}},u={data:{"special-init":!1},get:function(e){return this.data[e]},set:function(e,t){this.data[e]=t}},f={init:function(){this.gList=i("#groups-list-con"),this.listEmpty=i("#list-empty"),this.listEmptyFriend=i("#list-empty-friend"),this.loading=i("#list-loading"),this.flist=i("#friends-list-con"),this.sortCon=i("#sort-container"),this.rightPart=i("#friends_groups")},lazyInit:function(){this.body=i(document.body),this.headBar=i("#friend_head_bar"),this.manage=i("#f_manage-con"),this.check=i("#f_check"),this.gslist=i("#groups-selector-list"),this.gSelector=i("#group-selector"),this.search=i("#f_search"),this.searchInput=i("#f_search-content"),this.fHead=i("#f_head-fn"),this.fRemove=i(".x-to-hide",this.fHead),this.fSupTip=i(".special-up-tip",this.fHead),this.fSdownTip=i(".special-down-tip",this.fHead),this.fSremoveTip=i(".special-remove-tip",this.fHead),this.fSeditTip=i(".special-edit-desc-tip",this.fHead),this.fTip=i("#friends-common-tip"),this.fText=i("#friends-common-txt")},lazyAddDom:function(){},cache:{},get:function(e,t){return f.cache[e]&&0!==f.cache[e].length||(f.cache[e]=i(e,t)),f.cache[e]}},p={load:function(){var e=a.group.getAll();this.format(e)},format:function(e){var t=n.group.build(e);y.renderGroups(t),t=""},newGload:function(e){this.newGformat(e)},newGformat:function(e){var t=n.group.buildNewGroup(e);y.renderGroup(t)},buildList:function(){var e,t,i,s,o=c.isAdd(),r=d.get("curGroup");o?(e=a.group.getForAdd(),e=this._filterEmpty(e)):e=a.group.getNormal(),t=f.get("#f_group-edit-detail").find(".btn-group-choose"),i=t.children(".group-open")[0].innerHTML,s=n.group.buildList(e,o,r,i),f.get("#group_list-container").html(s).parent().show()},_filterEmpty:function(e){var t,i,n=[];for(t=0,i=e.length;i>t;t++)e[t].gnum&&n.push(e[t]);return n},buildTopItem:function(e){var t=n.group.buildTopItem(e);f.get("#group_list-container").append(t)},addSingle:function(e,t,i){var n=[t];s.isArray(e)||(e=[e]),a.group.add(e,n,function(e){p.adjustGnum(),i&&i(e)})},delSingle:function(e,t,i){var n=[t];a.group.del(e,n,function(e){p.adjustGnum(),i&&i(e)})},create:function(e,t,i,n){a.group.create(e,function(i){p.newGload(e),p.adjustGLi(),n?p.buildTopItem(e):w.renderCurGroup(e),t&&t(i)},function(e){i&&i(e)})},rename:function(e,t,i){var n=this;a.group.rename(e,t,function(){n.setCurName(t),i()})},dismiss:function(e,t){a.group.dismiss(e,function(){i("#groups-list-con").find(".on").remove(),w.renderCurGroup(s.conf.all),t()})},del:function(e){var t=d.get("curGroup"),i=g.getData();t!==s.conf.special?a.group.del(t,i,function(t){p._success(),p._remove(i),e()},function(e){s.alert(e.msg)}):a.special.del(i[0],function(t){return 0!=t.code?void s.alert(t.msg):(p._success(),p._remove(i),void e())},function(e){s.alert(e.msg)})},add:function(e){var t=d.get("curGroup"),i=g.getData();t!==s.conf.special?a.group.add([t],i,function(t){p._success(),e(),h.load(!0)},function(e){s.alert(e.msg)}):a.special.add(i,function(t){p._success(),e(),h.load(!0)},function(e){s.alert(e.msg)})},batch:function(e){var t=i("#f_packet-msg").text().trim(),n=g.getData();return"添加至分组"===t?void s.alert("请选择要添加的组"):void a.group.add([t],n,function(t){p._success(),p._adjustFriendLi(n),e()},function(e){s.alert(e.msg)})},shift:function(e){var t=d.get("curGroup"),n=g.getData(),s=i("#f_packet-msg").text().trim();a.group.shift(t,s,n,function(){p._success(),p._remove(n),e()})},_success:function(){this.adjustGnum(),s.alert("操作成功！")},_remove:function(e){var t,n=e.length;for(t=0;n>t;t++)i("#friendsli"+e[t]).remove()},setCurName:function(e){d.set("curGroup",e),this.setTopName(e),this.setCurGroupName(e)},setTopName:function(e){f.get("#f_group-name").text(e)},setTopNumber:function(e){f.get("#f_group-num").text(a.group.getNum(e))},setCurGroupName:function(e){var t=i("#groups-list-con").find(".on"),s=a.group.getByName(e),o=n.group.buildNew(s);t.replaceWith(i(o))},adjustGnum:function(){var e,t,n,s,o,r=i("#groups-list-con").find(".group");for(n=0,s=r.length;s>n;n++)t=i(r[n]),e=t.attr("data-name"),o=a.group.getNum(e),t.find(".group-num").html(o);this.setTopNumber(f.get("#f_group-name").text())},_adjustFriendLi:function(e){var t,n,o,r,l;for(o=0,r=e.length;r>o;o++)l=e[o],t=a.friend.getFgroups(l),n=t.length>0?t.join(" | "):s.conf.nogroup,n=s.substring(n,11,"..."),i("#friendsli"+l).find(".group-name-list").text(n)},adjustGLi:function(){var e,t,n=a.group.getNormal(),s=i("#groups-list-con").find(".normal-group"),o=n.length,r=f.get("#moregroups");if(o>4)if(r.show(),r.hasClass("less"))s.removeClass("excess");else for(e=0;o>e;e++)t=i(s[e]),e>=4?t.addClass("excess"):t.removeClass("excess");else s.removeClass("excess"),r.removeClass("less").hide()}},h={data:[],all:!1,load:function(t){y.hideEmpty(),y.showTopLoading(),void 0!==t&&(this.data=t===!0?a.group.get(d.get("curGroup")):t,d.set("np",1),e.load=function(){h.load()},this.all=!1,y.clearFriends()),this.format(t),d.get("editing")&&g.getData().length&&(y.keepSelected(),g.adjustCheckAll())},format:function(t){var i,a,o=d.get("np"),r=d.get("ps"),l=(o-1)*r,u=l+r,f=d.get("list"),p=!1;return d.get("curGroup")!==s.conf.special||c.isAdd()||(p=!0),a=this.data.slice(l,u),i=n.friend.build(a,f,p),y.hideTopLoading(),""===i&&1===o?(this.all=!0,void y.showEmpty()):(d.set("np",o+=1),y.renderFriends(i),i="",a.length=0,void e.after())},getData:function(){return this.data},getFids:function(){var e,t,i=[];for(e=0,t=this.data.length;t>e;e++)i.push(this.data[e].fid);return i},del:function(e){var t,n,s;n=a.friend.getById(e),s=n.fname,t=this.showDialog({success:function(){var t=i("#verify-code").val()||"",n=u.get("delete-friend-flag");h.requestDelete(e,s,n,t)},error:function(){}}).dialog({dialogClass:"delete"}),flag=this.beforeDelete(t,s)},requestDelete:function(e,t,n,o){a.friend.del(e,t,n,o,function(t){if(0==t.ret){var n=a.group.getNum(d.get("curGroup"));p.adjustGnum(),i("#friendsli"+e).remove(),0===n&&y.showEmpty()}else-1==t.ret?s.alert("验证码错误"):s.alert("删除好友失败!")})},beforeDelete:function(e,t){var i,o;a.friend.beforeDelete(function(a){o=a.code,1==o||0==o?(u.set("delete-friend-flag",o),i=n.friend.buildBeforeDelete(t,o),e.html(i)):(e("destroy"),s.showMsg())},function(){e("destroy"),s.showMsg()})},showDialog:function(e,t){var n;return require("ui/dialog"),n=i("<div>Loading</div>").dialog({title:t,modal:!0,draggable:!0,width:500,buttons:{"确定":function(t){t.stopPropagation(),e.success(),i(this).dialog("destroy")},"取消":function(t){t.stopPropagation(),i(this).dialog("destroy"),e.error()}}})},removeSpecial:function(e){function t(){i(o).dialog("destroy"),h.del(e)}var s,o,r=a.friend.getById(e),l=r.fname,d=n.special.remove(l),c="移除特别好友";o=i(d).dialog({title:c,modal:!0,draggable:!0,width:500,buttons:{"确定":function(n){n.stopPropagation(),h.requestRemoveSpecial(e),s.off("click",t),i(this).dialog("destroy")},"取消":function(e){e.stopPropagation(),i(this).dialog("destroy")}}}).dialog({dialogClass:"special-remove"}),s=i("#switch-del-friend"),s.one("click",t)},requestRemoveSpecial:function(e){a.special.del(e,function(t){var n;return 0!=t.code?void s.alert("移除特别好友失败"):(p.adjustGnum(),i("#friendsli"+e).remove(),n=a.group.getNum(d.get("curGroup")),void(0===n&&y.showEmpty()))},function(){})}},g={add:function(e){var t=a.friend.getById(e);this.model.add(e),this.view.add(t)},del:function(e){var t=a.friend.getById(e);this.model.del(e),this.view.del(t)},all:function(){var e,t=h.getData();e=this.model.all(t),this.view.all(e)},empty:function(){var e,t,i=h.getData();this.model.empty(i),e=this.model.getData(),t=a.friend.getByIds(e),this.view.empty(t)},submit:function(){this.model.submit(),this.view.reset()},cancel:function(){this.model.cancel(),this.view.reset()},reset:function(){this.model.reset(),this.view.reset()},getData:function(){return this.model.getData()},getNum:function(){return this.model.getData().length},adjustCheckAll:function(){this.view.adjustCheckAll()},model:{data:[],cache:{},all:function(e){var t,i,n,a=[];for(i=0,n=e.length;n>i;i++)e[i]&&(t=e[i].fid)&&this.add(t)&&a.push(e[i]);return a},empty:function(e){var t,i,n;for(i=0,n=e.length;n>i;i++)e[i]&&(t=e[i].fid)&&this.del(t)},add:function(e){return e=parseInt(e),this.cache[e]?void 0:(this.data.push(e),this.cache[e]=1,!0)},del:function(e){var t;return e=parseInt(e),this.cache[e]?(t=this.data.indexOf(e),this.data.splice(t,1),delete this.cache[e],!0):void 0},get:function(){return this.data},reset:function(){this.cache={},this.data.length=0,d.set("editing",!1)},submit:function(){this.reset()},cancel:function(){this.reset()},isEmpty:function(){return 0===this.data.length},getData:function(){return this.data},isAll:function(){var e,t,i,n,a=h.getData(),s=this.data.length;if(s<a.length)return!1;for(n=this.data,t=a.length-1;t>=0;t--)if(i=a[t].fid,e=n.indexOf(i),-1===e)return!1;return!0}},view:{open:function(){y.showCheckCon()},add:function(e){var t=n.check.build(e);y.appendFchecked(t),i("#friendsli"+e.fid).addClass("on"),this.update(),this.adjustCheckAll()},del:function(e){var t=e.fid;i("#friendsli"+t).removeClass("on"),i("#batch"+t).remove(),this.update(),this.adjustCheckAll()},all:function(e){var t;e.length;t=n.check.build(e),y.appendFchecked(t),i(".friend-detail").addClass("on"),this.update()},empty:function(e){var t;t=n.check.build(e),y.renderFchecked(t),i(".friend-detail").removeClass("on"),this.update()},update:function(e){var t=(f.get("#friends_selected"),g.model.getData());0===t.length?y.hideCheckCon():y.showCheckCon()},adjustCheckAll:function(){g.model.isAll()?f.check.addClass("on"):f.check.removeClass("on")},reset:function(){var e=f.get("#friends_selected");y.hideCheckCon(),y.renderFchecked(""),i(".friend-detail").removeClass("on"),f.check.removeClass("on"),e.removeClass("del-checked-flow")}}},m={mainFixed:!1,rightFixed:!1,isNeedFix:function(){return!0},isNeedScroll:function(){var e=h.getData(),t=d.get("ps");return e.length>t?!0:!1},fixTop:function(){var e;if(this.isNeedFix())return e=document.documentElement.scrollTop||f.body.scrollTop(),e>148||f.get("#frameFixedNav").hasClass("fix-app-nav")?f.get(".bd-content").addClass("first-nav-fixed"):f.get(".bd-content").removeClass("first-nav-fixed"),40>e?void(m.mainFixed&&(f.get("#friends-box").removeClass("top-fixed"),m.fixHeadBar(),m.mainFixed=!1)):void(m.mainFixed||(w.add("fix"),f.get("#friends-box").addClass("top-fixed"),m.fixHeadBar(),m.mainFixed=!0))},fixRight:function(){if(this.isNeedFix()){var e=document.documentElement.scrollTop,t=f.get("#group-container"),i=f.get("#friends-box"),n=i.height(),a=t.height();0==e&&(e=f.body.scrollTop());var s=f.get(".advert-box",f.rightPart),o=f.get("#group_suggest");if(10>e-a)return void(m.rightFixed&&(o.removeClass("friend-right-fixed"),s.removeClass("friend-right-fixed"),s.get(0).style.removeProperty?s.get(0).style.removeProperty("top"):s.get(0).style.removeAttribute("top"),o.get(0).style.removeProperty?o.get(0).style.removeProperty("top"):o.get(0).style.removeAttribute("top"),m.rightFixed=!1));n-e<s.height()+o.height()+5&&(o.css("top",120+(n-e-s.height()-o.height()-40)+"px"),s.css("top",parseInt(o.css("top"))+o.height()+25+"px")),m.rightFixed||(o.addClass("friend-right-fixed"),s.addClass("friend-right-fixed"),s.css("top",parseInt(o.css("top"))+o.height()+25+"px"),m.rightFixed=!0)}},fixHeadBar:function(){b.resizeMainContent()}},v={search:function(e,t,i){var n,o;switch(n="normal",t){case s.conf.all:t="",n="all";break;case s.conf.nogroup:t="",n="none";break;case s.conf.latest:t="",n="latest";break;case s.conf.special:t="",n="special"}o=[{t:"people",data:e},{t:"gid",data:t},{t:"gtype",data:n}],a.search(o,function(e){i(e)})}},y={renderGroups:function(e){f.gList.html(e),e=""},renderGroup:function(e){var t,n=i("#groups-list-con").find(".normal-group");t=0===n.length?f.get(".add",f.gList):i(n[0]),i(e).insertBefore(t)},renderFriends:function(e){f.flist.append(e),e=""},renderFchecked:function(e){f.get("#friends_selected").html(e)},appendFchecked:function(e){f.get("#friends_selected").append(e)},showEmpty:function(){d.get("search")?f.listEmpty.show():f.listEmptyFriend.show()},hideEmpty:function(){f.listEmpty.hide(),f.listEmptyFriend.hide()},showTopLoading:function(){f.loading.show()},hideTopLoading:function(){f.loading.hide()},clearFriends:function(){f.flist[0].innerHTML=""},resetBatch:function(){f.get(".reset","#f_group-edit-detail").hide()},showPacket:function(){f.get(".batch","#f_group-edit-detail").show()},setPackMsg:function(e){e=e||s.conf.packet,f.get("#f_packet-msg").html(e)},showFhead:function(){f.fHead.show()},hideFhead:function(){f.fHead.hide()},showFtip:function(){f.fTip.show()},hideFtip:function(){f.fTip.hide()},showGlist:function(){f.gSelector.show()},hideGlist:function(){f.gSelector.hide()},showCreateGlistOption:function(){f.get(".create-group-option").css("display","inline-block")},hideCreateGlistOption:function(){f.get(".create-group-option").hide()},showCreateGlist:function(){f.get(".create",f.gSelector).show()},hideCreateGlist:function(){f.get(".create").hide()},showCreateGlistLoading:function(){f.get(".loading",f.gSelector).show()},hideCreateGlistLoading:function(){f.get(".loading",f.gSelector).hide()},showGroupEdit:function(){f.get("#f_group-edit-detail").show()},hideGroupEdit:function(){f.get("#f_group-edit-detail").hide()},showSortCon:function(){f.sortCon.show(),u.set("state:sort-container",!0)},hideSortCon:function(){f.sortCon.hide(),u.set("state:sort-container",!1)},showCheckCon:function(){f.get("#f_checked-con").show()},hideCheckCon:function(){f.get("#f_checked-con").hide()},resetGroupList:function(){var e=f.choose;f.get("#group_list").hide(),e||(e=f.get("#f_group-edit-detail").find(".btn-group-choose"),f.choose=e),e.removeClass("choose-on")},closeEditOption:function(){var e="#group_edit-option:show",t=f.get("#group_edit-option");t.hide(),y.resetEditShow(),u.set(e,!1)},showEditChoose:function(e){var t,n,a,s,o,r=f.check;e=e||{},f.from?(n=f.from,a=f.to,s=f.choose,o=f.checkAll):(t=f.get("#f_group-edit-detail").children(),n=i(t[0]),a=i(t[1]),s=i(t[2]),o=i(t[4])),y.showGroupEdit(),e.from?n.show():n.hide(),e.to?a.show():a.hide(),e.choose?s.show():s.hide(),e.check?(r.show(),o.show()):(r.hide(),o.hide())},setEditMsg:function(e){f.get("#f_packet-msg").text(e)},setEditShow:function(){var e=d.get("curGroup"),t=s.conf.special;e===t?f.get("#group_edit-option").addClass("group-edit-special"):f.get("#group_edit-option").removeClass("group-edit-special")},resetEditShow:function(){f.get("#group_edit-option").removeClass("group-edit-special")},resetEdit:function(){c.reset(),f.get("#group_edit").removeClass("add delete shift"),y.showEditChoose({to:!1,from:!1,choose:!1,check:!1})},checkSpecial:function(){function e(e){var t=a.group.getNum(s.conf.special),i=nx.user.isvip,n=6,o=!1;return i&&(n=10),t+e>=n&&(i?(s.alert("您最多只能拥有10个特别好友!"),o=!0):(s.alert("您还不是VIP用户，最多只能拥有6个特别好友!"),o=!0)),o}var t,i=d.get("curGroup"),n=!1;return i===s.conf.special&&(t=g.getNum(),c.isDel()&&1===t?(s.alert(s.conf.deleteSpecial),n=!0):c.isAdd()&&(n=e(t))),n},showPhoto:function(){var e,t,n,a,s,o,r,l=!i.support.leadingWhitespace,c=i(".userheadimg");try{if(d.get("list"))c.each(function(){this.onload=null,e=i(this),e.css("display","block"),e.attr({src:e.attr("data-tinyurl"),height:"50",width:"50",onload:"photoAdjust(this,50,50)"})});else for(s=0,o=c.length;o>s;s++)a=c[s],e=i(a),t=e.attr("data-list"),"list"===t&&l?(r=new Image,n=i(r),r.onload=function(){this.onload=null,photoAdjust(this,168,150)},n.addClass("userheadimg large").attr({"data-tinyurl":e.attr("data-tinyurl"),"data-largeurl":e.attr("data-largeurl"),src:e.attr("data-largeurl")}),e.replaceWith(n)):e.attr({src:e.attr("data-largeurl"),height:"auto",width:"auto",onload:"photoAdjust(this,168,150)"}),a.complete&&photoAdjust(a,168,150)}catch(u){}},adjustGnames:function(e){var t,n=a.friend.getFgroups(e);s.showDebugLog("fgroups......"+n),t=n.join(" | "),t=s.substring(t,11,"..."),i("#friendsli"+e).children("div").children("span").html(t)},sort:function(e,t){var i=d.get("curGroup"),n=h.getData(),o=!1;i!==s.conf.special||c.isAdd()||(o=!0),n=a.group.sort(n,e,t,o),h.load(n)},keepSelected:function(){var e,t,n=g.getData();for(e=0,t=n.length;t>e;e++)i("#friendsli"+n[e]).addClass("on")},getGname:function(){var e=d.get("curGroup");c.get();return c.isAdd()&&(e=i("#f_packet-msg").text().trim()),e},createGlistGroup:function(e){var t,i,o=a.group.get(e);t=n.group.buildGlist([o],[e]),f.gslist.prepend(t),i=a.group.getNormal().length,i>s.conf.scrollLen&&f.gslist.addClass("over-scroll")},buildGlist:function(e){var t=a.group.getNormal(),i=a.friend.getFgroups(e),o="";o=n.group.buildGlist(t,i),f.gSelector.attr("data-id",e),t.length>s.conf.scrollLen?f.gslist.addClass("over-scroll"):f.gslist.removeClass("over-scroll"),f.gslist.html(o)},setGlistPos:function(e,t){var i=f.get("#friends-list").offset();f.gSelector.css({left:e-i.left,top:t-i.top})},loadFriend:function(e){var t=d.get("curGroup"),i=a.group.unique(e,t);h.load(i)}},b={scroll:function(){if(m.isNeedFix()&&(m.fixTop(),m.fixRight()),m.isNeedScroll()){var t=u.get("timer:scroll");clearTimeout(t),t=setTimeout(function(){e.func()}),u.set("timer:scroll",t)}},resizeMainContent:function(){var e=i(window).width(),t=i("#friends-box"),n=(i("#friend_head_bar_bg",t),t.parent()),a=i("#webpager");webpagerWidth=s.conf.includeWebpager&&!a.hasClass("fold")?a.width():0;var o=i("#nxSlidebar"),r=0==o.length?0:o.width(),l=e-r-webpagerWidth;if(leftWidth=s.conf.includeSlidebar?r:0,l>1280)n.addClass("resize-max").removeClass("resize-min"),t.css("margin-left",leftWidth+(l-t.width()-40)/2+"px");else if(1110>l){n.addClass("resize-min").removeClass("resize-max");var d=(l-t.width()-40)/2;t.css("margin-left",leftWidth+(20>d?20:d)+"px")}else n.removeClass("resize-max resize-min"),t.css("margin-left",leftWidth+(l-t.width()-40)/2+"px");
var c=i(".top-fixed #friend_head_bar_bg");c.length>0?(c.css("margin-left",0-parseInt(t.css("margin-left"))+"px"),c.css("padding-left",parseInt(t.css("margin-left"))+"px"),c.css("padding-right",parseInt(c.css("padding-left"))+"px")):f.get("#friend_head_bar_bg").attr("style","");var u=i(".top-fixed #friends-top");u.css("position","relative"),u.length>0?setTimeout(function(){u.css("position","fixed")},200):i("#friends-top").css("position","");var p=i(".right-fixed");p.length>0?(p.css("position","relative"),setTimeout(function(){p.css("position","fixed")},200)):i("#group_suggest").css("position","")},bodyClick:function(e){var t=i(e.target);(t.hasClass("panelbarbutton")||t.hasClass("wp-chat-close")||t.hasClass("wp-friend-ico"))&&i(".other-suggestor").css("left",i("#main").position().left+740+"px")},search:function(){var e,t=f.get("#f_search-content").val(),n=d.get("curGroup");""!==t?(d.set("search",!0),e=y.getGname(),v.search(t,e,function(e){c.isAdd()&&(e=a.group.unique(e,n)),h.load(e)})):(d.set("search",!1),c.isAdd()?(e=y.getGname(),y.loadFriend(e)):h.load(!0)),i("body, html").animate({scrollTop:0},1e3)},switchView:function(e){var t=f.get("#list_con_open"),i=f.get("#card_con_open");e.hasClass("list")&&!e.hasClass("on")?(d.set("list",!0),t.addClass("on"),i.removeClass("on"),y.showPhoto(),f.flist.addClass("list-on")):e.hasClass("card")&&!e.hasClass("on")&&(d.set("list",!1),t.removeClass("on"),i.addClass("on"),y.showPhoto(),f.flist.removeClass("list-on"))},showViewTip:function(e){e.hasClass("list")?f.get("#friends-list-tip").show():f.get("#friends-card-tip").show()},hideViewTip:function(e){e.hasClass("list")?f.get("#friends-list-tip").hide():f.get("#friends-card-tip").hide()},openSort:function(){var e=u.get("state:sort-container");e?y.hideSortCon():y.showSortCon()},sort:function(e){var t=e.attr("data-type"),i=!1,n=e.parent();n.hasClass("on")?e.hasClass("up")?e.addClass("down").removeClass("up"):(e.addClass("up").removeClass("down"),i=!0):(n.addClass("on"),e.hasClass("up")&&(i=!0)),n.siblings().removeClass("on"),y.sort(t,i)},checkAll:function(e){e.hasClass("on")?(e.removeClass("on"),g.empty()):(e.addClass("on"),g.all())},packet:function(){u.get("packet:show")?(y.hideGroupEdit(),y.resetBatch(),y.showPacket(),d.set("editing",!1),c.reset(),g.reset(),u.set("packet:show",!1)):(y.showGroupEdit(),y.resetBatch(),y.showPacket(),y.setPackMsg(),d.set("editing",!0),c.set("batch"),u.set("packet:show",!0))},openEditOption:function(){var e="#group_edit-option:show",t=u.get(e),i=f.get("#group_edit-option"),n=f.get(".btn-group-choose");t?(i.hide(),u.set(e,!1),n.removeClass("choose-on"),y.resetEditShow()):(i.show(),u.set(e,!0),n.addClass("choose-on"),y.setEditShow())},inEditOption:function(){var e="#group_edit-option:timer";clearTimeout(u.get(e))},outEditOption:function(){var e="#group_edit-option:timer",t="#group_edit-option:show",i=f.get("#group_edit-option");clearTimeout(u.get(e)),u.set(e,setTimeout(function(){i.hide(),u.set(t,!1),y.resetEditShow()},50))},showSelector:function(){function e(t){s.hide(),u.set(n,!1),f.choose.removeClass("choose-on"),o.off("click",e)}var t,n="#group_list:show",a=u.get(n),s=f.get("#group_list"),o=i(document.body);return f.get(".create-group-option",s).hide(),f.get(".create",s).show(),a?void e():(t=f.choose,createDiv=f.get(".create-group",s),t||(t=f.get("#f_group-edit-detail").find(".btn-group-choose"),f.choose=t),p.buildList(),t.addClass("choose-on"),u.set(n,!0),c.isAdd()?createDiv.hide():createDiv.show(),c.isBatch()?s.removeClass("edit-mem"):s.addClass("edit-mem"),void o.on("click",e))},inFriend:function(e){d.get("editing")?e.hasClass("on")||e.addClass("edit-hover"):(clearTimeout(u.get("friends-list-con:timer")),0===e.has("#f_head-fn").length&&e.prepend(f.fHead),y.showFhead(),e.addClass("hover"),e.siblings().removeClass("hover"))},outFriend:function(e){d.get("editing")?e.removeClass("edit-hover"):(clearTimeout(u.get("friends-list-con:timer")),u.set("friends-list-con:timer",setTimeout(function(){f.manage.append(f.fHead),y.hideFhead(),e.removeClass("hover")},0)))},checkFriend:function(e){var t;d.get("editing")&&(t=e.attr("data-id"),e.hasClass("on")?g.del(t):y.checkSpecial()||g.add(t))},removeFriend:function(e){var t=e.attr("data-id");d.get("curGroup")===s.conf.special?h.removeSpecial(t):h.del(t)},openSelector:function(e){var t,n,a=e.attr("data-id");y.buildGlist(a),y.showGlist(),t=i("#friendsli"+a),n=t.children(".friends-item-btn").offset(),y.setGlistPos(n.left,n.top),y.showCreateGlist(),y.hideCreateGlistOption(),y.hideCreateGlistLoading()},inCom:function(e){var t,i;b.inCom.timer=setTimeout(function(){t=e.attr("data-id"),i=a.friend.getById(t),i&&i.comf&&0!==i.comf&&""===f.fText.text()&&a.friend.getComInfo(t,function(e){f.fText.text(e.data),y.showFtip()})},300)},outCom:function(){clearTimeout(b.inCom.timer),f.fText.text(""),y.hideFtip()},clickGlist:function(e){var t=e.children(".icon").children(".gname").text(),i=f.gSelector.attr("data-id");t=t.trim(),e.hasClass("on")?p.delSingle(t,i,function(t){e.removeClass("on"),y.adjustGnames(i)}):p.addSingle(t,i,function(t){e.addClass("on"),y.adjustGnames(i)})},openGlistCreate:function(){f.get(".create",i("#group_list")).hide(),y.showCreateGlistOption()},openTopCreate:function(){i("#group_list").find(".create").hide(),y.showCreateGlistOption()},closeGlistCreate:function(){y.hideCreateGlistOption()},createGroupGlist:function(e){var t=f.gSelector.attr("data-id");y.hideCreateGlistOption(),y.hideCreateGlist(),y.showCreateGlistLoading(),p.create(e,function(i){a.group.add([e],[t],function(t){y.createGlistGroup(e),y.showCreateGlist(),y.hideCreateGlistLoading(),p._success(),h.load(!0)},function(e){y.showCreateGlistOption(),y.hideCreateGlist(),y.hideCreateGlistLoading(),s.alert(e.msg)})},function(){y.showCreateGlistOption(),y.hideCreateGlist(),y.hideCreateGlistLoading()})},outGselector:function(){var e;clearTimeout(u.get("timer:group-selector")),e=setTimeout(function(){f.gSelector.hide()},150),u.set("timer:group-selector",e)},inGselector:function(){clearTimeout(u.get("timer:group-selector"))},outSortCon:function(){var e;clearTimeout(u.get("timer:sort-container")),e=setTimeout(function(){y.hideSortCon()},150),u.set("timer:sort-container",e)},inSortCon:function(){clearTimeout(u.get("timer:sort-container"))},moreGroups:function(e){i(".group",f.gList).removeClass("excess"),e.addClass("less")},lessGroups:function(e){var t,n=0;i(".group",f.gList).each(function(){t=i(this),n++,n>8?t.addClass("excess"):t.removeClass("excess")}),e.removeClass("less")},switchGroup:function(e,t){w.renderCurGroup(e,t)},unchecked:function(e){var t=e.attr("data-id");g.del(t)},submitBatch:function(){function e(){g.submit(),y.resetEdit()}c.isAdd()?p.add(e):c.isShift()?p.shift(e):c.isDel()?p.del(e):c.isBatch()&&p.batch(e)},cancelBatch:function(){g.cancel(),y.resetEdit(),h.load(!0)},createGroup:function(){var e,t,a=n.group.buildCreate();e=s.dialog({draggable:!0,modal:!0,width:500,height:187,body:a,success:function(){var n=t.val();p.create(n,function(){i(e).dialog("destroy")},function(){})},error:function(){}}).dialog({dialogClass:"create"}),t=i("#dialog_group-name"),t.focus()},smartGroup:function(){l.init()},editGroup:function(e){var t,o,r,l,u,g=d.get("curGroup");if(w.update(),e.hasClass("rename"))t=n.group.buildRename(g),o=s.dialog({body:t,draggable:!0,modal:!0,width:500,height:180,success:function(){var e=u.val();p.rename(g,e,function(){i(o).dialog("destroy"),s.alert("操作成功！")})},error:function(){}}).dialog({dialogClass:"rename"}),u=i("#dialog_group-name").focus();else if(e.hasClass("add"))b.addMember();else if(e.hasClass("delete")){if(y.closeEditOption(),r=d.get("curGroup"),l=a.group.isEmpty(r),y.resetGroupList(),l)return y.resetEdit(),void s.alert("当前分组没有可删除成员");f.get("#group_edit").addClass("delete").removeClass("add shift"),r===s.conf.special?y.showEditChoose():y.showEditChoose({check:!0}),d.set("editing",!0),c.isAdd()&&(d.get("curGroup")==s.conf.special&&c.set("delete"),h.load(!0)),c.set("delete")}else if(e.hasClass("shift")){if(c.isAdd()&&h.load(!0),y.closeEditOption(),y.resetGroupList(),r=d.get("curGroup"),l=a.group.isEmpty(r))return y.resetEdit(),void s.alert("当前分组无可转移成员");f.get("#group_edit").addClass("shift").removeClass("add delete"),y.showEditChoose({to:!0,choose:!0,check:!0}),y.setEditMsg("请选择分组"),d.set("editing",!0),c.set("shift")}else e.hasClass("dismiss")&&(t=n.group.buildDismiss(),o=s.dialog({body:t,draggable:!0,modal:!0,width:500,height:187,success:function(){p.dismiss(g,function(){i(o).dialog("destroy"),s.alert("操作成功！")})},error:function(){}}).dialog({dialogClass:"dismiss"}))},checkGroup:function(e){var t=e.text().trim();e.hasClass("on")||(e.addClass("on"),e.siblings().removeClass("on")),y.setEditMsg(t),c.isAdd()&&y.loadFriend(t)},showRemoveSTip:function(){d.get("curGroup")===s.conf.special&&f.fSremoveTip.show()},hideRemoveSTip:function(){d.get("curGroup")===s.conf.special&&f.fSremoveTip.hide()},showEditDescTip:function(){f.fSeditTip.show()},hideEditDescTip:function(){f.fSeditTip.hide()},createTopGroup:function(e){var t=e.prev(),i=t.prev(),n=t.val().trim();p.create(n,function(n){e.hide(),t.hide().val(""),i.show()},function(){},!0)},addMember:function(){f.get("#group_edit").addClass("add").removeClass("shift delete"),y.closeEditOption(),y.resetGroupList(),d.get("curGroup")==s.conf.special?y.showEditChoose({from:!0,choose:!0,check:!1}):y.showEditChoose({from:!0,choose:!0,check:!0}),y.setEditMsg("全部好友"),d.set("editing",!0),c.set("add"),y.loadFriend(s.conf.all)}},C={init:function(){C.manage(),C.friend(),C.group()},lazyInit:function(){C.empty(),C.scroll(),C.friendGlist(),C.headBar(),C.search(),C.sort(),C.check(),C.editGroup(),C.topGroupList()},scroll:function(){var e=!!window.ActiveXObject,t=e&&!window.XMLHttpRequest;return t?void this.scrollIE6():(i(window).on({scroll:function(e){b.scroll()}}),void i(document).on("mainframe:reflow",function(){b.resizeMainContent()}))},scrollIE6:function(){i(window).on("scroll",function(){e.func()})},empty:function(){f.listEmptyFriend.delegate(".edit-group","click",function(){b.addMember()})},headBar:function(){f.headBar.delegate(".friend-manage-a","click",function(e){w.renderCurGroup(s.conf.all)})},search:function(){f.search.on("click",function(){w.add("search"),b.search()}),f.searchInput.on("keyup",function(e){13===e.keyCode?b.search():""==f.searchInput.val()&&b.search()})},manage:function(){f.manage.delegate(".view","click",function(e){var t=i(this);b.switchView(t)}).delegate(".view","mouseover",function(e){var t=i(this);b.showViewTip(t)}).delegate(".view","mouseout",function(e){var t=i(this);b.hideViewTip(t)}).delegate("#friend-sort","click",function(e){b.openSort(),w.add("sortCon")}).delegate(".check","click",function(e){var t=i(this);b.checkAll(t),w.add("check")}).delegate(".check-all","click",function(e){var t=i(this).prev();b.checkAll(t),w.add("check")}).delegate(".group-batch-edit-btn","click",function(e){w.add("batch"),w.add("choose"),b.packet()}).delegate(".group-edit-btn","click",function(e){e.stopPropagation(),b.openEditOption(),w.add("batch")}).delegate(".btn-group-choose","click",function(e){e.stopPropagation(),b.showSelector(),w.add("choose")}).delegate("#group_edit-option","mouseover",function(){b.inEditOption()}).delegate("#group_edit-option","mouseout",function(){b.outEditOption()})},editGroup:function(){f.get("#group_edit-option").delegate("a","click",function(e){b.editGroup(i(this)),w.add("editGroup"),w.add("batch"),e.stopPropagation()})},sort:function(){f.sortCon.delegate("a","click",function(e){w.add("sort"),b.sort(i(this))}).delegate(f.sortCon,"mouseover",function(e){b.inSortCon(i(this))}).delegate(f.sortCon,"mouseout",function(e){b.outSortCon(i(this))})},friend:function(){f.flist.delegate(".friend-detail","mouseover",function(e){e.stopPropagation(),b.inFriend(i(this))}).delegate(".friend-detail","mouseout",function(e){e.stopPropagation(),b.outFriend(i(this))}).delegate(".friend-detail","click",function(e){b.checkFriend(i(this)),w.add("check")}).delegate(".x-to-hide","click",function(e){e.stopPropagation(),b.removeFriend(i(this).parent("div").parent("li"))}).delegate(".friends-item-btn","click",function(e){var t=i(this),n=d.get("editing");n||t.hasClass("special-item-btn")||b.openSelector(t)}).delegate(".friends-com-info","mouseover",function(e){b.inCom(i(this))}).delegate(".friends-com-info","mouseout",function(e){b.outCom()}).delegate(".x-to-hide","mouseover",function(e){b.showRemoveSTip()}).delegate(".x-to-hide","mouseout",function(e){b.hideRemoveSTip()}).delegate(".special-desc-edit","mouseover",function(e){b.showEditDescTip()}).delegate(".special-desc-edit","mouseout",function(e){b.hideEditDescTip()}).delegate("a","click",function(e){d.get("editing")&&e.preventDefault()})},friendGlist:function(){f.gSelector.delegate(".group","click",function(e){b.clickGlist(i(this))}).delegate(".create","click",function(e){b.openGlistCreate()}).delegate(".submit","click",function(e){var t=i(this).prev().val().trim();b.createGroupGlist(t)}).delegate(f.gSelector,"mouseover",function(e){b.inGselector()}).delegate(f.gSelector,"mouseout",function(e){b.outGselector()})},topGroupList:function(){f.get("#group_list").delegate(".group","click",function(e){e.stopPropagation(),b.checkGroup(i(this))}).delegate(".create","click",function(e){e.stopPropagation(),b.openTopCreate()}).delegate(".submit","click",function(e){e.stopPropagation(),b.createTopGroup(i(this))}).delegate(".create-group-option","click",function(e){e.stopPropagation()})},check:function(){f.get("#f_checked-con").delegate(".selected-wrap","click",function(e){b.unchecked(i(this))}).delegate("#btn-batch-submit","click",function(e){b.submitBatch()}).delegate("#btn-batch-cancel","click",function(e){b.cancelBatch()})},group:function(){f.gList.delegate(".group","click",function(e){var t,n=i(this);(!n.hasClass("on")||d.get("search"))&&(t=n.attr("data-name"),b.switchGroup(t,n))}).delegate(".add","click",function(e){b.createGroup()}).delegate(".intellect","click",function(e){b.smartGroup()}).delegate(".more","click",function(e){var t=i(this);t.hasClass("less")?b.lessGroups(t):b.moreGroups(t)})}},w={renderCurGroup:function(e,t){w.init(),this.update(),i("body, html").animate({scrollTop:0},1e3),c.reset(),p.setTopName(e),p.setTopNumber(e),d.reset(),d.set("curGroup",e),h.load(!0),this.isInitSpecial(e),this.adjustEditBtn(),this.adjustShow(e,t),o.load()},isInitSpecial:function(e){e===s.conf.special&&(u.get("special-init")||(u.set("special-init",!0),r.init()))},adjustEditBtn:function(){var e=d.get("curGroup"),t=[s.conf.all,s.conf.latest,s.conf.nogroup],i=f.get("#group_edit"),n=f.get("#group_batch-edit");-1===t.indexOf(e)?(i.show(),n.hide()):(i.hide(),n.show())},adjustShow:function(e,t){var n,a,s,o=i(".group",f.gList),r=!1;if(void 0!==t)return t.addClass("on"),t.siblings().removeClass("on"),void(t.hasClass("excess")&&(f.get("#moregroups").addClass("less").show(),o.removeClass("excess")));for(a=0,s=o.length;s>a;a++)n=i(o[a]),r||n.attr("data-name")!==e?n.removeClass("on"):(n.hasClass("excess")&&(f.get("#moregroups").addClass("less").show(),o.removeClass("excess")),n.addClass("on"),r=!0)},init:function(){u.get("sortHtml")||u.set("sortHtml",f.sortCon.html())},changeData:[],map:{sort:"_resetSort",sortCon:"_resetSortCon",check:"_resetCheck",editGroup:"_resetEditGroup",search:"_resetSearch",batch:"_resetBatch",fix:"_resetFix",choose:"_resetChoose"},add:function(e){-1===this.changeData.indexOf(e)&&this.changeData.push(e)},reset:function(){this.changeData.length=0},update:function(){var e,t,i,n=this.changeData,a=this.map;for(t=0,i=n.length;i>t;t++)e=n[t],this[a[e]]();this.reset()},_resetSort:function(){var e=f.sortCon;e.html(u.get("sortHtml"))},_resetSortCon:function(){y.hideSortCon()},_resetEditGroup:function(){f.get("#group_edit").removeClass("add delete shift")},_resetCheck:function(){f.check.removeClass("on"),g.reset()},_resetSearch:function(){f.get("#f_search-content").val("")},_resetBatch:function(){var e="packet:show";u.set(e,!1),y.hideGroupEdit(),y.resetGroupList()},_resetFix:function(){f.get("#friends-box").removeClass("top-fixed"),m.fixHeadBar(!1)},_resetChoose:function(){y.resetGroupList()}},_={init:function(){require("ui/placeholder"),i("#f_search-content").placeholder({text:"寻找你想找的好友"})}};e.load=function(){},e.after=function(){e.func.loading=!1,e.after=function(){}},e.func=function(){var t,n,a;e.func.loading||h.all||(n=f.flist.height(),a=i(window).scrollTop(),t=i(window).height(),a+t+300>=n&&(e.func.loading=!0,e.after=function(){e.func.loading=!1,e.after=function(){}},e.load()))},e.func.loading=!1,e.init=function(e){i("#frameFixedNav li.fd-nav-item").each(function(){i(this).children("a")[0]&&"好友"==i(this).children("a")[0].innerHTML&&i(this).addClass("fd-nav-cur-item")}),2==e.data.kUserCommunityJudge&&l.init(),a.init(e.data),a.State=c,f.init(),f.lazyAddDom(),p.load(),b.resizeMainContent(),i(".bd-content").show(),w.renderCurGroup(s.conf.all),f.lazyInit(),C.init(),C.lazyInit(),o.init({singleJoin:p.addSingle,getById:a.friend.getById}),_.init()}}),define("friends/manage_main",function(require,e){function t(e){n.init(e)}var i=require("jquery"),n=require("friends/manage");e.init=function(e){i(document).ready(function(){t(e)})},window.photoAdjust=function(e,t,n){var a,s,o,r=i(e);r.attr("data-width")?(a=parseInt(r.attr("data-width")),s=parseInt(r.attr("data-height"))):(a=e.naturalWidth?e.naturalWidth:e.width,s=e.naturalHeight?e.naturalHeight:e.height),o=a/s,o>=t/n?(e.height=n,e.width=e.height*o):(e.width=t,e.height=e.width/o),r.hide(),r.css("visibility","visible"),r.show()}}),define("friends/add",function(require,e,t){var i,n,a,s,o,r,l,d,c,u,f=require("jquery"),p=require("friends/log"),h=require("friends/ajax"),g=require("friends/template"),m=require("friends/add_filter"),v=require("friends/util");require("ui/renren/relationFollow"),require("friends/manage_main"),i={init:function(){this.body=f(document.body),this.addMain=f(".bd-content .add-main"),this.listLoading=f("#list-loading"),this.listEmpty=f("#list-empty"),this.listBloading=f("#list-bottom-loading"),this.friendsList=f("#friends_con"),this.listCon=f("#friends_list_con"),this.listBottomLoading=f("#list-bottom-loading"),this.recommendEmpty=f("#recommend-empty"),this.emptyRecommendEmpty=f("#empty-recommend-empty"),this.friendsAddTop=f(".friends-list-top"),this.cardOpenBtn=f("#btn_con_card"),this.cardTip=f("#friends_card_tip"),this.listOpenBtn=f("#btn_con_list"),this.listTip=f("#friends_list_tip"),this.removeBtn=f(".x-to-hide"),this.commonFriCount=f(".friends-com-info"),this.commonFri=f(".friends-common-fri-tip"),this.addFriendBtn=f("#friends_list_con .add"),this.filterBox=f("#friends_condition_items .friends-filter-box")},userHeadImg:".user-head-img",lazyLoad:function(){this.fHeadFn=f("#friend-head-fn"),this.fRemove=this.fHeadFn.children(".x-to-hide"),this.fRemoveTip=this.fHeadFn.children(".x-to-hide-tips3"),this.fRemoveSTip=this.fHeadFn.children(".x-to-hide-tips2"),this.fSelect=this.fHeadFn.children(".d-to-select"),this.fCommonTip=f("#friends-common-tip"),this.fCommonTxt=f("#friends-common-txt")},lazyAddDom:function(){f("#friend_head_bar").after(f('<div class="clearfix"></div>'))},cache:{},addFriCache:{},get:function(e,t){return i.cache[e]&&0!==i.cache[e].length||(i.cache[e]=f(e,t)),i.cache[e]}},e.post={np:1,ps:24,total:300},n={showPhoto:function(){2===e.post.np?n.showPhoto_BackUp():c.load(!0)},showPhoto_BackUp:function(){var e;if(i.listOpenBtn.hasClass("btn-list-open"))f(i.userHeadImg).each(function(){e=f(this),e.removeClass("large").addClass("tiny").css("display","block"),e.attr({src:e.attr("data-tinyUrl"),height:"50",width:"50",onload:"photoAdjust(this,50,50)"})});else{var t=!1;f(i.userHeadImg).each(function(){e=f(this),e.removeClass("tiny").addClass("large"),e.attr({src:e.attr("data-largeUrl"),height:"auto",width:"auto",onload:"photoAdjust(this,168,150)"}),t&&this.complete&&window.photoAdjust(this,166,166)})}},showListTip:function(e){e.attr("id")===i.cardOpenBtn.attr("id")?i.cardTip.show():e.attr("id")===i.listOpenBtn.attr("id")&&i.listTip.show()},hideListTip:function(e){e.attr("id")===i.cardOpenBtn.attr("id")?i.cardTip.hide():e.attr("id")===i.listOpenBtn.attr("id")&&i.listTip.hide()},showTopLoading:function(){i.listLoading.show()},hideTopLoading:function(){i.listLoading.hide()},showEmpty:function(){i.recommendEmpty.hide(),i.listEmpty.show()},showRecommendEmpty:function(){i.listEmpty.hide(),i.recommendEmpty.show(),n.hideGetMore()},hideEmpty:function(){i.listEmpty.hide(),i.emptyRecommendEmpty.hide(),i.recommendEmpty.hide()},showGetMore:function(){i.listBloading.removeClass("no-more").html('<a href="#nogo">网络异常，请点击重试</a>').show()},showBottomLoading:function(){i.listBloading.removeClass("no-more").html("正在加载...").show()},showDoneMore:function(){i.listBloading.addClass("no-more").html("没有更多用户").show()},showNoMore:function(){i.listBloading.removeClass("no-more").html('没有想找的人？试试 <a href="http://browse.renren.com/s/all#qt=/tindex=2">寻找好友</a>').show()},hideGetMore:function(){i.listBloading.hide()},clearListCon:function(){i.listCon.html("")},appendToCon:function(e){i.listCon.append(e)},renderListCon:function(e,t,i){n.appendToCon(e),t?n.showBottomLoading():(n.showNoMore(),r.noMore())},resizeMainContent:function(){var e;window.innerWidth?e=window.innerWidth:document.body&&document.body.clientWidth&&(e=document.body.clientWidth);var t=f("#webpager"),n=v.conf.includeWebpager&&!t.hasClass("fold")?t.width():0,a=f("#nxSlidebar"),s=0==a.length?0:a.width(),o=v.conf.includeSlidebar?s:0,r=e-s-n;if(v.showDebugLog("contentWidth : "+r+"===="),r>=1088)i.addMain.removeClass("size-small"),i.addMain.css("margin-left",o+(r-i.addMain.width()-40)/2+"px");else if(r>=899)i.addMain.addClass("size-small"),i.addMain.css("margin-left",o+(r-i.addMain.width()-40)/2+"px");else{i.addMain.addClass("size-small");var l=(r-i.addMain.width()-40)/2;i.addMain.css("margin-left",o+(20>l?20:l)+"px")}var d=f(".top-fixed #friend_head_bar_bg");d.length>0?(d.css("margin-left",0-parseInt(i.addMain.css("margin-left"))+"px"),d.css("padding-left",parseInt(i.addMain.css("margin-left"))+"px"),d.css("padding-right",parseInt(d.css("padding-left"))+"px"),d.width(i.get("#frameFixedNav").width()-parseInt(d.css("padding-left")))):i.get("#friend_head_bar_bg").attr("style","")}},a={friendsMouseover:function(e){var t=f(e);t.attr("data-id");t.addClass("hover"),0===t.children("#friend-head-fn").length&&t.prepend(i.fHeadFn),i.fHeadFn.show()},friendsMouseout:function(e){i.friendsList.append(i.fHeadFn),i.fCommonTxt.html("")},listToggle:function(e){""!=i.listCon.html()&&(e.attr("id")==i.cardOpenBtn.attr("id")&&e.hasClass("btn-card-close")?(e.removeClass("btn-card-close").addClass("btn-card-open"),i.listOpenBtn.removeClass("btn-list-open").addClass("btn-list-close"),i.listCon.addClass("detail-card-on").removeClass("detail-list-on"),n.showPhoto()):e.attr("id")==i.listOpenBtn.attr("id")&&e.hasClass("btn-list-close")&&(e.removeClass("btn-list-close").addClass("btn-list-open"),i.cardOpenBtn.removeClass("btn-card-open").addClass("btn-card-close"),i.listCon.addClass("detail-list-on").removeClass("detail-card-on"),n.showPhoto()))},showRemoveTip:function(e){i.fRemoveTip.show(),p.logRcd({actionTag:"hover",targetTag:"result_ban",sourceTag:"suggestion"})},hideRemoveBtn:function(e){i.fRemove.hide()},hideRemoveTip:function(e){i.fRemoveTip.hide()},showCommonFriTimer:null,showCommonFri:function(e){-1!=f(e).html().indexOf("共同好友")&&(this.showCommonFriTimer=setTimeout(function(){var t=f(e).attr("data-com");parseInt(t)>0&&u.showCommonInfo(e);var i=""!=f(e).attr("data-type")?"suggestion":"search";p.logRcd({actionTag:"hover",targetTag:"result_mutual",sourceTag:i})},300))},hideCommonFri:function(e){clearTimeout(this.showCommonFriTimer),i.fCommonTip.hide()},removeFri:function(e){var t=f(e),i=t.attr("data-id"),n=t.attr("data-type");h.addFriends.removeRecommend(i,n,function(t){l.fetchNewRecommend(e)},function(e){v.showDebugLog("removeRecommend Error!!!")}),p.logRcd({actionTag:"click",targetTag:"result_ban",sourceTag:"suggestion"})},scroll:function(){e.func(),s.fixTop(),s.fixRight()}},s={isTopFixed:!1,isRightFixed:!1,fixTop:function(){var e=document.documentElement.scrollTop||i.body.scrollTop();i.get("#frameFixedNav").hasClass("fix-app-nav")||e>150?i.get(".bd-content").addClass("first-nav-fixed"):i.get(".bd-content").removeClass("first-nav-fixed"),40>e?s.isTopFixed&&(i.addMain.removeClass("top-fixed"),s.isTopFixed=!1):s.isTopFixed||(i.addMain.addClass("top-fixed"),s.isTopFixed=!0),n.resizeMainContent()},fixRight:function(){var e=document.documentElement.scrollTop||document.body.scrollTop,t=i.get(".advert-box"),n=i.filterBox.height(),a=i.addMain.height();10>e-n||a-e<t.height()+5?s.isRightFixed&&(t.removeClass("friend-right-fixed"),s.isRightFixed=!1):s.isRightFixed||(t.addClass("friend-right-fixed"),s.isRightFixed=!0)}},o={mouseover:{"x-to-hide":"showRemoveTip","friends-com-info":"showCommonFri"},click:{"x-to-hide":"removeFri"}},r={bindFriends:function(){function e(){clearTimeout(t),t=null}i.friendsAddTop.delegate("a","click",function(e){e.stopPropagation(),a.listToggle(f(this))}),i.friendsAddTop.delegate("a","mouseover",function(e){n.showListTip(f(this))}),i.friendsAddTop.delegate("a","mouseout",function(e){n.hideListTip(f(this))});var t;i.listCon.delegate("li.recommend-detail","mouseover",function(t){f(this).css("z-index",1).siblings("li").css("z-index",0),e(),a.friendsMouseover(this);var i=f(t.target);for(var n in o.mouseover)i.hasClass(n)&&a[o.mouseover[n]](this)}).delegate("li.recommend-detail","mouseout",function(i){i.stopPropagation(),f(this).attr("z-index",0),f(this).removeClass("hover"),e(),t=setTimeout(function(){a.friendsMouseout()},50)}).delegate("li.recommend-detail","click",function(e){var t=f(e.target);for(var i in o.click)t.hasClass(i)&&a[o.click[i]](this)}),i.listCon.delegate(".x-to-hide","mouseout",function(e){a.hideRemoveTip(this)}),i.listCon.delegate(".friends-com-info","mouseout",function(e){a.hideCommonFri(this)}),i.listCon.on("mouseover",".friends-item-btn",function(){var e=f(this).find(".add");e.renrenrelationFollow({addAction:function(t){e.removeClass("ui-button-green add").addClass("ui-button-default followed").html('<span class="ui-button-text">已关注</span>')},friendAction:function(){e.removeClass("ui-button-green add").addClass("ui-button-default sended").html('<span class="ui-button-text">申请中...</span>')},cancelAction:function(){e.removeClass("ui-button-default followed").addClass("ui-button-green add").html('<span class="ui-icon ui-iconfont">&#xe849;</span><span class="ui-button-text">关注好友</span>')}})})},getMore:function(){f(window).bind("scroll",a.scroll)},noMore:function(){i.listBloading.undelegate("a","click"),e.load=function(){}},bindScroll:function(){f(window).bind("scroll",a.scroll)},bindWindowResize:function(){f(document).on("mainframe:reflow",function(){n.resizeMainContent()})}},l={data:[],buildPost:function(t){return t&&(m.getFilterCondition(),e.post.np=1),"uid="+nx.user.id+"&limit="+e.post.ps+"&type=WEB_FRIEND&p="+(e.post.np-1)},load:function(t,i,a){var s=1==arguments[0]?!0:!1,o=l.buildPost(s);return n.hideEmpty(),s||0==l.data.list.length?(n.clearListCon(),n.showTopLoading(),h.addFriends.recommend(o,function(e){l.firstFormat(e),s&&i&&i()},function(e){l.error(e),a&&a()}),void(e.load=function(){l.load()})):(n.showBottomLoading(),void h.addFriends.recommend(o,l.format,l.error))},firstFormat:function(t){n.hideTopLoading();var a="",s=i.cardOpenBtn.hasClass("btn-card-close")?!0:!1;if(t&&t.data&&t.data.list){l.data=t.data;var o=(e.post.np-1)*e.post.ps,r=o+e.post.ps;a=g.addFriends.recommemdBuild(l.data.list,o,r,s)}return n.clearListCon(),""==a?void n.showRecommendEmpty():(n.renderListCon(a,"true"==t.more,!0),e.post.np+=1,e.after(),void p.logRcd({actionTag:"load",targetTag:"result_retrieve",sourceTag:"suggestion"}))},format:function(t){var a="",s=i.cardOpenBtn.hasClass("btn-card-close")?!0:!1,o=t.data;if(o&&o.list){var l=0,d=e.post.ps;a=g.addFriends.recommemdBuild(o.list,l,d,s)}return""==a?(n.showNoMore(),void r.noMore()):(n.renderListCon(a,"true"==t.more),e.post.np+=1,void e.after())},fetchNewRecommend:function(e){f(e).remove()},error:function(t){1==e.post.np&&(n.hideTopLoading(),n.clearListCon()),n.showRecommendEmpty()}},d={load:function(){var e=c.buildPost(!0);e="uid="+nx.user.id+"&limit=60&type=WEB_FRIEND&p=0",h.addFriends.emptyRecommend(e,d.format,d.error)},format:function(e){var t="",a=i.cardOpenBtn.hasClass("btn-card-close")?!0:!1;e&&e.data&&e.data.list&&null!=e.data.list&&"null"!=e.data.list&&(t=g.addFriends.recommemdBuild(e.data.list,0,e.data.list.length,a)),""==t?(n.clearListCon(),n.showRecommendEmpty()):n.appendToCon(t),n.hideGetMore(),r.noMore(),p.logRcd({actionTag:"load",targetTag:"result_retrieve",sourceTag:"suggestion"})},error:function(){n.showRecommendEmpty()}},c={data:[],buildSchool:function(e){return m.post.people&&e.push(['{"t":"people","name":"'+m.post.people+'"}']),m.post.elem&&e.push(['{"t":"elem","name":"'+m.post.elem+'"}']),m.post.junior&&e.push(['{"t":"juni","name":"'+m.post.junior+'"}']),m.post.high&&e.push(['{"t":"high","name":"'+m.post.high+'"}']),m.post.techHigh&&e.push(['{"t":"college","name":"'+m.post.techHigh+'"}']),m.post.work&&e.push(['{"t":"work","name":"'+m.post.work+'"}']),e},buildUniv:function(e){return m.post.univ.name&&(e=e||{},e.name=m.post.univ.name),m.post.univ.id&&(e=e||{},e.id=m.post.univ.id),m.post.univ.depart&&(e=e||{},e.depart=m.post.univ.depart),m.post.univ.year&&(e=e||{},e.year=m.post.univ.year),e},buildBase:function(e){return m.post.base.gend&&(e=e||{},e.gend=m.post.base.gend),m.post.base.prov&&(e=e||{},e.prov=m.post.base.prov),e},buildPost:function(t){t&&(m.getFilterCondition(),e.post.np=1);var i=[];i=c.buildSchool(i);var n=null;n=c.buildBase(n),n&&(n.t="base",i.push([JSON.stringify(n)])),m.post.age.range&&i.push(['{"t":"age","range":"'+m.post.age.range+'"}']);var a=null;a=c.buildUniv(a),a&&(a.t="univ",i.push([JSON.stringify(a)])),v.showDebugLog("search keycode:: "+i);var s=f("#circleVal").val();if(0==i.length&&!s)return"";var o="";return i.length>0&&(o="p="+encodeURIComponent("["+i.join(",")+"]")),s&&(o+=(o?"&":"")+"ids="+encodeURIComponent("["+s+"]")),o+=m.post.isShowFriend?(o?"&":"")+"ss=1":""},load:function(t){var i=arguments[0]===!0?!0:!1,a=c.buildPost(i);return 0==a.length?void l.load(!0):(n.hideEmpty(),i||0==c.data.length?(n.showTopLoading(),h.addFriends.search(a,c.firstFormat,c.error),void(e.load=function(){c.load()})):(n.showBottomLoading(),void c.format(c)))},firstFormat:function(t){n.hideTopLoading();var a="",s=i.cardOpenBtn.hasClass("btn-card-close")?!0:!1;if(t&&t.data&&t.data.list){c.data=t.data;var o=(e.post.np-1)*e.post.ps,r=o+e.post.ps;a=g.addFriends.recommemdBuild(c.data.list,o,r,s,!0)}return n.clearListCon(),""==a?(n.showEmpty(),void d.load()):(n.renderListCon(a,c.more="true"),e.post.np+=1,e.after(),void p.logRcd({actionTag:"load",targetTag:"result_retrieve",sourceTag:"search"}))},format:function(t){var a="";if(t&&t.data&&t.data.list){var s=i.cardOpenBtn.hasClass("btn-card-close")?!0:!1,o=(e.post.np-1)*e.post.ps,l=o+e.post.ps;a=g.addFriends.recommemdBuild(t.data.list,o,l,s,!0)}return""==a?(n.showNoMore(),void r.noMore()):(n.renderListCon(a,"true"==t.more),e.post.np+=1,void e.after())},error:function(){1==e.post.np&&(n.hideTopLoading(),n.clearListCon()),n.showGetMore(),i.listBloading.undelegate("a","click")}},u={load:function(e){var t=f(e).attr("data-id");h.addFriends.commonFri(t,function(e){if(0==e.code){u.cache[t]=e.data;var n=i.fHeadFn.parent("li");n&&n.attr("data-id")==t&&i.fCommonTxt.html(e.data)}},function(){})},cache:{},showCommonInfo:function(e){var t=f(e).attr("data-id");u.cache[t]?(i.fCommonTxt.html(u.cache[t]),i.fCommonTip.show()):(i.fCommonTxt.html("加载中..."),i.fCommonTip.show(),u.load(e))}},e.load=function(){},e.after=function(){e.func.loading=!1,e.after=function(){}},e.func=function(){if(1!=e.func.loading){var t=i.friendsList.height()-f(window).scrollTop()-f(window).height();250>t&&(e.func.loading=!0,e.after=function(){e.func.loading=!1,e.after=function(){}},e.load())}},e.func.loading=!1,e.init=function(){m.init(c,function(){
f("#frameFixedNav li.fd-nav-item").each(function(){f(this).children("a")[0]&&"好友"==f(this).children("a")[0].innerHTML&&f(this).addClass("fd-nav-cur-item")}),i.init(),i.lazyAddDom(),n.resizeMainContent(),f("#add_main").show(),v.showDebugLog("begin recommend load ===="),l.load(!0,function(){r.bindFriends(),r.bindScroll(),r.bindWindowResize(),v.showDebugLog("success recommend load ====")},function(e){r.bindFriends(),r.bindScroll(),r.bindWindowResize(),v.showDebugLog("fail recommend load =====")}),i.friendsList.append(f(g.addFriends.buildManageFriendsShade())),i.lazyLoad()})}}),define("friends/add_filter",function(require,e,t){var i=require("jquery"),n=require("friends/log"),a=require("friends/ajax"),s=require("friends/template"),o=require("friends/circle"),r=require("friends/add_school"),l=require("friends/util"),d={init:function(){this.filter=i("#friends_condition_items"),this.allItems=i("#friends_condition_items .li-list li.item"),this.allSuggestBox=i("#friends_condition_items .li-list .suggest-box"),this.keyword=i("#keyword"),this.circleVal=i("#circleVal"),this.company=i("#company"),this.elementary=i("#elementary"),this.homeProvince=i("#homeProvince"),this.junior=i("#junior"),this.techHigh=i("#tech"),this.high=i("#high"),this.univ=i("#univ"),this.univ_id=i("#univ_id"),this.univ_dept=i("#univ_dept"),this.univ_year=i("#univ_year"),this.age_stage=i("#age_stage"),this.gend=i("#gend"),this.scompany_box=i("#scompany_box"),this.suniv_box=i("#suniv_box"),this.suniv_box_radio=i("#suniv_box .input-radio"),this.shigh_box=i("#shigh_box"),this.sjunior_box=i("#sjunior_box"),this.is_friend=i("#is_friend"),this.is_friend_container=i(".item-container2"),this.menuOptions=i("#friends_condition_items .menu"),this.foldItems=i("#friends_condition_items .item-fold"),this.conditionItems=i("#friends_condition_items .condition-item"),this.valueInputs=i("#friends_condition_items .value-input"),this.valueOptions=i("#friends_condition_items .value-option"),this.valueSelects=i("#friends_condition_items .value-select"),this.optionsLi=i("#friends_condition_items .options"),this.relationTitle=i("#friends_condition_items .relation-title"),this.conditionTitle=i("#friends_condition_items .condition-title"),this.tipCircle=i("#friends_condition_items .filter-circle-tips"),this.tipClear=i("#friends_condition_items .filter-clear-tips")}};e.post={people:"",circle:"",work:"",elem:"",juni:"",univ:{id:"",depart:"",name:"",year:""},age:{range:""},high:"",techHigh:"",base:{gend:"",prov:""},birt:{astr:""},isShowFriend:!1},e.search=function(){};var c={loadInfo:function(){var e=arguments[0]||function(){};a.addFriends.userInfo(function(t){c.format(t),e()},c.error)},format:function(e){var t="";return e&&e.data?(t=s.buildFilter(e.data),void this.render(t)):void c.error()},error:function(){var e=s.buildFilter({"default":"c",company:null,univ:null,high:null,junior:null});this.render(e)},render:function(e){i("#friends_condition_items .friends-filter-box").html(e),i(".filter-expand").removeClass("less").addClass("more")}},u=function(e){var t="default";switch(e){case"keyword":t="name";break;case"gend":t="gender";break;case"age_stage":t="age";break;case"company":t="work";break;case"univ":t="university";break;case"univ_year":t="entranceyear";break;case"univ_dept":t="department";break;case"high":t="highschool";break;case"techHigh":t="tekschool";break;case"junior":t="junior";break;case"elementary":t="primary";break;case"homeProvince":t="hometown"}return t},f={getFilterCondition:function(){e.post.people=d.keyword.val()==d.keyword.attr("default-value")?"":d.keyword.val(),e.post.circle=d.circleVal.val(),d.techHigh&&(e.post.techHigh=d.techHigh.val()==d.techHigh.attr("default-value")?"":d.techHigh.val()),d.elementary&&(e.post.elem=d.elementary.val()==d.elementary.attr("default-value")?"":d.elementary.val()),d.high&&(e.post.high=d.high.val()==d.high.attr("default-value")?"":d.high.val()),d.junior&&(e.post.junior=d.junior.val()==d.junior.attr("default-value")?"":d.junior.val()),d.company&&(e.post.work=d.company.val()==d.company.attr("default-value")?"":d.company.val()),e.post.age.range=d.age_stage.attr("data-value"),e.post.base.prov=d.homeProvince.attr("data-value"),e.post.base.gend=d.gend.attr("data-value");var t=d.univ,i=d.suniv_box;d.suniv_box_radio.hasClass("selected")?(e.post.univ.name=i.attr("data-name"),e.post.univ.id=i.attr("data-id"),e.post.univ.year=i.attr("data-year"),e.post.univ.depart=i.attr("data-dept")):t.length>0&&(e.post.univ.name=t.val()==t.attr("default-value")?"":t.val(),e.post.univ.id=d.univ_id.val(),e.post.univ.year=d.univ_year.attr("data-value"),e.post.univ.depart=d.univ_dept.attr("data-value")),e.post.isShowFriend=!d.is_friend.hasClass("checked")},clearFilterCondition:function(e){i(e).css("display","none");var t=i(e).attr("union"),a=i("#"+t);if(a){a.attr("default-value")?"INPUT"==a[0].tagName?a.val(a.attr("default-value")):a.html(a.attr("default-value")):(a.val(""),a.html("")),a.hasClass("value-input")?a.parents(".item").removeClass("value-got"):(a.parent(".item").removeClass("value-got"),a.hasClass("value-option")?(a.removeClass("option-got"),a.attr("data-value","")):a.hasClass("value-select")&&(a.removeClass("option-got"),a.attr("data-value","")));var s=i(e).parents("li");s&&s.find(".suggest-box").children(".input-radio").attr("checked",!1),"univ"==t?(d.univ.val(d.univ.attr("default-value")),d.univ.attr("data-value",""),d.univ_id.val(d.univ_id.attr("default-value")),d.univ.parent(".item").removeClass("value-got"),d.univ_year.html(d.univ_year.attr("default-value")),d.univ_year.removeClass("option-got").attr("data-value",""),d.univ_year.siblings(".filter-input-clear").hide(),d.univ_year.parent(".item").removeClass("value-got"),d.univ_dept.html(d.univ_dept.attr("default-value")),d.univ_dept.removeClass("option-got").attr("data-value",""),d.univ_dept.siblings(".filter-input-clear").hide(),d.univ_dept.parent(".item").removeClass("value-got"),i("#filter_univ_dept").find(".options").html('<li value="">选择院系</li><li value="其他院系">其他院系</li>'),i("#suniv_box").attr("checked",""),i("#suniv_box .input-radio").removeClass("selected")):("univ_year"==t||"univ_dept"==t)&&(i("#suniv_box").attr("checked",""),i("#suniv_box .input-radio").removeClass("selected"));try{i("#s"+t+"_box").attr("checked",""),i("#s"+t+"_box .input-radio").removeClass("selected")}catch(o){}f.setConditionClearIcon(),arguments[1]!==!1&&n.logRcd({actionTag:"click",targetTag:"filter_info_delete",sourceTag:u(t)})}},clearAllFilterCondition:function(){e.post.work="",e.post.elem="",e.post.juni="",e.post.univ={id:"",depart:"",name:"",year:""},e.post.age={range:""},e.post.high="",e.post.techHigh="",e.post.base={gend:"",prov:""},e.post.birt={astr:""},d.conditionItems.each(function(){var e=i(this);e.hasClass("value-got")&&i(".filter-input-clear",e).each(function(){f.clearFilterCondition(i(this),!1)})}),n.logRcd({actionTag:"click",targetTag:"filter_info_clean",sourceTag:"default"})},lessFilter:function(){i(".filter-expand").removeClass("less").addClass("more"),d.allItems.each(function(){var e=i(this);if("no"==e.attr("default-show")){e.hide();try{f.clearFilterCondition(e.find(".filter-input-clear"))}catch(t){}}}),d.allSuggestBox.each(function(){var e=i(this);"no"==e.attr("default-show")&&(e.hide(),e.find(".input-radio").attr("checked",!1).removeClass("selected"))})},moreFilter:function(){i(".filter-expand").removeClass("more").addClass("less"),d.allItems.show()},setConditionClearIcon:function(){i(".filter-input-clear",d.conditionTitle).hide(),d.conditionItems.each(function(){var e=i(this);return e.hasClass("value-got")?void i(".filter-input-clear",d.conditionTitle).show():void 0})},dealWithPlaceholder:function(){l.isSupportPlaceHolder||(d.valueInputs.each(function(){var e=i(this);e.val(e.attr("default-value")||"")}),d.valueSelects.each(function(){var e=i(this);e.val(e.attr("default-value")||"")}))}},p={focusin:function(e){var t=i(e);t.parent("div").addClass("focus-in"),t.val()==t.attr("default-value")&&t.val(""),t.hasClass("circle")?""!=t.val()&&o.load():(t.siblings(".filter-input-clear").hide(),t.hasClass("keyword")&&t.siblings(".filter-input-ok").show())},focusout:function(t){var n=i(t),a=n.siblings(".filter-input-clear").attr("union"),s=u(a);if(("default"==s||"name"==s)&&(s="people"),n.parent().removeClass("focus-in"),n.siblings(".filter-input-ok")&&n.siblings(".filter-input-ok").hide(),""==n.val()||n.val()==n.attr("default-value")){if(n.parents(".item").removeClass("value-got"),n.val(n.attr("default-value")),n.siblings(".filter-input-clear")&&n.siblings(".filter-input-clear").hide(),n.hasClass("keyword")&&n.siblings(".filter-input-ok").show(),""==e.post[s])return;e.post[s]=""}else{if(n.parents(".item").addClass("value-got"),n.siblings(".filter-input-clear").show(),e.post[s]==n.val())return;i("#s"+a+"_box").attr("checked",""),i("#s"+a+"_box .input-radio").attr("checked",!1)}f.setConditionClearIcon(),e.search.load(!0)},outCircle:function(e){var t=i(e);return t.parent().removeClass("focus-in"),""==t.val()?void t.val(t.attr("default-value")):void setTimeout(function(){o.clearCCTips()},200)},keydown:function(t,n){var a=i(n);if(13==t.keyCode&&""!=a.val()){if(i("#s"+n.id+"_box").attr("checked",""),i("#s"+n.id+"_box .input-radio").attr("checked",!1),a.val()==e.post[a.attr("skey")])return;e.search.load(!0)}},keyupCircle:function(e,t){o.enter(e,t)},inputOk:function(t,n){t.stopPropagation();var a=i(n).siblings("input");i("#s"+a.id+"_box").attr("checked",""),i("#s"+a.id+"_box .input-radio").attr("checked",!1),""!=a.val()&&a.val()!=a.attr("default-value")&&a.val()!=e.post[a.attr("skey")]&&(e.post[a.attr("skey")]=a.val(),e.search.load(!0))},inputClear:function(t,n){t.preventDefault();var a=i(n);if(a.parent("li").hasClass("condition-title"))f.clearAllFilterCondition();else{if(a.parent("li").hasClass("relation-title"))return;f.clearFilterCondition(n)}var s=a.siblings(".value-input");s&&s.hasClass("keyword")&&s.siblings(".filter-input-ok").show(),e.search.load(!0)},selectChange:function(t){var n=i(t);if(""==n.attr("data-value"))n.parent(".item").removeClass("value-got"),n.html(n.attr("default-value")),n.removeClass("option-got"),n.siblings(".filter-input-clear").hide();else{if(n.html()==e.post[n.attr("stype")][n.attr("skey")])return;n.parent(".item").addClass("value-got"),n.addClass("option-got"),n.siblings(".filter-input-clear").show()}f.setConditionClearIcon(),e.search.load(!0)},dropMenuUp:function(e){var t=i(e);t.addClass("drop-menu-down").removeClass("drop-menu-up"),t.siblings(".menu").hide(),t.parent("li").removeClass("option-focus")},dropMenuDown:function(e){var t=i(e);i("#friends_condition_items .drop-menu-up").each(function(e,t){i(t).removeClass("drop-menu-up").addClass("drop-menu-down"),i(t).siblings(".menu").hide(),i(t).parent("li").removeClass("option-focus")}),t.parent("li").addClass("option-focus"),t.removeClass("drop-menu-down").addClass("drop-menu-up"),t.siblings(".menu").show(),m.maxHeightDone(t.siblings(".menu").children("ul"))},clickMenuOption:function(e){var t=i(e),n=t.parent(".options").parent(".menu"),a=n.siblings(".value-option");p.dropMenuUp(a);var s=a.attr("data-value"),o=t.attr("value");s==o||""==s&&1==o||(a.attr("data-value",t.attr("value")),a.html(t.html()),a.trigger("change"))},optionMouseOver:function(e){i(e).css("background","#e1e9f0")},optionMouseOut:function(e){i(e).css("background","")},itemMouseOver:function(e){var t=i(e.target);t.hasClass("filter-sub-title")||t.addClass("special-hover")},itemMouseOut:function(e){i(e.target).removeClass("special-hover")},clickInputRadio:function(t){var n=i(t.target);if(!n.hasClass("selected")){n.addClass("selected");var a=n.attr("union")||"none";switch(a){case"none":return;case"univ":i("#s"+a+"_box").attr("checked",!0).attr("data-name",n.attr("data-name")).attr("data-id",n.attr("data-id")).attr("data-year",n.attr("data-year")).attr("data-dept",n.attr("data-dept")),d.univ.val(n.attr("data-name")),d.univ.attr("data-value",n.attr("data-name")),d.univ_id.val(n.attr("data-id")),d.univ.siblings(".filter-input-clear").show(),d.univ.parent(".item").addClass("value-got"),d.univ_year.html(n.attr("data-year")),d.univ_year.attr("data-value",n.attr("data-year")),d.univ_year.addClass("option-got"),d.univ_year.siblings(".filter-input-clear").show(),d.univ_year.parent(".item").addClass("value-got"),d.univ_dept.html(n.attr("data-dept")),d.univ_dept.attr("data-value",n.attr("data-dept")),d.univ_dept.addClass("option-got"),d.univ_dept.siblings(".filter-input-clear").show(),d.univ_dept.parent(".item").addClass("value-got"),i.ajax({url:"http://www.renren.com/GetDep.do?id="+n.attr("data-id"),type:"GET",dataType:"html",success:function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.firstChild;i("#filter_univ_dept").find(".options").html(i(n).html().replace(/option/g,"li")),t=n=null}});break;default:i("#s"+a+"_box").attr("checked",!0).attr("data-name",n.attr("data-name")),i("#"+a).siblings(".filter-input-clear").show(),i("#"+a).val(n.attr("data-name")).parent(".item").addClass("value-got"),i("#"+a).html(n.attr("data-name"))}f.setConditionClearIcon(),e.search.load(!0)}}},h={focusin:{keyword:"focusin",circle:"focusin",company:"focusin"},focusout:{keyword:"focusout",circle:"outCircle",company:"focusout"},keydown:{keyword:"keydown",company:"keydown"},keyup:{circle:"keyupCircle"},click:{"filter-input-ok":"inputOk","filter-input-clear":"inputClear","is-friend":"isFriend"}},g={bindFilter:function(){var t="focusin";l.isSupportEvent("input",t)||(t="focus");var a="focusout";l.isSupportEvent("input",a)||(a="blur"),d.filter.delegate(".value-input","focusin",function(e){var t=i(e.target);for(var n in h.focusin)t.hasClass(n)&&p[h.focusin[n]](this)}).delegate(".value-input","focusout",function(e){var t=i(e.target);for(var n in h.focusout)t.hasClass(n)&&p[h.focusout[n]](this)}).delegate(".value-input","keyup",function(e){var t=i(e.target);for(var n in h.keyup)t.hasClass(n)&&p[h.keyup[n]](e,this)}).delegate(".value-input","keydown",function(e){var t=i(e.target);for(var n in h.keydown)t.hasClass(n)&&p[h.keydown[n]](e,this)}).delegate(".value-option","change",function(e){p.selectChange(e.target)}).delegate(".filter-expand","click",function(e){var t=i(e.target);t.hasClass("more")?(f.moreFilter(),n.logRcd({actionTag:"click",targetTag:"filter_info_extend",sourceTag:"default"})):(f.lessFilter(),n.logRcd({actionTag:"click",targetTag:"filter_info_hold",sourceTag:"default"}))}).delegate(".input-radio","click",function(e){p.clickInputRadio(e)}).delegate(".filter-input-clear","click",function(e){var t=i(e.target);for(var n in h.click)t.hasClass(n)&&p[h.click[n]](e,this)}).delegate(".filter-input-ok","click",function(e){e.stopPropagation();var t=i(e.target);for(var n in h.click)t.hasClass(n)&&p[h.click[n]](e,this)}).delegate(".is-friend","click",function(t){i(this).toggleClass("checked"),""!=e.search.buildPost(!0)&&e.search.load(!0)}).delegate(".drop-menu-up","click",function(e){e.stopPropagation(),p.dropMenuUp(this)}).delegate(".drop-menu-down","click",function(e){p.dropMenuDown(this)}),d.menuOptions.delegate("li","click",function(e){e.stopPropagation(),p.clickMenuOption(i(e.target))}).delegate("li","mouseover",function(e){p.optionMouseOver(i(e.target))}).delegate("li","mouseout",function(e){p.optionMouseOut(i(e.target))}),d.relationTitle.delegate(".filter-circle-tip","mouseover",function(e){d.tipCircle.show()}).delegate(".filter-circle-tip","mouseout",function(e){d.tipCircle.hide()}).delegate(".filter-input-clear","mouseover",function(e){d.tipClear.show()}).delegate(".filter-input-clear","mouseout",function(e){d.tipClear.hide()}),i("body").bind("click",function(e){i(e.target).hasClass("drop-menu-up")||i(e.target).hasClass("drop-menu-down")||i("#friends_condition_items .drop-menu-up").each(function(){p.dropMenuUp(this)})})}},m={maxHeightDone:function(e){e.children("li").length<6?e.css("height","auto"):e.css("height","203px")}},v=function(t,i){e.search=t,c.loadInfo(function(){d.init(),f.dealWithPlaceholder(),g.bindFilter(),o.init(t),r.init(t,e.post,f.setConditionClearIcon),i()})};e.init=function(e,t){v(e,t)},e.getFilterCondition=function(){f.getFilterCondition()}}),define("friends/add_school",function(require,e,t){var i=require("jquery"),n=require("friends/ajax"),a=require("friends/template"),s=require("friends/util"),o={init:function(){this.schoolSuggest=i("#school_suggest_box"),this.lists=i("#friends_condition_items .li-list"),this.schoolLists=i("#sschools"),this.deptOptions=i("#filter_univ_dept").find(".options")},schoolInput:null,cache:{},deptCache:{}},r=function(){o.init(),l.bindEvent()},l={bindEvent:function(){o.lists.delegate(".value-select","focusin",function(e){d.focusInSchool(this)}).delegate(".value-select","focusout blur",function(e){}).delegate(".value-select","keyup",function(e){d.keyUpAction(e,this)}),o.schoolSuggest.delegate("li","mouseover",function(e){i(this).addClass("on")}).delegate("li","mouseout",function(e){i(this).removeClass("on")}).delegate("li","click",function(e){e.stopPropagation(),d.clickOption(this)}),i("body").bind("click",function(e){i(e.target).hasClass("value-select")||d.focusOutSchool()})}},d={focusInSchool:function(e){i("#friends_condition_items .option-focus").each(function(e,t){var n=i(t);n.removeClass("option-focus");var a=n.children(".drop-menu-up");a.length>0&&(a.removeClass("drop-menu-up").addClass("drop-menu-down"),a.siblings(".menu").hide())}),null!=o.schoolInput&&d.focusOutSchool();var t=i(e),n=i(e).parent("li");if(n.addClass("focus-in").addClass("select-focus"),t.removeClass("select-got"),t.siblings(".filter-input-clear").hide(),o.schoolLists.html(""),o.schoolSuggest.appendTo(n),o.schoolInput=t,""!=t.val()&&t.val()!=t.attr("default-value")){if("techHigh"==t.attr("stype"))return;o.cache[t.attr("stype")]&&o.cache[t.attr("stype")][t.val()]?(o.schoolLists.html(o.cache[t.attr("stype")][t.val()]),o.schoolSuggest.show()):d.getOptions(e)}else t.val("")},focusOutSchool:function(){var t=o.schoolInput;if(t&&t.val){o.schoolSuggest.hide();var n=!0,a=t.attr("stype");if(""==t.val()||t.val()==t.attr("default-value"))t.parent("li").removeClass("value-got").removeClass("focus-in").removeClass("select-focus"),t.removeClass("select-got"),t.siblings(".filter-input-clear").hide(),t.val(t.attr("default-value")),t.attr("data-value",""),"univ"==a?(i("#univ_id").val(""),""==e.post.univ.name?n=!1:e.post.univ.name=e.post.univ.id=""):""==e.post[a]&&(n=!1);else if(t.parent("li").addClass("value-got").removeClass("focus-in").removeClass("select-focus"),t.addClass("select-got"),t.siblings(".filter-input-clear").show(),t.attr("data-value",t.val()),"univ"==a)if(e.post.univ.name==t.val())n=!1;else{var s=t.val(),r=i("#univ_id"),l=c.getUnivIdByKeyword(s);r.val()!=l&&(r.val(l),c.setDept(l))}else e.post[a]==t.val()&&(n=!1);o.schoolInput=null,n&&(e.setConditionIcon(),e.search.load(!0))}},keyUpAction:function(e,t){var n=i(t);return"techHigh"==n.attr("stype")?void(13==e.keyCode&&""!=n.val()&&n.val()!=n.attr("default-value")&&i("body").trigger("click")):void(""!=n.val()&&n.val()!=n.attr("default-value")&&(o.cache[n.attr("stype")]&&o.cache[n.attr("stype")][n.val()]?(o.schoolLists.html(o.cache[n.attr("stype")][n.val()]),o.schoolSuggest.show()):(o.schoolLists.html(""),d.getOptions(t))))},getOptions:function(e){var t=i(e);""!=t.val()&&t.val()!=t.attr("default-value")&&n.addFriends.getSchoolSuggest(t.val(),t.attr("stype"),function(e){var i=d.format(e);o.cache[t.attr("stype")]||(o.cache[t.attr("stype")]={}),o.cache[t.attr("stype")][t.val()]=i;var n=o.schoolSuggest.siblings(".value-select");n&&n.attr("stype")==t.attr("stype")&&(o.schoolLists.html(i),o.schoolSuggest.show())},function(e){s.showDebugLog("Cannot get the suggested shool information!!!")})},format:function(e){var t=null,i=null;window.DOMParser?(t=new DOMParser,i=t.parseFromString(e,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e));var n=i.getElementsByTagName("Id"),s=i.getElementsByTagName("Name"),o=a.addFriends.buildSchoolSuggest(n,s);return o},clickOption:function(t){var n=i(t),a=i(o.schoolInput);a.val(n.attr("data-name")),a.attr("data-value",n.attr("data-name")),"univ"==a.attr("stype")&&i("#univ_id").val()!=n.attr("data-id")&&(i("#univ_id").val(n.attr("data-id")),c.setDept(n.attr("data-id"))),d.focusOutSchool(),e.search.load(!0)}},c={getUnivIdByKeyword:function(e){if(null==o.cache.univ||null==o.cache.univ[e])return"";var t=document.createElement("ul");t.innerHTML=o.cache.univ[e];var n="";return i(t).children("li").each(function(t,a){return i(a).attr("data-name")==e?void(n=i(a).attr("data-id")):void 0}),n},setDept:function(e){var t=i("#filter_univ_dept").find(".options");""==e?t.html('<li value="">选择院系</li><li value="其他院系">其他院系</li>'):o.deptCache[e]?t.html(o.deptCache[e]):n.addFriends.getDeptSuggest(e,function(n){var a=document.createElement("div");a.innerHTML=n;var s=a.firstChild,r=i(s).html().replace(/option/g,"li");o.deptCache[e]=r,t.html(r)},function(e){s.showDebugLog("ask for suggest dept got error....."+e.msg)})}};e.search=function(){},e.setConditionIcon=function(){},e.post=null,e.init=function(t,i,n){e.search=t,e.post=i,e.setConditionIcon=n,r()}}),define("friends/circle",function(require,e,t){var i=require("jquery"),n=require("friends/ajax"),a=require("friends/log"),s=require("friends/template"),o=require("friends/util");e.search=function(){};var r=function(t){e.search=t,d.bindEvent()},l={load:function(){n.addFriends.circle(i("#circle").val(),l.format,l.error)},format:function(e){if(e&&e.data&&e.data.length>0){i("#scircle").html(s.buildCircle(i("#circle").val(),e.data));i(".filter-circle-suggest");return i(".filter-circle-suggest").show(),i("#circleAll").val(e.data.length),void i("#circleCur").val(-1)}l.error()},error:function(){return""==i("#circle").html()?void c.clearCCTips():(i("#scircle").html('<li class="none-data"><span>没有找到相应好友</span></li>'),i(".filter-circle-suggest").show(),i("#circleAll").val(0),void i("#circleCur").val(-1))}},d={bindEvent:function(){i("#scircle").delegate("li","click",function(e){var t=i(e.target);t.attr("data-id")?c.addCircle(i(e.target).attr("data-index")):c.addCircle(i(e.target).parent().attr("data-index")),e.stopPropagation()}).delegate("li","mouseover",function(e){var t=i(e.target);if(t.attr("data-id")){var n=parseInt(i("#circleCur").val());i("#cc"+n).removeClass("on"),i("#cc"+t.attr("data-index")).addClass("on"),i("#circleCur").val(t.attr("data-index"))}e.stopPropagation()}),i("#ccfrds").delegate(".selected","click",function(t){var n=i(t.target).hasClass("selected")?i(t.target):i(t.target).parent(),s=i("#circleVal"),o=(","+s.val()+",").replace(","+n.attr("data-id")+",",",").replace(/^,*|,*$/g,"");n.remove(),s.val(o),s.attr("num",parseInt(s.attr("num")||0)-1),s.attr("num")<=0&&i(".relation-title .filter-input-clear").hide(),i("#circle").val(i("#circle").attr("default-value")).removeAttr("disabled"),e.search.load(!0),a.logRcd({actionTag:"click",targetTag:"filter_relationship_delete",sourceTag:"default"})}),i(".relation-box").delegate(".filter-circle-tip","mouseover",function(e){i(".filter-circle-tips").show(),a.logRcd({actionTag:"hover",targetTag:"filter_relationship_tips",sourceTag:"default"})}).delegate(".filter-circle-tip","mouseout",function(e){i(".filter-circle-tips").hide()}),i(".relation-title").delegate(".filter-input-clear","click",function(t){i("#circle").val(i("#circle").attr("default-value")).removeAttr("disabled"),""!=i("#circleVal").val()&&(i("#circleVal").val("").attr("num",0),i("#ccfrds").html(""),i(".relation-title .filter-input-clear").hide(),i("#friends_condition_items .filter-circle-tips").hide(),c.clearCCTips(),a.logRcd({actionTag:"click",targetTag:"filter_relationship_clean",sourceTag:"default"}),e.search.load(!0))})}},c={addCircle:function(t){var n=arguments[1]===!0?!0:!1,s=i("#cc"+t),r=s.attr("data-id"),l=s.attr("data-name"),d=i("#circleVal").val(),u=parseInt(i("#circleVal").attr("num")||0),f=i("#ccfrds"),p=document.createElement("div");if(p.id="ccfrd"+s.attr("data-id"),i(p).attr("data-id",r),i(p).addClass("selected"),!(isNaN(r)||0>=r)){if(c.clearCCTips(),i("#circle").val(""),-1!==(","+d+",").indexOf(","+r+","))return void(n?i("#circle").val(""):i("#circle").val(i("#circle").attr("default-value")));var h=d+(d?",":"")+r;i("#circleVal").val(h),i("#circleVal").attr("num",u+1),u+1>=10?i("#circle").val("最多可以选择10个好友").attr("disabled","disabled"):n?i("#circle").val(""):i("#circle").val(i("#circle").attr("default-value")),i(".relation-title .filter-input-clear").show(),p.innerHTML=o.substring(l,6,"...")+'<span class="del-icon"/>',""==f.html()?document.getElementById("ccfrds").appendChild(p):i(p).insertBefore(document.getElementById("ccfrds").childNodes[0]),e.search.load(!0),a.logRcd({actionTag:"done",targetTag:"filter_relationship_input",sourceTag:"default",getUserId:r})}},clearCCTips:function(){i("#scircle").html(""),i(".filter-circle-suggest").hide(),i("#circleAll").val(0),i("#circleCur").val(-1),i("#divshim")&&i("#divshim").css("height","0px").hide()}},u={enter:function(e){var t=e.keyCode,n=parseInt(i("#circleAll").val())-1,a=parseInt(i("#circleCur").val());38==t?(i("#cc"+a).removeClass("on"),"-1"==a||"0"==a?(i("#cc"+n).addClass("on"),i("#circleCur").val(n)):(i("#cc"+(a-1)).addClass("on"),i("#circleCur").val(a-1))):40==t?(i("#cc"+a).removeClass("on"),i("#cc"+(a+1)).addClass("on"),a==n?(i("#circleCur").val("0"),i("#cc0").addClass("on")):i("#circleCur").val(a+1)):13==t?c.addCircle(a,!0):l.load()}};e.init=function(e){r(e)},e.load=function(){l.load()},e.clearCCTips=function(){c.clearCCTips()},e.enter=function(e,t){u.enter(e,t)}}),define("friends/ta",function(require,e,t){var i=require("jquery"),n=require("friends/log"),a=require("friends/ajax"),s=require("friends/template"),o=require("friends/util");require("ui/renren/relationFollow"),require("friends/manage_main");var r={data:{},init:function(){this.body=i(document.body),this.bdContent=i(".bd-main .bd-content"),this.taMain=i("#ta_friends_main"),this.friendsList=i("#ta_friends_con"),this.listCon=i("#friends_list_con"),this.friendsAddTop=i(".friends-list-top"),this.cardOpenBtn=i("#btn_con_card"),this.cardTip=i("#friends_card_tip"),this.listOpenBtn=i("#btn_con_list"),this.listTip=i("#friends_list_tip"),this.commonFriCount=i(".friends-com-info"),this.commonFri=i(".friends-common-fri-tip")},userHeadImg:".user-head-img",lazyInit:function(){this.fHeadFn=i("#friend-head-fn"),this.fCommonTip=i("#friends-common-tip"),this.fCommonTxt=i("#friends-common-txt"),this.searchInput=i("#friend_head_bar #f_search-content"),this.searchBtn=i("#friend_head_bar .search-btn"),this.listBottomLoading=i("#list-bottom-loading"),this.listLoading=i("#list-loading")},lazyAddDom:function(){},cache:{},addFriCache:{},get:function(e,t){return r.cache[e]&&0!==r.cache[e].length||(r.cache[e]=i(e,t)),r.cache[e]}};e.post={np:1,ps:24,total:300};var l={showPhoto:function(){i("li.recommend-detail",r.listCon).length<1||(e.post.np<=2?l.showPhoto_backUp():e.load(!0))},showPhoto_backUp:function(){var e;if(r.listOpenBtn.hasClass("btn-list-open"))i(r.userHeadImg).each(function(){e=i(this),e.removeClass("large").addClass("tiny").css("display","block"),e.attr({src:e.attr("data-tinyurl"),height:"50",width:"50",onload:"photoAdjust(this,50,50)"})});else{var t=!1;i(r.userHeadImg).each(function(){e=i(this),e.removeClass("tiny").addClass("large"),e.attr({src:e.attr("data-largeurl"),height:"auto",width:"auto",onload:"photoAdjust(this,168,150)"}),t&&this.complete&&photoAdjust(this,166,166)})}},showListTip:function(e){e.attr("id")==r.cardOpenBtn.attr("id")?r.cardTip.show():e.attr("id")==r.listOpenBtn.attr("id")&&r.listTip.show()},hideListTip:function(e){e.attr("id")==r.cardOpenBtn.attr("id")?r.cardTip.hide():e.attr("id")==r.listOpenBtn.attr("id")&&r.listTip.hide()},showTopLoading:function(){r.listLoading.show()},hideTopLoading:function(){r.listLoading.hide()},showEmpty:function(){r.listBottomLoading.html("没有找到对方的好友...").show()},hideEmpty:function(){r.listBottomLoading.hide()},showGetMore:function(){r.listBottomLoading.html('<a href="#nogo">网络异常，请点击重试</a>').show()},showBottomLoading:function(){r.listBottomLoading.html("正在加载...").show()},hideBottomLoading:function(){r.listBottomLoading.hide()},showNoMore:function(){r.listBottomLoading.html("已经没有更多好友了").show()},hideGetMore:function(){r.listBottomLoading.hide()},clearListCon:function(){r.listCon.html("")},appendToCon:function(e){r.listCon.append(e)},renderListCon:function(e,t){l.appendToCon(e),t?(l.showBottomLoading(),u.getMore()):(l.showNoMore(),u.noMore())},resizeMainContent:function(){var e;window.innerWidth?e=window.innerWidth:document.body&&document.body.clientWidth&&(e=document.body.clientWidth);var t=i(".bd-content"),n=(0==t.length?0:t.width(),i("#webpager")),a=o.conf.includeWebpager&&!n.hasClass("fold")?n.width():0,s=i("#nxSlidebar"),l=0==s.length?0:s.width(),d=o.conf.includeSlidebar?l:0,c=e-l-a;if(c>=1050)r.taMain.removeClass("size-small").addClass("size-big"),r.taMain.css("margin-left",d+(c-r.taMain.width()-40)/2+"px");else if(c>=860)r.taMain.removeClass("size-big size-small"),r.taMain.css("margin-left",d+(c-r.taMain.width()-40)/2+"px");else if(c>=670)r.taMain.removeClass("size-big").addClass("size-small"),r.taMain.css("margin-left",d+(c-r.taMain.width()-40)/2+"px");else{r.taMain.removeClass("size-big").addClass("size-small");var u=(c-r.taMain.width()-40)/2;r.taMain.css("margin-left",d+(0>u?0:u)+"px")}var f=i(".top-fixed #friend_head_bar_bg");f.length>0?(f.css("margin-left",-20-parseInt(r.taMain.css("margin-left"))+"px"),f.css("padding-left",20+parseInt(r.taMain.css("margin-left"))+"px"),f.css("padding-right",parseInt(f.css("padding-left"))+"px")):r.get("#friend_head_bar_bg").attr("style","")}},d={friendsMouseover:function(e){var e=i(e);e.attr("data-id");e.addClass("hover"),0===e.children("#friend-head-fn").length&&e.prepend(r.fHeadFn),r.fHeadFn.show()},friendsMouseout:function(e){r.friendsList.append(r.fHeadFn),r.fHeadFn.hide(),r.fCommonTxt.html("")},listToggle:function(e){e.attr("id")==r.cardOpenBtn.attr("id")&&e.hasClass("btn-card-close")?(e.removeClass("btn-card-close").addClass("btn-card-open"),r.listOpenBtn.removeClass("btn-list-open").addClass("btn-list-close"),r.listCon.addClass("detail-card-on").removeClass("detail-list-on"),l.showPhoto()):e.attr("id")==r.listOpenBtn.attr("id")&&e.hasClass("btn-list-close")&&(e.removeClass("btn-list-close").addClass("btn-list-open"),r.cardOpenBtn.removeClass("btn-card-open").addClass("btn-card-close"),r.listCon.addClass("detail-list-on").removeClass("detail-card-on"),l.showPhoto())},showCommonFriTimer:null,showCommonFri:function(e){this.showCommonFriTimer=setTimeout(function(){var t=i(e).attr("data-com");parseInt(t)>0&&p.showCommonInfo(e)},300)},hideCommonFri:function(e){clearTimeout(this.showCommonFriTimer),r.fCommonTip.hide()},scroll:function(){e.func(),g.fixTop()},search:function(){var e=i.trim(r.searchInput.val());e!=h.keyword&&(h.keyword=e,""==e?f.load(!0):h.load(!0))}},c={mouseover:{"friends-com-info":"showCommonFri"},click:{}},u={bindFriends:function(){function e(){clearTimeout(t),t=null}r.friendsAddTop.delegate("a","click",function(e){e.stopPropagation(),d.listToggle(i(this))}),r.friendsAddTop.delegate("a","mouseover",function(e){l.showListTip(i(this))}),r.friendsAddTop.delegate("a","mouseout",function(e){l.hideListTip(i(this))});var t;r.listCon.delegate("li.recommend-detail","mouseover",function(t){i(this).css("z-index",1).siblings("li").css("z-index",0),e(),d.friendsMouseover(this);var n=i(t.target);for(var a in c.mouseover)n.hasClass(a)&&d[c.mouseover[a]](this)}).delegate("li.recommend-detail","mouseout",function(n){i(this).attr("z-index",0),i(this).removeClass("hover"),e(),t=setTimeout(function(){d.friendsMouseout(this)},50)}),r.listCon.on("mouseover",".friends-item-btn",function(){var e=i(this).find(".add");e.renrenrelationFollow({addAction:function(t){e.removeClass("ui-button-green add").addClass("ui-button-default followed").html('<span class="ui-button-text">已关注</span>')},friendAction:function(){e.removeClass("ui-button-green add").addClass("ui-button-default sended").html('<span class="ui-button-text">申请中...</span>');
},cancelAction:function(){e.removeClass("ui-button-default followed").addClass("ui-button-green add").html('<span class="ui-icon ui-iconfont">&#xe849;</span><span class="ui-button-text">关注好友</span>')}})}),r.listCon.delegate(r.commonFriCount,"mouseout",function(e){d.hideCommonFri(this)})},bindSearch:function(){r.searchBtn.bind("click",function(e){d.search()}),r.searchInput.bind("keyup",function(e){(13==e.keyCode||""==i.trim(r.searchInput.val()))&&d.search()})},getMore:function(){i(window).bind("scroll",d.scroll)},noMore:function(){r.listBottomLoading.undelegate("a","click"),e.load=function(){}},bindWindowResize:function(){i(document).bind("mainframe:reflow",function(){l.resizeMainContent()})}},f={data:{},buildPost:function(t){return t&&(e.post.np=1),'p={ "fid":"'+r.data.fid+'","pz":"'+e.post.ps+'","type":"WEB_FRIEND","pn":"'+(e.post.np-1)+'"}'},load:function(t,i){var t=1==arguments[0]?!0:!1,n=f.buildPost(t);return l.hideBottomLoading(),t||0==f.data.length?(l.clearListCon(),l.showTopLoading(),a.taFriends.getTaFriendsData(n,function(e){f.firstFormat(e),t&&i&&i()},f.error),void(e.load=function(e){f.load(e)})):(l.showBottomLoading(),void a.taFriends.getTaFriendsData(n,f.format,f.error))},firstFormat:function(t){l.hideTopLoading();var i="",a=r.cardOpenBtn.hasClass("btn-card-close")?!0:!1;if(t&&t.data&&t.data.friends){f.data=t.data;var o=(e.post.np-1)*e.post.ps,d=o+e.post.ps;i=s.taFriends.recommemdBuild(f.data.friends,o,d,a,!1)}return l.clearListCon(),""==i?void l.showEmpty():(l.renderListCon(i,t.data.more),e.post.np+=1,e.after(),void n.logRcd({actionTag:"load",targetTag:"result_retrieve",sourceTag:"suggestion"}))},format:function(t){var i="",n=r.cardOpenBtn.hasClass("btn-card-close")?!0:!1;if(data=t.data,data&&data.friends){var a=0,o=e.post.ps;i=s.taFriends.recommemdBuild(data.friends,a,o,n,!1)}return""==i?(l.showNoMore(),void u.noMore()):(l.renderListCon(i,t.data.more),e.post.np+=1,void e.after())},error:function(t){return-2==t.code?void r.friendsList.html(i(s.taFriends.buildTaNoAuthorityTip)):(1==e.post.np&&(l.hideTopLoading(),l.clearListCon()),l.showGetMore(),void r.listBottomLoading.delegate("a","click",f.load))}},p={load:function(e){var t=i(e).attr("data-id");a.addFriends.commonFri(t,function(e){if(0==e.code){p.cache[t]=e.data;var i=r.fHeadFn.parent("li");i&&i.attr("data-id")==t&&r.fCommonTxt.html(e.data)}},function(){})},cache:{},showCommonInfo:function(e){var t=i(e).attr("data-id");p.cache[t]?(r.fCommonTxt.html(p.cache[t]),r.fCommonTip.show()):(r.fCommonTxt.html("加载中..."),r.fCommonTip.show(),p.load(e))}},h={keyword:"",isFirst:!0,load:function(t){h.isFirst=arguments[0]===!0?!0:!1,l.hideEmpty(),h.isFirst?(l.showTopLoading(),e.post.np=1,e.load=function(e){h.load(e)}):l.showBottomLoading();var i='p={"pn":"'+(e.post.np-1)+'", "pz":"'+e.post.ps+'","fid":"'+r.data.fid+'","keyword":"'+h.keyword+'"}';a.taFriends.searchTaFriends(i,h.format,h.getError)},format:function(t){h.isFirst?(l.clearListCon(),l.hideTopLoading(),i("body, html").animate({scrollTop:0},1e3)):l.hideBottomLoading();var n="",a=r.cardOpenBtn.hasClass("btn-card-close")?!0:!1;if(t&&t.data&&t.data.friends){var o=0,d=o+e.post.ps;n=s.taFriends.recommemdBuild(t.data.friends,o,d,a,!0)}return""==n?void l.showEmpty():(l.renderListCon(n,t.data.more),e.post.np+=1,void e.after())},getError:function(t){return-2==t.code?void r.friendsList.html(i(s.taFriends.buildTaNoAuthorityTip)):void(0==e.post.np&&l.hideTopLoading())}},g={isTopFixed:!1,fixTop:function(){var e=document.documentElement.scrollTop||r.body.scrollTop();r.get("#frameFixedNav").hasClass("fix-app-nav")||e>148?r.get(".bd-content").addClass("first-nav-fixed"):r.get(".bd-content").removeClass("first-nav-fixed"),40>e?g.isTopFixed&&(r.taMain.removeClass("top-fixed"),g.isTopFixed=!1):g.isTopFixed||(r.taMain.addClass("top-fixed"),g.isTopFixed=!0),l.resizeMainContent()}};e.load=function(){},e.after=function(){e.func.loading=!1,e.after=function(){}},e.func=function(){if(1!=e.func.loading){var t=r.friendsList.height()-i(window).scrollTop()-i(window).height();200>t&&(e.func.loading=!0,e.after=function(){e.func.loading=!1,e.after=function(){}},e.load())}},e.func.loading=!1,e.init=function(e){return i("#frameFixedNav li.fd-nav-item").each(function(){i(this).children("a")[0]&&"好友"==i(this).children("a")[0].innerHTML&&i(this).addClass("fd-nav-cur-item")}),r.data=e,r.init(),r.lazyAddDom(),r.friendsList.append(i(s.taFriends.buildTaManageFriendsShade())),l.resizeMainContent(),r.friendsList.show(),r.lazyInit(),u.bindFriends(),u.bindSearch(),u.bindWindowResize(),0!=e.code?(r.listCon.addClass("no-see"),void r.friendsList.html(s.taFriends.buildTaNoAuthorityTip())):void f.load(!0)}});