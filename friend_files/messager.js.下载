var WPC={};try{console||(console={},console.log=function(){})}catch(e){var console={};console.log=function(){}}!function(e){function t(e){this.message=e}function n(e,t){var n=e.getElementsByTagName(t)[0];return n?n.textContent:""}document.domain="renren.com",e.cookie={get:function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?decodeURIComponent(t[2]):null},set:function(e,t,n,o){var r=e+"="+encodeURIComponent(t),i=new Date((new Date).getTime()-1e3),a=e+"=null;expires="+i.toGMTString();if(document.cookie=a,n){n=o===!0?1e3*n:1e3*n*60*60*24;var i=new Date((new Date).getTime()+n);r+=";expires="+i.toGMTString()}r+=";path=/;domain=webpager.renren.com",document.cookie=r}},e.getLoginUin=function(){if(nx.user.id!=nx.user.ruid)return nx.user.id;var t=e.cookie.get("id");return t||(t=e.cookie.get("hostid")),t||(t=e.cookie.get("userid")),t},e.acquire=function(t,n,o){var r=Math.random(),i=function(){var i=e.cookie.get(t);i==r?n&&n():o&&o()};e.cookie.set(t,r),setTimeout(i,40)},t.prototype.toString=function(){return"AssertException: "+this.message},e.assert=function(e,n){if(!e)throw new t(n)},e.event={addEvent:function(e,t,n){return e._listeners||(e._listeners={}),e._listeners[t]||(e._listeners[t]=[]),e._listeners[t].push(n),e},removeEvent:function(t,n,o){if(!t._listeners||!t._listeners[n])return void e.assert(!1,"remove an event not added");for(var r=0;r<t._listeners[n].length;++r)if(t._listeners[n][r]==o){var i=t._listeners[n].splice(r,1);e.assert(i[0]==o,"remove not correct")}},fireEvent:function(e,t,n){if(!e._listeners)return null;if(!e._listeners[t]||!e._listeners[t].length)return null;var o=e._listeners[t];if(!o)return null;for(var r=0;r<o.length;r++)try{o[r].apply(e,n)}catch(i){}return e},enableCustomEvent:function(e){var t=this;e.addEvent=function(n,o){t.addEvent(e,n,o)},e.removeEvent=function(n,o){t.removeEvent(e,n,o)},e.fireEvent=function(n){var o=Array.prototype.slice.call(arguments,1,arguments.length);t.fireEvent(e,n,o)}}},e.xml={extractMessage:function(t){var o=t.replace(/<title>/i,"<title><![CDATA[");t=o.replace(/<\/title>/i,"]]></title>"),o=t.replace(/<body>/i,"<body><![CDATA["),t=o.replace(/<\/body>/i,"]]></body>"),o=t.replace(/<attachment>/i,"<attachment><![CDATA["),t=o.replace(/<\/attachment>/i,"]]></attachment>");var r,i=[];if(window.ActiveXObject){t.indexOf("/>")>=0&&(t=t.replace(/<\w+\s*\/>/,""));try{r=new ActiveXObject("Microsoft.XMLDOM")}catch(a){e.reportExpt("xmlparser_IE",a,navigator.userAgent)}if(r.async=!1,r.loadXML(t),0!=r.parseError.errorCode)return i;for(var s=r.getElementsByTagName("message"),c=0;c<s.length;++c){var u=s[c];if(u.attributes){var l={},d=u.getAttribute("type");if(l.msg_id=u.getAttribute("id"),"chat"==d)l.from=u.getAttribute("from"),l.to=u.getAttribute("to"),l.fname=u.getAttribute("fname"),u.firstChild&&u.firstChild.firstChild&&(l.msg_content=u.firstChild.firstChild.data);else if("notify"==d||"notify2"==d){l.touin=e.getLoginUin();for(var f=0;f<u.childNodes.length;f++)"subject"==u.childNodes[f].tagName?l.title=u.childNodes[f].childNodes[0].data:"body"==u.childNodes[f].tagName&&(l.content=u.childNodes[f].childNodes[0].data)}else if("spam"==d){for(var f=0;f<u.childNodes.length;f++)l[u.childNodes[f].tagName]=u.childNodes[f].childNodes[0].data;l.content=l.body}else l.from=u.getAttribute("from"),l.to=u.getAttribute("to"),l.content=u.childNodes[0].childNodes[0].data;l.type=d,u.childNodes[1]&&"attachment"==u.childNodes[1].tagName&&u.childNodes[1].firstChild&&(l.attachment=u.childNodes[1].firstChild.data)}i.push(l)}}else{var p=new DOMParser;r=p.parseFromString(t,"text/xml");for(var g=r.documentElement,m=g.childNodes.length,c=0;m>c;++c){var u=g.childNodes[c];if(u.hasAttributes()){var l={};l.type=u.getAttribute("type"),l.msg_id=u.getAttribute("id"),l.from=u.getAttribute("from"),l.to=u.getAttribute("to"),l.content=n(u,"body"),l.msg_content=n(u,"body"),l.attachment=n(u,"attachment"),l.touin=e.getLoginUin(),"chat"==l.type&&(l.fname=u.getAttribute("fname")),"spam"==l.type&&(l.from=n(u,"from"),l.to=n(u,"to"),l.code=n(u,"code")),i.push(l)}}}return i}},e.report={_timeList:[],_stats:null,init:function(){try{var e=",519141630,407170024,220882547,283368718,256765127,237767538,223093178,251316591,234800486,270535522,301724769,254864048,264249415,";this._stats=-1===e.indexOf(","+nx.user.id+",")?{send:function(){},add:function(){},push:function(){},sub:function(){}}:nx.stats.sub({url:"http://webpager.renren.com/log/print",forcePost:!0,whitelist:!1})}catch(t){this._stats={send:function(){},add:function(){},push:function(){},sub:function(){}}}},_send:function(e){try{this._stats.send(e)}catch(t){}},_exp:function(e,t){e=e||{},t=t||"none",param=nx.user.id+"|"+t+"|exp|"+JSON.stringify(e),this._send("param="+param+"&source="+t+"exp")},jsExp:function(e,t){this._exp({tryNode:e,name:t.name,message:t.description||t.message,fileName:t.fileName||"",lineNumber:t.lineNumber||0,columnNumber:t.columnNumber||0,number:t.number||0,stack:t.stack||""},"js")},ajaxExp:function(e,t){this._exp({ajaxNode:e,url:t.url,errorCode:t.errorCode||"",content:t.content||""},"ajax")},_time:function(e){for(var t=this._timeList.length-1;t>=0;t--){var n=this._timeList[t];n.key==e&&this._timeList.splice(t,0)}this._timeList.push({key:e,val:(new Date).getTime()})},_timeEnd:function(e){for(var t=this._timeList.length-1;t>=0;t--){var n=this._timeList[t];if(n.key==e)return n.val=(new Date).getTime()-n.val,this._timeList.splice(t,0),n}},ajaxDelay:function(e){this._time(e)},ajaxDelayEnd:function(e,t){var n=this._timeEnd(e);param=nx.user.id+"|ajax|delay|"+JSON.stringify({ajaxNode:e,url:t,delay:n}),this._send("param="+param+"&source=ajaxdelay")},jsDelay:function(e){this._time(e)},jsDelayEnd:function(e){var t=this._timeEnd(e);param=nx.user.id+"|js|delay|"+JSON.stringify({jsNode:e,delay:t}),this._send("param="+param+"&source=jsdelay")},node:function(e,t,n){"string"!=typeof n&&(n=JSON.stringify(n)),param=nx.user.id+"|"+e+"|"+t+"|"+n,this._send("param="+param+"&source=jsnode")},log:function(e,t,n){"string"!=typeof n&&(n=JSON.stringify(n)),param=nx.user.id+"|"+e+"|"+t+"|"+n,this._send("param="+param+"&source="+t)}},e.report.init(),e.distinct=function(e){for(var t=[],n={},o=0;o<e.length;o++)n[e[o]]=1;for(key in n)t.push(key);return t},"undefined"==typeof XML&&(XML=function(){}),XML.ObjTree=function(e){return this.attr_prefix=e||"",this},XML.ObjTree.VERSION="1.0.0",XML.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n',XML.ObjTree.prototype.parseXML=function(e){var t;if(window.DOMParser){var n=new DOMParser,o=n.parseFromString(e,"application/xml");if(!o)return;t=o.documentElement}else window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(e),t=n.documentElement);if(t)return this.parseDOM(t)},XML.ObjTree.prototype.parseHTTP=function(e,t,n){var o={};for(var r in t)o[r]=t[r];if(o.method||(o.method="undefined"==typeof o.postBody&&"undefined"==typeof o.postbody&&"undefined"==typeof o.parameters?"get":"post"),n){o.asynchronous=!0;var i=this,a=n,s=o.onComplete;o.onComplete=function(e){var t;e&&e.responseXML&&e.responseXML.documentElement&&(t=i.parseDOM(e.responseXML.documentElement)),a(t,e),s&&s(e)}}else o.asynchronous=!1;var c;if("undefined"!=typeof HTTP&&HTTP.Request){o.uri=e;var u=new HTTP.Request(o);u&&(c=u.transport)}else if("undefined"!=typeof Ajax&&Ajax.Request){var u=new Ajax.Request(e,o);u&&(c=u.transport)}return n?c:c&&c.responseXML&&c.responseXML.documentElement?this.parseDOM(c.responseXML.documentElement):void 0},XML.ObjTree.prototype.parseDOM=function(e){if(e){if(this.__force_array={},this.force_array)for(var t=0;t<this.force_array.length;t++)this.__force_array[this.force_array[t]]=1;var n=this.parseElement(e);if(this.__force_array[e.nodeName]&&(n=[n]),11!=e.nodeType){var o={};o[e.nodeName]=n,n=o}return n}},XML.ObjTree.prototype.parseElement=function(e){if(7!=e.nodeType){if(3==e.nodeType||4==e.nodeType){var t=e.nodeValue.match(/[^\x00-\x20]/);if(null==t)return;return e.nodeValue}var n,o={};if(e.attributes&&e.attributes.length){n={};for(var r=0;r<e.attributes.length;r++){var i=e.attributes[r].nodeName;if("string"==typeof i){var a=e.attributes[r].nodeValue;a&&(i=this.attr_prefix+i,"undefined"==typeof o[i]&&(o[i]=0),o[i]++,this.addNode(n,i,o[i],a))}}}if(e.childNodes&&e.childNodes.length){var s=!0;n&&(s=!1);for(var r=0;r<e.childNodes.length&&s;r++){var c=e.childNodes[r].nodeType;3!=c&&4!=c&&(s=!1)}if(s){n||(n="");for(var r=0;r<e.childNodes.length;r++)n+=e.childNodes[r].nodeValue}else{n||(n={});for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r].nodeName;if("string"==typeof i){var a=this.parseElement(e.childNodes[r]);a&&("undefined"==typeof o[i]&&(o[i]=0),o[i]++,this.addNode(n,i,o[i],a))}}}}return n}},XML.ObjTree.prototype.addNode=function(e,t,n,o){this.__force_array[t]?(1==n&&(e[t]=[]),e[t][e[t].length]=o):1==n?e[t]=o:2==n?e[t]=[e[t],o]:e[t][e[t].length]=o},XML.ObjTree.prototype.writeXML=function(e){var t=this.hash_to_xml(null,e);return this.xmlDecl+t},XML.ObjTree.prototype.hash_to_xml=function(e,t){var n=[],o=[];for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];r.charAt(0)!=this.attr_prefix?n[n.length]="undefined"==typeof i||null==i?"<"+r+" />":"object"==typeof i&&i.constructor==Array?this.array_to_xml(r,i):"object"==typeof i?this.hash_to_xml(r,i):this.scalar_to_xml(r,i):o[o.length]=" "+r.substring(1)+'="'+this.xml_escape(i)+'"'}var a=o.join(""),s=n.join("");return"undefined"==typeof e||null==e||(s=n.length>0?s.match(/\n/)?"<"+e+a+">\n"+s+"</"+e+">\n":"<"+e+a+">"+s+"</"+e+">\n":"<"+e+a+" />\n"),s},XML.ObjTree.prototype.array_to_xml=function(e,t){for(var n=[],o=0;o<t.length;o++){var r=t[o];n[n.length]="undefined"==typeof r||null==r?"<"+e+" />":"object"==typeof r&&r.constructor==Array?this.array_to_xml(e,r):"object"==typeof r?this.hash_to_xml(e,r):this.scalar_to_xml(e,r)}return n.join("")},XML.ObjTree.prototype.scalar_to_xml=function(e,t){return"#text"==e?this.xml_escape(t):"<"+e+">"+this.xml_escape(t)+"</"+e+">\n"},XML.ObjTree.prototype.xml_escape=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.XMLTree=XML.ObjTree}(WPC),function(e,t){var n=!1;-1!=top.location.href.indexOf("cometbug=1")&&(n=!0);var o=!1;-1!=top.location.href.indexOf("hostbug=1")&&(o=!0);var r=function(){var e=new Date;return" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},i=e.xml,a=(e.Profile,0);e.Comet={messageId:0,connErrCnt:0,connErrCntMax:3,connErrCntTry:10,connErrCntTryHack:10,_pollBackNum:0,pollErrTryCount:0,pollErrTryCountMax:5,connTimer:null,_xhrPoll:null,_xhrConn:null,sendQueue:[],offlineCheck:0,onConnectingFlag:!1,onPollingFlag:!1,abortConnFlag:!1,abortPollFlag:!1,releaseConnFlag:!1,releasePollFlag:!1,connect:function(){var e=this;if(e.connErrCnt>=e.connErrCntMax){if(e.connErrCntTry>=0)return void e.connErrCntTry--;e.connErrCntTry=e.connErrCntTryHack}e.abortConnFlag=!1,n&&console.log("connect1"+r(),"_self.onConnectingFlag:",e.onConnectingFlag),e.onConnectingFlag||(n&&console.log("connect2"+r()),e.onConnectingFlag=!0,n&&console.log("开始连接服务器"+r()),e._xhrConn&&(e._connAbort(),e._pollAbort()),e._xhrConn=t.ajax({url:"http://wpi.renren.com/comet_get?mid=0&r="+Math.random()+"&ins",dataType:"text",success:function(){e._connSucc()},error:function(){e._connError()}}),n&&console.log("请求地址comet_get?mid=0&ins",r()))},testConnect:function(){t.ajax({url:"http://wpi.renren.com/comet_get?mid=0&r="+Math.random()+"&ins",dataType:"text",success:function(){},error:function(){}}),n&&console.log("testConnect 请求地址comet_get?mid=0&ins",r())},_connAbort:function(){var e=this;e.abortConnFlag=!0,n&&console.log("connAbort"+r()),e._xhrConn&&(e._xhrConn.abort(),e._xhrConn=null)},_connSucc:function(){var e=this;n&&console.log("_connSucc"+r()),e.connState(1),e.pollErrTryCount=0,e.doLongPoll(),e.fireEvent("comet_connected",e._xhrConn)},_connError:function(){var e=this;return e.onConnectingFlag=!1,n&&console.log("_connError","_self.releaseConnFlag",e.releaseConnFlag,"_self.abortConnFlag",e.abortConnFlag,r()),e.releaseConnFlag?(e._releaseResetXHR(),void(e.releaseConnFlag=!1)):e.abortConnFlag?(e._resetXHR(),e.abortConnFlag=!1,void e.fireEvent("comet_disconnected")):(e._resetXHR(),e.connState(0),e.fireEvent("comet_connect_fail"),void(e.connErrCnt=e.connErrCnt+1))},doLongPoll:function(){n&&console.log("新建一个长轮询"+r());var e=this;return e.abortPollFlag=!1,e.onPollingFlag?void(n&&console.log("有其他长轮询正在运行，此次不建立"+r())):(e.onPollingFlag=!0,e.connState(1),void(e._xhrPoll=t.ajax({url:"http://wpi.renren.com/comet_get?mid="+e.messageId+"&r="+Math.random(),dataType:"text",success:function(t){e._pollBack(t)},error:function(){e._pollError()}})))},_pollAbort:function(){var e=this;e.abortPollFlag=!0,n&&console.log("pollAbort",e._xhrPoll,r()),e._xhrPoll&&(e._xhrPoll.abort(),e._xhrPoll=null)},_pollBack:function(t){var o=this;return o.onPollingFlag=!1,n&&console.log("{_pollBack: { data:",t,"xhr : ",o._xhrPoll," } }, 收到数据",r()),o.pollErrTryCount=0,211==o._xhrPoll.status?(n&&console.log("211"),void o.release()):(setTimeout(function(){try{e.analyzeMsg.analyze(t)}catch(n){e.report.jsExp("pollBackAnalyze",n)}o.doLongPoll()},1),void o.fireEvent("message",t))},_pollError:function(){var e=this;return e.onConnectingFlag=!1,e.onPollingFlag=!1,n&&console.log("{ r: ",e._xhrPoll,"}, _pollError",r()),n&&console.log("_pollError","_self.releasePollFlag",e.releasePollFlag,"_self.abortPollFlag",e.abortPollFlag,"_self.pollErrTryCount",e.pollErrTryCount,r()),e.releasePollFlag?(e._releaseResetXHR(),void(e.releasePollFlag=!1)):e.abortPollFlag?(e._resetXHR(),e.abortPollFlag=!1,void e.fireEvent("comet_disconnected")):e.pollErrTryCount>=e.pollErrTryCountMax?(e._resetXHR(),void e.fireEvent("comet_connect_fail")):(e.pollErrTryCount++,void e.doLongPoll())},disconnect:function(){var e=this;n&&console.log("disconnect",e._xhrPoll,r()),e.connState(0),e.onConnectingFlag=!1,e.onPollingFlag=!1,e._xhrPoll&&(e.abortPollFlag=!0,e._xhrPoll.abort(),e._xhrPoll=null),e._xhrConn&&(e.abortConnFlag=!0,e._xhrConn.abort(),e._xhrConn=null)},release:function(){var e=this;n&&console.log("release",e._xhrPoll,r()),e.onConnectingFlag=!1,e.onPollingFlag=!1,e._xhrConn&&(e.releaseConnFlag=!0,e._xhrConn.abort(),e._xhrConn=null),e._xhrPoll&&(e.releasePollFlag=!0,e._xhrPoll.abort(),e._xhrPoll=null)},_resetXHR:function(){var e=this;e.connState(0),e.onConnectingFlag=!1,e.onPollingFlag=!1,e._xhrPoll=null,e._xhrConn=null},_releaseResetXHR:function(){var e=this;e.onConnectingFlag=!1,e.onPollingFlag=!1,e._xhrPoll=null,e._xhrConn=null},connState:function(t){if(void 0!==t)return n&&console.log("set connState:",t),nx.cookie.destroy("wp-conn"),e.cookie.set("wp-conn",t),!0;var o=e.cookie.get("wp-conn");return"1"==o},isHaveConn:function(){return this._xhrPoll?!0:!1},send:function(o,i,s){{var c="http://wpi.renren.com/muc_chat";arguments.callee}n&&console.log("%c"+o+"%c发送数据到URL"+c+r(),"color:green; background-color:#999","color:red; background-color:#999");var u=t.ajax({url:c,contentType:"application/json; charset=UTF-8",dataType:"text",data:o,type:"POST",processDate:!1,success:function(e){n&&console.log("发送成功",r()),n&&console.log({r:e},"send onSuccess");var t={code:0,msg:"发送成功",data:[]};i&&i(t),a=0},error:function(){n&&console.log("发送失败",r());var t={code:0,msg:"发送失败",data:[]};s&&s(t),n&&console.log({xhr:u},"send onError"),e.reportExpt("cometSend",new Error("comet send error : status "+u.status),o)}})}};var s=e.Comet;e.event.enableCustomEvent(e.Comet),e.analyzeMsg={analyze:function(e){var t=this;n&&console.log("%c"+e,"color:green; background-color:yellow");var o=/<mucmsg.*\"(\d{1,})\">(.*)<\/mucmsg>/gim,r=/<mucmsg id="\d{1,}">(.*?)<\/mucmsg>/gim;if(o.test(e)){var a=e.match(r);if(a.length>=2)for(var s=0;s<a.length;s++){var c=s;!function(e){setTimeout(function(){t._mucmsg_analyze(a[e])},10*e)}(c)}else t._mucmsg_analyze(e)}else{var u=/<common.*\"(\d{1,})\">(.*)<\/common>/gim,l=/<common id="\d{1,}">(.*?)<\/common>/gim;if(u.test(e)){var a=e.match(l);if(a.length>=2)for(var d=0;d<a.length;d++){var f=d;!function(e){setTimeout(function(){t._common_analyze(a[e])},10*e)}(f)}else t._common_analyze(e)}else{var p=i.extractMessage(e);if(p.length)var g=p[p.length-1].msg_id;t._handleOutMsg({id:g||0,domain:"comet_got",data:p})}}},_mucmsg_analyze:function(e){var t=this,n=/<mucmsg.*\"(\d{1,})\">(.*)<\/mucmsg>/gim;e.replace(n,function(e,n,o){o=o.replace(/'/g,'"');var r=JSON.parse(o),i={id:n,domain:"muc",data:r};return t._handleOutMsg(i),e})},_common_analyze:function(e){var t=this,n=/<common.*\"(\d{1,})\">(.*)<\/common>/gim;e.replace(n,function(e,n,o){try{var r=JSON.parse(o)}catch(i){console.log(i.message)}var a="chat",s={id:n,domain:a,data:r};return t._handleOutMsg(s),e})},_handleOutMsg:function(e){var t=this;return s.messageId=e.id,"muc"==e.domain?void t._handleMucmsg(e.data):"chat"==e.domain?void t._handleCommon(e.data):"comet_got"==e.domain?void t._handleCometGot(e.data):void 0},_handleMucmsg:function(e){var t=this;if("error"==e.type){var n=(e.error.description,{groupId:e.from,type:"error",description:e.error.description,ecode:e.error.code,id:e.id});return void t.fireEvent("group_error",n)}if("muc_retry"==e.type){var o=e.from||e.fromid;return e.type=o===nx.user.id?"muc_self":"muc",n=t._handleMessage(e),void t.fireEvent("muc_retry",n)}var r="http://muc.talk.renren.com/";if(e.xmlns==r+"message")n=t._handleMessage(e),t.fireEvent("group_message",n);else if(e.xmlns==r+"latestmsgs"){var i=e.items;i.sort(function(e,t){return+e.msgkey>+t.msgkey?1:+e.msgkey<+t.msgkey?-1:void 0});for(var a=i.length-1;a>=0;a--)i[a]=t._handleMessage(i[a]);t.fireEvent("group_latestmsgs",i)}else if("sr"==e.type){var n={type:e.type,groupId:e.to,msgkey:e.msgkey,last_msgkey:e.last_msgkey,localId:e.local_id};t.fireEvent("group_sr",n)}else if(e.xmlns==r+"config"){var n={groupId:e.from,groupName:e.name,groupType:e.grouptype,relationType:e.relationtype||"",tiny_url:e.headurl,localId:e.id,items:e.items};t.fireEvent("group_config",n)}else if(e.xmlns==r+"items"){var n={groupId:e.from,groupName:e.name,localId:e.id,items:e.items};t.fireEvent("group_item",n)}else if(e.xmlns==r+"grouplist")t.fireEvent("group_list",e);else if(e.xmlns==r+"create"){var n={groupId:e.from,groupName:e.name};t.fireEvent("group_open",n)}else if(e.xmlns==r+"createitem"){var n={groupId:e.roomid,groupName:e.roomname,fromId:e.from,info:e.info,items:e.items};t.fireEvent("group_createitem",n)}else if(e.xmlns==r+"inviteitem"){var n={groupId:e.roomid,groupName:e.roomname,fromId:e.from,info:e.info,items:e.items};t.fireEvent("group_inviteitem",n)}else if(e.xmlns==r+"invite"){var n={groupId:e.from,localId:e.id};t.fireEvent("group_invite",n)}else if(e.xmlns==r+"quit"){var n={localId:e.id};e.from.replace(/^(\d*)@muc.talk.renren.com\/(\d*)/,function(e,t,o){return n.groupId=t,n.userId=o,e}),t.fireEvent("group_quit",n)}else if(e.xmlns==r+"quititem"){var n={groupId:e.from,userId:e.uid,userName:e.username,info:e.info};t.fireEvent("group_quititem",n)}else if(e.xmlns==r+"group"){var n={groupId:e.from,groupName:e.name,info:e.info};t.fireEvent("group_name",n)}else if(e.inviterid&&e.xmlns==r+"user"){var n={groupId:e.from,groupName:e.roomName,inviterId:e.inviterid,inviterName:e.inviterName,info:e.info};t.fireEvent("group_inviteuser",n)}else if("info"==e.type){var n={type:"info",groupId:e.groupid,fromId:e.fromid,description:e.description,time:e.time,msgkey:e.msgkey};t.fireEvent("group_info",n)}else console.log("unhandled mucmsg",e)},_handleCommon:function(e){var t=this;if("error"==e.type,"sr"==e.type){var n={type:e.type,toId:e.to,msgkey:e.msgkey,last_msgkey:e.last_msgkey,localId:e.local_id,time:e.time};t.fireEvent("chat_sr",n)}else if("sn"==e.type){var n={type:e.type,chatType:e.chat_type,toId:e.to,count:e.count,maxId:e.maxid,fromId:e.from};t.fireEvent("chat_sn",n)}else{if("chat_retry"==e.type){var o=e.from||e.fromid;e.type=o===nx.user.id?"chat_self":"chat";var n=t._handleMessage(e);return void t.fireEvent("chat_retry",n)}if("chat_self"==e.type){var n=t._handleMessage(e);t.fireEvent("chat_message",n)}else if("chat"==e.type){if(e.info)return void t.fireEvent("chat_error",e);var n=t._handleMessage(e);n.content.indexOf("我们已经是好友了，现在开始对话吧")>0&&t.fireEvent("chat_newfriend",n),t.fireEvent("chat_message",n)}else if(e.latestmsgs){var r=e.latestmsgs;r.sort(function(e,t){return+e.msgkey>+t.msgkey?1:+e.msgkey<+t.msgkey?-1:void 0});for(var i=r.length-1;i>=0;i--)r[i]=t._handleMessage(r[i]);t.fireEvent("chat_latestmsgs",r)}else if("http://blockstranger.talk.renren.com/blockstranger"!=e.xmlns||0!=e.blockvalue&&1!=e.blockvalue)if("http://blockstranger.talk.renren.com/blockstranger"==e.xmlns){var n={localId:e.id};t.fireEvent("setStrangeInfo",e)}else console.log("unhandled common",e);else{var n={localId:e.id,blockvalue:e.blockvalue};t.fireEvent("getStrangeInfo",e)}}},_handleCometGot:function(t){for(var n=this,o=0,r="",i=t.length,a=0;i>a;a++){var s=t[a];if(s){var c,u,l=s.content;if(-1!==l.indexOf("newsstatus")){l=l.replace(/&lt;/g,"<").replace(/&gt;/g,">"),c=(new e.XMLTree).parseXML(l).body;var d=c.newsstatus.msgkeys.text.split(","),f=c.newsstatus.msgkeys.detail?c.newsstatus.msgkeys.detail.split(","):"";if(""===f)return;return s={type:c.type,keys:d,detail:f,length:d.length,status:c.newsstatus.status},void n.fireEvent("realTime_got",s)}try{u=JSON.parse(l)}catch(p){u=null}if(!s.content||-1==s.content.indexOf('{"show":"hidden"'))if(s.touin&&u&&s.touin-0==u.from_id-0){o++;try{r+=pm.getNid(t[a])+","}catch(p){}}else switch(s.type){case"chat":s=n._handleMessage(s),n.fireEvent("message_got",s);break;case"groupchat":s=n._handleMessage(s),n.fireEvent("groupmsg_got",s);break;case"notify2":var s=JSON.parse(s.content),g=s.source?s.source.substring(0,s.source.indexOf("-")):"",m=s.source?"http://notify.renren.com/rmessage/process?type="+s.source.substring(0,s.source.indexOf("-")):"",h={type:"notify2",ntype:s.type||"",fromName:s.from_name||"",fromId:s.from_id||"",group_id:u.group_id||"",tiny_url:s.from_pic||"",ugc_content:s.ugc_content||"",callback:s.callback||"",nid:s.nid||"",source:s.source||"",feed_actor:s.feed_actor||"",feed_source:s.feed_source||"",feed_stype:s.feed_stype||"",ugc_id:s.ugc_id||"",time:s.time||"",bigtype:s.bigtype||"",rmessagecallback:s.rmessagecallback||"",count:s.count||"",showWebpager:s.showWebpager||"",isAt:s.is_at||!1,feedStypeTag:s.feed_stype_tag||"",subtype:g,processcallback:m};n.fireEvent("realTime_got",h);break;case"spam":n.fireEvent("spam_got",s);break;case"feed_status":var h={type:s.type,from:s.from,id:s.id,content:JSON.parse(s.content)};n.fireEvent("feed_status",h);break;default:n.fireEvent("other_got",s)}}}if(o)try{}catch(p){}},_handleMessage:function(e){var t=this,n=t.analyzeRichbody(e.richbody);return n.fromId=e.from||e.fromid,n.fromName=e.fname,n.type=e.type,n.time=e.time,n.msgkey=e.msgkey,n.last_msgkey=e.last_msgkey,e.groupid&&(n.groupId=e.groupid),e.to&&(n.toId=e.to),n},analyzeRichbody:function(t){var n=this,o={},r=(new e.XMLTree).parseXML(t).richbody;return r.type&&(o=n.analyzeBody[r.type](r),o.bodyType=r.type),o},analyzeBody:{dialog:function(e){var t,n,o,r;return e.font=e.font&&e.font["#text"]?e.font["#text"]:e.font,t=e.font?e.font:e.img?"[图片]":"[语音]",n=e.img?e.img:{headsrc:"",originalsrc:""},o=e.voice?e.voice:{src:"",playtime:""},r={localId:e.localid,msgType:e.type,content:t,headsrc:n.headsrc,originalsrc:n.originalsrc,audiosrc:o.src,audiotime:o.playtime,recent:t}},invitetogroup:function(e){var t,n,o;return t=e.groupinfo?e.groupinfo:{group_description:"",group_head_url:"",group_id:"",group_title:"",group_type:"",invite_desc:""},n=["群邀请"],o={localId:e.localid,msgType:e.type,content:"我是"+t.group_title+"新生群群主，邀请你加入我们。点击这里查看详细信息 http://lbsgroup.renren.com?gid="+t.group_id+" 期待你的加入~~",recent:n}},secret:function(e){var t,n,o;return t=e.img?e.img:{resourseid:""},n="[私密照片]",o={localId:e.localid,msgType:e.type,content:"这是一张私密照片",sceret:t,recent:n}},bigemj:function(e){var t,n;return t=e.emotion||"",n={localId:e.localid,msgType:e.type,recent:t,content:t}},feed_to_talk:function(e){var t,n,o;return t=e.feed_to_talk?e.feed_to_talk:{from_type:"",is_like:"",is_share:"",news_feed_id:"",news_feed_source_id:"",news_feed_type:"",news_feed_user_id:"",news_feed_user_name:"",photo_id:"",photo_url:"",title:""},n="[分享内容]",o={localId:e.localid,msgType:e.type,recent:n,content:n,feed_to_talk:t}},location:function(e){var t,n,o;return t=e.poi?e.poi:{address:"",lat:"",lon:"",mapurl:""},n="[位置]",o={localId:e.localid,msgType:e.type,recent:n,location:t,content:n}},voip:function(e){var t,n,o;return t=e.voip?e.voip:{caller:"",duration:"",from_status:"",receiver:"",to_status:"",weak_message:""},n="[语音消息]",o={localId:e.localid,msgType:e.type,voip:t,recent:n,content:"我用新版人人客户端给你打了一个免费电话，下载新版人人客户端就有机会获得各种好礼，你也来加入吧！<a href='http://mobile.renren.com' target='_blank'>http://mobile.renren.com</a>"}},icard:function(e){var t,n,o;return t=e.businesscard?e.businesscard:{headurl:"",description:"",name:"",type:"",uid:""},n=t.subtype&&"111"===t.subtype?"[新人加入]":"[名片卡]",o={localId:e.localid,msgType:e.type,icard:t,recent:n,content:n}},appmsg:function(e){var t,n,o;return t=e.appmsg?e.appmsg:{appinfo:{},newsitems:{},poi:{},feed_to_talk:{},type:"",ver:""},n="[应用分享]",o={localId:e.localid,msgType:e.type,appmsg:t,recent:n,content:n}},group_feed:function(e){var t,n,o;return t=e.group_feed?e.group_feed:{album:{},description:"",group_id:"",news_feed_id:"",news_feed_source_id:"",news_feed_type:"",news_feed_user_id:"",news_feed_user_name:""},n="[发布群动态]",o={localId:e.localid,msgType:e.type,group_feed:t,recent:n,content:n}},group_feed_comment:function(e){var t,n,o;return t=e.group_feed_comment?e.group_feed_comment:{album_id:"",description:"",group_id:"",news_feed_id:"",news_feed_source_id:"",news_feed_type:"",news_feed_user_id:"",news_feed_user_name:"",photo_url:""},n="[评论群动态]",o={localId:e.localid,msgType:e.type,group_feed:t,recent:n,content:n}},group_vote:function(e){var t,n,o,r;return t=e.group_vote?e.group_vote:{title:"",user_message:"",vote_id:"",vote_item1:"",vote_item2:"",vote_item_count:"",creator_id:"",creator_name:"",group_id:""},r=t.user_message,n="发起群投票"===r?"[发起群投票]":"结束群投票"===r?"[结束群投票]":"[参与群投票]",o={localId:e.localid,msgType:e.type,group_vote:t,recent:n,content:n}},createactivity:function(e){var t,n,o;return t=e.activity?e.activity:{id:"",location:{},subject:"",time:""},n="[创建群活动]",o={localId:e.localid,msgType:e.type,group_activity:t,recent:n,content:n}},readsecret:function(e){var t,n,o;return t=e.img?e.img:{resourseid:"",msgkey:""},n="[阅读私密照片]",o={localId:e.localid,msgType:e.type,sceret:t,content:"网页版尚不支持阅读私密照片，可到<a href='http://mobile.renren.com' target='_blank'>mobile.renren.com</a>下载最新人人手机客户端查看",recent:n}},capturesreensecret:function(e){var t,n,o;return t=e.img?e.img:{resourseid:"",msgkey:""},n="[私密照片被截屏]",o={localId:e.localid,msgType:e.type,sceret:t,content:"网页版尚不支持私密照片截屏，可到<a href='http://mobile.renren.com' target='_blank'>mobile.renren.com</a>下载最新人人手机客户端查看",recent:n}},cancelactivity:function(e){var t,n,o;return t=e.activity?e.activity:{id:"",location:{},subject:"",time:""},n="[取消群活动]",o={localId:e.localid,msgType:e.type,group_activity:t,recent:n,content:n}}}};var c=e.analyzeMsg;e.event.enableCustomEvent(e.analyzeMsg),e.CometMgr={id:0,CONN_CHECK_INTERV:500,CONN_INTERV_CYCLE:60,autoReconnect:!0,curCheckTime:0,aliveCycle:65,isLocalConn:!1,lastConnState:null,userStatus:0,browserWinId:null,hostBrowserWin:{id:null,heartbeat:null},init:function(){this.bindEvent(),this.connMonit()},isHostBrowserWin:function(){null==this.browserWinId&&(this.browserWinId=(new Date).getTime());var t=e.cookie.get("wp-win"),n={};if(null==t)return this.browserWinId=(new Date).getTime(),this.hostBrowserWin={id:this.browserWinId,heartbeat:this.browserWinId},nx.cookie.destroy("wp-win"),e.cookie.set("wp-win",this.hostBrowserWin.id+"-"+this.hostBrowserWin.heartbeat,60,!0),!0;var o=t.split("-");return n.id=o[0],n.heartbeat=o[1],this.browserWinId==n.id?(n.heartbeat=(new Date).getTime(),this.hostBrowserWin=n,nx.cookie.destroy("wp-win"),e.cookie.set("wp-win",n.id+"-"+n.heartbeat,60,!0),!0):n.id==this.hostBrowserWin.id?(new Date).getTime()-n.heartbeat>2e3?(this._robConn(),!1):(this.hostBrowserWin=n,!1):(this.hostBrowserWin=n,s.release(),!1)},tryToConnect:function(){if(n&&console.log("tryToConnect"+r()),!e.getLoginUin())return void(n&&console.log("tryToConnect1"+r()));{var t=this;location.href}s.connState()||(n&&console.log("tryToConnect2"+r()),t.hostBrowserWin={id:t.browserWinId,heartbeat:(new Date).getTime()},nx.cookie.destroy("wp-win"),e.cookie.set("wp-win",t.hostBrowserWin.id+"-"+t.hostBrowserWin.heartbeat,60,!0),t.isLocalConn=!0,s.connect())},_robConn:function(){var t=this;n&&console.log("_robConn"),e.acquire("wp-conn",function(){t.hostBrowserWin={id:t.browserWinId,heartbeat:(new Date).getTime()},nx.cookie.destroy("wp-win"),e.cookie.set("wp-win",t.hostBrowserWin.id+"-"+t.hostBrowserWin.heartbeat,60,!0),t.isLocalConn=!0,s.connect()},function(){s.release(),t.isLocalConn=!1})},retryConnect:function(){this.isLocalConn=!1,s.disconnect(),this.tryToConnect()},connMonit:function(){var t=this,n=e.getLoginUin();null==n?-1!=t.userStatus&&(t.userStatus=-1,this.fireEvent("user_logout"),s.disconnect()):n!=nx.user.id?-2!=t.userStatus&&(t.userStatus=-2,this.fireEvent("user_changed"),s.disconnect()):this.isHostBrowserWin()&&this._connMonit(),this.connTimer=setTimeout(function(){clearTimeout(t.connTimer),t.connMonit()},this.CONN_CHECK_INTERV)},_connMonit:function(){var t=this,o=(e.getLoginUin(),s.connState());0==o?(this.tryToConnect(),this.offlineCheck>5&&(-3!=t.userStatus&&(t.userStatus=-3,this.fireEvent("user_offline")),this.offlineCheck>30?s.connErrCntTryHack=20:this.offlineCheck>10&&(s.connErrCntTryHack=10)),this.offlineCheck++):(this.offlineCheck=0,0!=t.userStatus&&(t.userStatus=0,this.fireEvent("user_connected"),s.connErrCntTryHack=10,s.connErrCntTry=0,s.connErrCnt=0));try{this.curCheckTime++,this.curCheckTime==this.CONN_INTERV_CYCLE&&(n&&console.log("断开连接, 然后重连"),this.curCheckTime=0,this.retryConnect(),this.fireEvent("monit_cycle")),this.offlineCheck<5&&(this.isAlive()||(n&&console.log("isAlive, 然后重连"),this.retryConnect()))}catch(r){e.reportExpt("connMonit",r,e.cookie.get("wp-conn"))}},bindEvent:function(){var t=this;s.addEvent("comet_connected",function(){for(t.keepAlive();e.Comet.sendQueue.length>0;){var n=e.Comet.sendQueue.shift();this.send(n.m_list,n.callback)}t.fireEvent("cometmgr_connected")}),s.addEvent("comet_release",function(){t.isLocalConn=!1}),s.addEvent("comet_send_succ",function(){t.fireEvent("cometmgr_send_succ")}),s.addEvent("comet_connect_fail",function(){t.isLocalConn=!1}),s.addEvent("comet_failed",function(){t.isLocalConn=!1,t.autoReconnect=!1,t.fireEvent("comet_disconnected")}),s.addEvent("user_connected",function(){t.fireEvent("user_connected")}),s.addEvent("user_offline",function(){t.fireEvent("user_offline")}),s.addEvent("send_msg_faild",function(e){t.fireEvent("send_msg_faild",e)}),s.addEvent("send_msg_succ",function(e){t.fireEvent("send_msg_succ",e)}),s.addEvent("message",function(e){t.fireEvent("message",e)}),c.addEvent("realTime_got",function(e){t.fireEvent("realTime_got",e)}),c.addEvent("spam_got",function(e){t.fireEvent("spam_got",e)}),c.addEvent("feed_status",function(e){t.fireEvent("feed_status",e)}),c.addEvent("other_got",function(e){t.fireEvent("other_got",e)}),c.addEvent("groupmsg_got",function(e){t.fireEvent("groupmsg_got",e)}),c.addEvent("message_got",function(e){t.fireEvent("message_got",e)}),c.addEvent("chat_sr",function(e){t.fireEvent("chat_sr",e)}),c.addEvent("chat_sn",function(e){t.fireEvent("chat_sn",e)}),c.addEvent("chat_retry",function(e){t.fireEvent("chat_retry",e)}),c.addEvent("chat_message",function(e){t.fireEvent("chat_message",e)}),c.addEvent("chat_error",function(e){t.fireEvent("chat_error",e)}),c.addEvent("chat_newfriend",function(e){t.fireEvent("chat_newfriend",e)}),c.addEvent("chat_latestmsgs",function(e){t.fireEvent("chat_latestmsgs",e)}),c.addEvent("getStrangeInfo",function(e){t.fireEvent("getStrangeInfo",e)}),c.addEvent("setStrangeInfo",function(e){t.fireEvent("setStrangeInfo",e)}),c.addEvent("group_info",function(e){t.fireEvent("group_info",e)}),c.addEvent("group_inviteuser",function(e){t.fireEvent("group_inviteuser",e)
}),c.addEvent("group_name",function(e){t.fireEvent("group_name",e)}),c.addEvent("group_quititem",function(e){t.fireEvent("group_quititem",e)}),c.addEvent("group_quit",function(e){t.fireEvent("group_quit",e)}),c.addEvent("group_invite",function(e){t.fireEvent("group_invite",e)}),c.addEvent("group_inviteitem",function(e){t.fireEvent("group_inviteitem",e)}),c.addEvent("group_createitem",function(e){t.fireEvent("group_createitem",e)}),c.addEvent("group_open",function(e){t.fireEvent("group_open",e)}),c.addEvent("group_list",function(e){t.fireEvent("group_list",e)}),c.addEvent("group_item",function(e){t.fireEvent("group_item",e)}),c.addEvent("group_config",function(e){t.fireEvent("group_config",e)}),c.addEvent("group_sr",function(e){t.fireEvent("group_sr",e)}),c.addEvent("group_latestmsgs",function(e){t.fireEvent("group_latestmsgs",e)}),c.addEvent("muc_retry",function(e){t.fireEvent("muc_retry",e)}),c.addEvent("group_message",function(e){t.fireEvent("group_message",e)}),c.addEvent("group_error",function(e){t.fireEvent("group_error",e)})},send:function(t,o,r){var i=this,a=s.connState(),c=e.getLoginUin();return this.isHostBrowserWin()?a&&null!=c?void s.send(t,o,r):(n&&console.log(e.Comet.sendQueue,"保存发送信息到队列"),i.fireEvent("comet_send_succ"),void e.Comet.sendQueue.push({m_list:t,callback:o})):(i.hostBrowserWin={id:i.browserWinId,heartbeat:(new Date).getTime()},n&&console.log("在这个窗口发消息，转移host到这个窗口"),nx.cookie.destroy("wp-win"),e.cookie.set("wp-win",i.hostBrowserWin.id+"-"+i.hostBrowserWin.heartbeat,60,!0),this._robConn(),void setTimeout(function(){s.send(t,o,r)},500))},keepAlive:function(){this.curCheckTime=0,this.id=(new Date).getTime(),nx.cookie.destroy("wp-kl"),e.cookie.set("wp-kl",this.id)},isAlive:function(){var t=e.cookie.get("wp-kl");return t=parseInt(t),tNow=(new Date).getTime(),isNaN(t)?!1:tNow-t<this.aliveCycle*this.CONN_CHECK_INTERV?!0:!1},connect:function(){this.isLocalConn=!0,this._robConn(),this.userStatus=-4,s.connErrCntTryHack=10,s.connErrCntTry=0,s.connErrCnt=0},disconnect:function(){s.disconnect()},connState:function(){return s.connState()}},e.event.enableCustomEvent(e.CometMgr)}(WPC,jQuery),function(ns){ns.reportExpt=function(){},ns.PersistMgr={write_seq:0,qLen:50,timestamp:null,MONIT_INTERV:513,USER_STATUS_LOGOUT_LIMIT:3e5,USER_STATUS_HEARTBEATS:12e4,_storage:null,webpagerActions:{popupWin:"",closeWin:"",fold:!1,onShowTab:"recent",sendMode:"",setSound:"",setShield:"",setStranger:"",connect:"connected"},init:function(){var e=this,t=e._initStorage();if(!t)return t;var n=e._storage.getItemFrom("current","wp_ls");!n||n==nx.cookie("id")&&n==nx.user.id||nx.user.ruid&&0!==parseInt(nx.user.ruid)&&nx.user.id!==nx.user.ruid||e.clear();var o=e.getItemFrom("user_status","wp_ls");o&&(new Date).getTime()-o>e.USER_STATUS_LOGOUT_LIMIT&&e.clear(),e._storage.setItemTo("current",ns.getLoginUin(),"wp_ls"),e._initWebpagerAction(),e._userStatusMonit();var r=e._getLastModFromLocalStorage();return e.timestamp=r.timestamp,e._storageMonit(),t},_initStorage:function(){var e=this,t=!0;return window.localStorage?e._storage=e.localStorage:(e._storage=e.userDataStorage,e._storage.init(),t=e._storage.isAvailable()),t},_initWebpagerAction:function(){var e=this;e.webpagerActions.popupWin=e.getItemFrom("popup_win","act")||"",e.webpagerActions.closeWin=e.getItemFrom("close_win","act")||"",e.webpagerActions.fold=e.getItemFrom("fold","act")||!1,e.webpagerActions.onShowTab=e.getItemFrom("show_tab","act")||"recent",e.webpagerActions.sendMode=e.getItemFrom("send_mode","act")||"",e.webpagerActions.setSound=e.getItemFrom("set_sound","act")||"",e.webpagerActions.setShield=e.getItemFrom("set_shield","act")||"",e.webpagerActions.setStranger=e.getItemFrom("set_stranger","act")||""},setItemTo:function(e,t,n,o){var r=this;o=o===!1?!1:!0,n="undefined"==typeof n?"wp_com":n,"string"!=typeof t&&(t=JSON.stringify(t));try{if(r._storage||r.initStorage(),"act"==n)switch(e){case"popup_win":r.webpagerActions.popupWin=t;break;case"close_win":r.webpagerActions.closeWin=t;break;case"fold":r.webpagerActions.fold=t;break;case"show_tab":r.webpagerActions.onShowTab=t;break;case"send_mode":r.webpagerActions.sendMode=t;break;case"set_sound":r.webpagerActions.setSound=t;break;case"set_shield":r.webpagerActions.setShield=t;break;case"set_stranger":r.webpagerActions.setStranger=t;break;case"connect":r.webpagerActions.connect=t}var i=r._storage.setItemTo(e,t,nx.user.id+n);return o||(r._getStorageChange(),r._setLastMod(n+"."+e)),i}catch(a){return ns.reportExpt("setItemTo",a,e+"="+t),!1}},removeItem:function(e,t){var n=this;n._storage||n.initStorage(),n._storage.removeItem(nx.user.id+e,t)},getItemFrom:function(e,t){var n=this;t="undefined"==typeof t?"wp_com":t;try{n._storage||n.initStorage();var o=n._storage.getItemFrom(e,nx.user.id+t);return o}catch(r){return ns.reportExpt("getItemFrom",r,e+"="+t),""}},clear:function(){this._storage.clear()},_setLastMod:function(e,t){var n=this._getLastModFromLocalStorage(),o=this.qLen,r=(new Date).getTime();try{var i={keys:n.keys.split(","),lastKeys:n.keys,timestamp:r};i.keys.length>o&&(i.keys.length=o);var a=this._storage.getItemFrom("lastPos","wp_ctrl")||0;a=(parseInt(a)+1)%this.qLen,i.keys[a]=e,this.timestamp=i.timestamp;var s=this._lastModToStr(i)}catch(c){return void ns.reportExpt("_setLastMod",c,n.keys)}var u=this._storage.getItemFrom("last"+(a>9?a:"0"+a),"wp_ctrl");if(u){var l=u.replace(/^(\d)* /gim,"").split(".");this._storage.removeItem(""+nx.user.id+l[0],l[1])}this._storage.setItemTo("last"+(a>9?a:"0"+a),r+" "+e,"wp_ctrl"),this._storage.setItemTo("lastMod",s,"wp_ctrl",t),this._storage.setItemTo("lastPos",a,"wp_ctrl")},_lastModToStr:function(e){return e.timestamp+"|"+e.keys.join(",")},_getLastModFromLocalStorage:function(){var e=this._storage.getItemFrom("lastMod","wp_ctrl"),t={timestamp:(new Date).getTime(),keys:"",keysAry:[]};try{if(e){var n=e.split("|");n&&(t.timestamp=n[0],t.keys=n[1]||"",t.keysAry=n[1]?n[1].split(","):[])}}catch(o){ns.reportExpt("_getLastModFromLocalStorage",o,e)}return t},_getNewKeys:function(e,t){for(var n,o=[],r=[],i=0;i<this.qLen;i++)n=this._storage.getItemFrom("last"+(i>9?i:"0"+i),"wp_ctrl"),n&&(n=this._getLastObj(n),n.timestamp>e&&n.timestamp<=t&&o.push(n));o.sort(function(e,t){return e.timestamp>t.timestamp});for(var a=0;a<o.length;a++)r.push(o[a].key);return r},_getLastObj:function(e){var t=e.split(" ");return{timestamp:parseInt(t[0]),key:t[1]}},_getStorageChange:function(){var e=this,t=e._getLastModFromLocalStorage(),n=e.timestamp,o=t.timestamp;if(n!=o)try{var r=(t.keys.split(","),e._getNewKeys(n,o));if(r&&r.length>0){var i={keys_raw:r.join(","),keys:ns.distinct(r).join(",")};setTimeout(function(){e.fireEvent("storage",i)},1)}e.timestamp=o}catch(a){ns.reportExpt("_storageMonit",a,t.keys)}},_storageMonit:function(){var e=this;e._actionMonit(),e._getStorageChange(),this.monitTimer=setTimeout(function(){e._storageMonit()},this.MONIT_INTERV)},_userStatusMonit:function(){var e=this;e.setItemTo("user_status",(new Date).getTime(),"wp_ls",!0),setTimeout(function(){var t=e.getItemFrom("fold","act");nx.cookie("wp_fold","fold"==t?1:0,{domain:".renren.com",path:"/"}),e._userStatusMonit()},e.USER_STATUS_HEARTBEATS)},_actionMonit:function(){var e=this,t=e.getItemFrom("popup_win","act");e.webpagerActions.popupWin!=t&&(e.webpagerActions.popupWin=t,t&&(t=JSON.parse(t),setTimeout(function(){e.fireEvent("act_popup_win",t)},1)));var n=e.getItemFrom("close_win","act");e.webpagerActions.closeWin!=n&&(e.webpagerActions.closeWin=n,n&&(n=JSON.parse(n),setTimeout(function(){e.fireEvent("act_close_win",n)},1)));var o=e.getItemFrom("show_tab","act");e.webpagerActions.onShowTab!=o&&(e.webpagerActions.onShowTab=o,setTimeout(function(){e.fireEvent("act_show_tab",o)},1));var r=e.getItemFrom("fold","act");null===r&&(r=!1),e.webpagerActions.fold!=r&&(e.webpagerActions.fold=r,setTimeout(function(){e.fireEvent("act_fold","fold"==r)},1));var i=e.getItemFrom("send_mode","act");e.webpagerActions.sendMode!=i&&(e.webpagerActions.sendMode=i,setTimeout(function(){e.fireEvent("act_send_mode",i)},1));var a=e.getItemFrom("set_sound","act");e.webpagerActions.setSound!=a&&(e.webpagerActions.setSound=a,setTimeout(function(){e.fireEvent("act_set_sound",a)},1));var s=e.getItemFrom("set_shield","act");e.webpagerActions.setShield!=s&&(e.webpagerActions.setShield=s,setTimeout(function(){e.fireEvent("act_set_shield",s)},1));var c=e.getItemFrom("set_stranger","act");e.webpagerActions.setStranger!=c&&(e.webpagerActions.setStranger=c,setTimeout(function(){e.fireEvent("act_set_stranger",c)},1));var u=e.getItemFrom("connect","act");e.webpagerActions.connect!=u&&(e.webpagerActions.connect=u,setTimeout(function(){e.fireEvent("act_connect",u)},1))},getNid:function(m){var nid=null;if(m)try{var obj=eval("("+m.content+")");obj&&obj.nid&&(nid=obj.nid)}catch(e){}return nid},localStorage:{setItemTo:function(e,t,n){try{localStorage.setItem(n+"_"+e,t)}catch(o){return ns.reportExpt("w3cStorage_set",o,e+"="+t),!1}return!0},getItemFrom:function(e,t){try{return localStorage.getItem(t+"_"+e)}catch(n){return ns.reportExpt("w3cStorage_get",n,e),""}},removeItem:function(e,t){localStorage.removeItem(e+"_"+t)},clear:function(){localStorage.clear()},save:function(){}},userDataStorage:{nodeList:[],getItemFrom:function(e,t){for(var n=null,o=this.nodeList.length-1;o>=0;o--){var r=this.nodeList[o];r.zone==t&&(n=r.obj)}return n?this.get(n,t,e):(n=this.createStorgeNode(t),this.get(n,t,e))},setItemTo:function(e,t,n,o){for(var r=null,i=this.nodeList.length-1;i>=0;i--){var a=this.nodeList[i];a.zone==n&&(r=a.obj)}return r?this.set(r,n,e,t,o):(r=this.createStorgeNode(n),this.set(r,n,e,t,o))},removeItem:function(e,t){for(var n=null,o=this.nodeList.length-1;o>=0;o--){var r=this.nodeList[o];r.zone==e&&(n=r.obj)}n&&(n.removeAttribute(t),n.save(e))},clear:function(){try{for(var e=this.nodeList.length-1;e>=0;e--){var t=this.nodeList[e],n=t.obj;n.load(t.zone);var o=new Date;o=new Date(o.getTime()-1),n.expires=o.toUTCString(),n.save(t.zone)}}catch(r){ns.reportExpt("clearStorage",r)}this.init()},isAvailable:function(){try{this.createStorgeNode("test");for(var e=this.nodeList.length-1;e>=0;e--){var t=this.nodeList[e];if("test"==t.zone){var n=t.obj;n.setAttribute("key","value"),n.save("test"),n.load(t.zone);var o=new Date;o=new Date(o.getTime()-1),n.expires=o.toUTCString(),n.save(t.zone),n.removeBehavior(t.bid)}}return!0}catch(r){return r.number&&2146827838==Math.abs(parseInt(r.number))?!0:!r.description||-1==r.description.indexOf("Wrong number")&&-1==r.description.indexOf("错误的参数个数")?(ns.PersistMgr._retry_flag||(setTimeout(function(){ns.PersistMgr.init()}),ns.PersistMgr._retry_flag=1),ns.PersistMgr._retry_flag,ns.reportExpt("userDataCheck",r,""),!1):!0}},save:function(){},init:function(){nx.browser.msie||ns.reportExpt("noLocalStorage",new Error("标准浏览器,怎么也选用userData实现呢???"),ns.browser.type)},createStorgeNode:function(e){var t=document.createElement("input");t.style.display="none";var n=t.addBehavior("#default#userData");return document.body.appendChild(t),this.nodeList.push({obj:t,bid:n,zone:e}),t},set:function(e,t,n,o,r){try{e.setAttribute(n,o),e.save(t),r!==!1&&e.save(t)}catch(i){return ns.reportExpt("userData_set",i,n+"="+o),!1}return!0},get:function(e,t,n){try{return e.load(t),e.getAttribute(n)}catch(o){return ns.reportExpt("userData_get",o,t+n),""}}}},ns.event.enableCustomEvent(ns.PersistMgr)}(WPC),define("message/webAPI",function(require,e){var t=require("jquery"),n=WPC.CometMgr,o={502:{n:3,tag:"status",text:"状态"},503:{n:3,tag:"status",text:"被动with"},505:{n:3,tag:"status",text:"分享状态"},701:{n:1,tag:"photo",text:"照片"},708:{n:1,tag:"photo",text:"照片"},709:{n:1,tag:"album",text:"相册"},102:{n:4,tag:"share",text:"分享"},103:{n:4,tag:"share",text:"分享"},104:{n:4,tag:"share",text:"分享"},107:{n:4,tag:"share",text:"分享"},110:{n:4,tag:"share",text:"分享"},5030:{n:4,tag:"share",text:"分享"},2003:{n:4,tag:"share",text:"分享"},2004:{n:4,tag:"share",text:"分享"},209:{n:25,tag:"group",text:"小组"},601:{n:0,tag:"blog",text:"日志"},801:{n:17,tag:"gift",text:"礼物回复",ico:"wp-gift-ico"},8301:{n:20,tag:"gift",text:"礼物"},8302:{n:21,tag:"gift",text:"礼物"},807:{n:17,tag:"gift",text:"礼物"},808:{n:17,tag:"gift",text:"礼物"},2008:{n:3,tag:"status",text:"状态"}},r=function(e,n,o,r){var i=t.ajax({url:e,type:"GET",dataType:"json",data:n,cache:!1,success:function(e){o&&"function"==typeof o&&o(e)},error:function(){r&&"function"==typeof r&&r()}});return i},i=function(e,n,o,r){var i=t.ajax({url:e,type:"post",dataType:"json",data:n,cache:!1,success:function(e){o&&"function"==typeof o&&o(e)},error:function(){r&&"function"==typeof r&&r()}});return i};e.webAPI={sendMessage:function(e,t,o,r){n.send(e,t,o,r)},setStrangeInfo:function(e,t){var n=['<iq id="',+new Date,'"  type="set">\n','<query xmlns="http://blockstranger.talk.renren.com/blockstranger">\n',"<blockvalue>",e,"</blockvalue>\n","</query>\n","</iq>\n\x00"].join("");this.sendMessage(n,t)},getStrangeInfo:function(e){var t=['<iq id="',+new Date,'"  type="get">\n','   <query xmlns="http://blockstranger.talk.renren.com/blockstranger" />\n',"</iq>\n\x00"].join("");this.sendMessage(t,e)},delMsg:function(e,t,n){var o=e.id,r=e.msgkey,i=0==e.type?"http://chat.talk.renren.com/delmsg":"http://muc.talk.renren.com/delmsg",a=['<iq id="',(new Date).getTime(),'" type="set">\n','<query xmlns="',i,'">\n','<delmsg id="',o,'" msgkey="',r,'"/>\n',"</query>\n","</iq>\n\x00"].join("");this.sendMessage(a,t,n)},sendMsg:function(e,t,n){var o=nx.user.name,r=nx.user.id,i=e.localId,a=e.toId,s=e.type,c="";if(a>=630000001&&639999999>=a&&(c=' subtype = "1000" '),"chat"==s)var u=['<message fname="',o,'" from="',r,'@talk.m.renren.com" to="',a,'@talk.m.renren.com" type="chat"',c,">\n",'<richbody type="dialog" localid="',i,'">\n',"<font>",e.content,"</font>\n","</richbody>\n","</message>\n\x00"].join("");else var u=['<message fname="',o,'" from="',r,'@muc.talk.renren.com" to="',a,'@muc.talk.renren.com" type="muc">\n','   <richbody type="dialog" localid="',i,'"><font>',e.content,"</font></richbody>\n","</message>\n\x00"].join("");this.sendMessage(u,t,n,{id:a,type:s,localId:i})},sendPic:function(e,t,n){var o=nx.user.name,r=nx.user.id,i=e.localId,a=e.toId,s=e.pic,c=e.type,u="";if(a>=630000001&&639999999>=a&&(u=' subtype = "1000" '),"chat"==c)var l=['<message fname="',o,'" from="',r,'@talk.m.renren.com" to="',a,'@talk.m.renren.com" type="chat"',u,">\n",'<richbody type="dialog" localid="',i,'">\n','<img headsrc="',s.headsrc,'"  originalsrc="',s.originalsrc,'" />\n',"</richbody>\n","</message>\n\x00"].join("");else var l=['<message fname="',o,'" from="',r,'@muc.talk.m.renren.com" to="',a,'@muc.talk.renren.com" type="muc">\n','<richbody type="dialog" localid="',i,'">','<img headsrc="',s.headsrc,'"  originalsrc="',s.originalsrc,'" />',"</richbody>\n","</message>\n\x00"].join("");this.sendMessage(l,t,n,{id:a,type:c,localId:i})},sendReport:function(e,t){var n="muc"==e.type?e.groupId:e.fromId==nx.user.id?e.toId:e.fromId,o='<ack from="'+nx.user.id+'" to="'+n+'" msgkey="'+(e.msgkey||e.msgKey)+'" type="dr" chat_type="'+e.type+'"/>\n\x00';this.sendMessage(o,t)},sendRead:function(e,n,o){if("notify2"!=e.type){var r="muc"==e.type||1==e.type?e.groupId:e.fromId==nx.user.id?e.toId:e.fromId;r=e.to?e.to:r;var i="muc"==e.type||1==e.type?"muc":"chat",a=['<ack from="',nx.user.id,'" to="',r,'" msgkey="',e.msgkey||e.msgKey,'" type="rr" chat_type="',i,'" ext_flag="',n,'"/>\n\x00'].join("");this.sendMessage(a,o)}else if(e.rmessagecallback){var s=document.createElement("div");if(s.innerHTML=e.rmessagecallback,s.innerText)var c=s.innerText;else var c=s.textContent;return c=c.replace(/\/remove\?/,"/process?"),void t.getJSON(c)}},createDiscussion:function(e,n,o,r){var i=[];t.each(e,function(t){i.push("        <member>"+e[t]+"</member>\n")});var a=['<iq id="'+o+'" type="set">\n','   <query xmlns="http://muc.talk.renren.com/create">\n','       <item name="',n,'" >\n',i.join(""),"       </item>\n","   </query>\n","</iq>\n\x00"].join("");this.sendMessage(a,r)},quitDiscussion:function(e,t){var n=['<iq id="123121" to="',e,'@muc.talk.renren.com" type="set">\n','   <query xmlns="http://muc.talk.renren.com/quit"/>\n',"</iq>\n\x00"].join("");this.sendMessage(n,t)},htmlFilter:function(e){return e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")},modifyDiscussionName:function(e,t,n){var o=['<iq id="create3" to="',e,'@muc.talk.renren.com" type="set">\n','   <query xmlns="http://muc.talk.renren.com/config">\n',"       <name>",this.htmlFilter(t),"</name>\n","   </query>\n","</iq>\n\x00"].join("");this.sendMessage(o,n)},addDiscussionMember:function(e,n,o){var r=[];t.each(n,function(e){r.push("        <member>"+n[e]+"</member>\n")});var i=['<iq id="1" to="',e,'@muc.talk.renren.com">\n','   <query xmlns="http://muc.talk.renren.com/invite">\n',r.join(""),"   </query>\n","</iq>\n\x00"].join("");this.sendMessage(i,o)},requestLastMsgs:function(e,t,n){var o=['<iq id="',e,'" type="get">\n','<query xmlns="http://',t,'.talk.renren.com/latestmsgs">\n','<item id="',e,'" lmax_msgid="0" count="10"/>\n',"</query>\n","</iq>\n\x00"].join("");this.sendMessage(o,n)},inviteMember:function(e,n,o,r,i){var a=this;n.length>0&&t.each(n,function(t){var s=['<message fname="',nx.user.name,'" from="',nx.user.id,'@talk.m.renren.com" to="',n[t],'@talk.m.renren.com" type="chat">\n','   <richbody type="invitetogroup" localid="0',(new Date).getTime(),'" >\n','  <groupinfo invite_desc="邀请你加入这个好玩的群" group_id="',e,'" group_type="100" group_title="',o,'" group_description="',r,'" group_head_url="',i,'" />\n',"   </richbody>\n","</message>\n\x00"].join("");a.sendMessage(s)})},groupsEasyInfo:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://webpager.renren.com/api/groupEasyInfo",{gids:e.join(",")},function(e){0==e.code?n(e):o(e)},function(){o()})},groupsInfo:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://webpager.renren.com/api/groupInfo",{gids:e.join(",")},function(e){0==e.code?n(e):o(e)},function(){o()})},getJoinedGroup:function(e,n,o,i){o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://webpager.renren.com/api/userGroup",{st:e,lt:n},function(e){0==e.code?o(e):i(e)},function(){i()})},transferGroup:function(e,n,o,i){o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://lbsgroup.renren.com/admin/transferGroup",{id:e,uid:n},function(e){1==e.status.code||0==e.status.code?o(e):i(e)},function(){i()})},setGroupNotify:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://lbsgroup.renren.com/group/setNotify",e,function(e){1==e.status.code||0==e.status.code?n(e):o(e)},function(){o()})},modifyGroupInfo:function(e,n,o,i,a){i="function"==typeof i?i:t.noop,a="function"==typeof a?a:t.noop,r("http://lbsgroup.renren.com/group/editGroupInfo",{id:e,name:n,summary:o},function(e){1==e.status.code||0==e.status.code?i(e):a(e)},function(){a()})},removeGroupMember:function(e,n,o,r){o="function"==typeof o?o:t.noop,r="function"==typeof r?r:t.noop,i("http://lbsgroup.renren.com/admin/removeMembers",{id:e,uids:n.join(",")},function(e){1==e.status.code||0==e.status.code?o(e):r(e)},function(){r()})},exitGroup:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://lbsgroup.renren.com/member/exitGroup",{id:e},function(e){1==e.status.code||0==e.status.code?n(e):o(e)},function(){o()})},getUserInfo:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://webpager.renren.com/api/getUserInfo",{uids:e.join(",")},function(e){0==e.code?n(e):o(e)},function(){o()})},getFriendsInfo:function(e,n,o,i){o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://webpager.renren.com/api/getFriendsInfo",{st:e,lt:n},function(e){0==e.code?o(e):i(e)},function(){i()})},getAccountsListInfo:function(e,n,o,i){var a=this;o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://webpager.renren.com/api/attentionAccounts",{userId:nx.user.id,pageSize:n,curPage:e,serviceType:0},function(t){return null==t.data.items[0]?void a.getAccountsListInfo(e,n,o,i):void o(t)},function(){i()})},getAccountInfo:function(e,n,o){o="function"==typeof o?o:t.noop,onerror="function"==typeof onerror?onerror:t.noop,r("http://webpager.renren.com/api/getPublicAccountInfo",{userId:n,accountId:e},function(e){o(e)},function(){onerror()})},followPublicAccount:function(e,n,o){o="function"==typeof o?o:t.noop,onerror="function"==typeof onerror?onerror:t.noop,i("http://webpager.renren.com/api/followPublicAccount",{accountId:e,userId:n},function(e){o(e)},function(){onerror()})},unfollowPublicAccount:function(e,n,o){o="function"==typeof o?o:t.noop,onerror="function"==typeof onerror?onerror:t.noop,i("http://webpager.renren.com/api/unFollowPublicAccount",{accountId:e,userId:n},function(e){o(e)},function(){onerror()})},getHistory:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop;r("http://webpager.renren.com/api/getChatList",e,function(e){0==e.code||1==e.code?n(e):o(e)},function(){o()})},getApplyList:function(e,n){n="function"==typeof n?n:t.noop,r("http://notify.renren.com/rmessage/getallmessage",e,function(t){0==t.code?(t.data.more=t.data.total>=e.st+e.lt,n(t)):onerror(t)},function(){onerror()})},getCommonFriends:function(e,n){n="function"==typeof n?n:t.noop;t.getJSON("http://friend.renren.com/j_f_cfb?guests="+e,function(e){n(e)})},getNoticeCombine:function(e,n,o,i){var a={st:e,lt:n,view:18};o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://notify.renren.com/rmessage/getcombine",a,function(e){0==e.code?(e.data.more=e.data.total>=a.st+a.lt,o(e)):i(e)},function(){i()})},getNotice:function(e,n,o,i){var a={bigtype:"4|3",st:e,lt:n,view:18};o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://notify.renren.com/rmessage/getunreadcombine",a,function(e){0==e.code?o(e):i(e)},function(){i()})},getNextNotice:function(e,n,o){var i={bigtype:"4|3",st:1,lt:100,nid:e,view:18};n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://notify.renren.com/rmessage/getafternid",i,function(e){0==e.code?n(e):o(e)},function(){o()})},getRemind:function(e,n,o,i){var a={bigtype:1,st:e,lt:n,view:18};o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://notify.renren.com/rmessage/getallmessage",a,function(e){0==e.code?o(e):i(e)},function(){i()})},getNextRemind:function(e,n,o){var i={bigtype:1,st:1,lt:100,nid:e,view:18};n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,r("http://notify.renren.com/rmessage/getafternid",i,function(e){0==e.code?n(e):o(e)},function(){o()})},loadUGCHistory:function(e,n,i,a,s){var e,c=o[e.stype].n,u=o[e.stype].tag;switch(a="function"==typeof a?a:t.noop,s="function"==typeof s?s:t.noop,u){case"status":case"photo":case"blog":case"album":case"share":e={entryId:e.source,entryOwnerId:e.actor,type:u,limit:20,offset:n,desc:!0},r("http://comment.renren.com/comment/xoa2",e,function(e){var t={};t.replyList=[];for(var n=0;n<e.comments.length;n++){var o={};o.replyer_tinyurl=e.comments[n].authorHeadUrl,o.replyTime=e.comments[n].time,o.ubid=e.comments[n].authorId,o.ubname=e.comments[n].authorName,o.replyContent=e.comments[n].content,t.replyList.push(o),t.more=e.hasMore}0==e.code?a(t):s(t)},function(){s()});break;default:e={doingId:e.source,owner:e.actor,source:e.source,t:c},r("http://status.renren.com/feedcommentretrieve.do",e,function(e){0==e.code?a(e):s(e)},function(){s()})}},getUgcInfo:function(e,n,r){n="function"==typeof n?n:t.noop,r="function"==typeof r?r:t.noop;var i=parseInt(e.stype);switch(i){case 801:case 8301:case 807:case 808:var a=o[e.stype].n,s={isDiy:!1,recordId:e.source,userId:e.actor,feed_actor:e.actor,feed_source:e.source,feed_stype:e.stype,feed_ntype:a};t.ajax({url:"http://gift.renren.com/show/giftbox/recordInfoForRealTime",type:"post",data:s,dataType:"html",success:function(e){var t=e.substring(6,e.indexOf("[/Data]")),o=JSON.parse(t);0==o.code?(o.type="gift","object"==typeof o.topic.image&&(o.topic.image=o.topic.image[0].image),n(o)):r(e)}});break;case 209:{var s={forumId:e.group_id,threadId:e.source};t.getJSON("http://xiaozu.renren.com/xiaozu/getthreadjson",s,function(t){t.type=o[e.stype].tag,n(t)})}break;case 502:case 503:case 505:case 2008:{var s={ownerId:e.actor,statusId:e.source};t.getJSON("http://webpager.renren.com/api/realtimeUGC/getStatus",s,function(t){t.type=o[e.stype].tag,n("ok"==t.result?t.data:t)})}break;case 701:case 708:{var s={ownerId:e.actor,photoId:e.source};t.getJSON("http://webpager.renren.com/api/realtimeUGC/getPhoto",s,function(t){t.type=o[e.stype].tag,n("ok"==t.result?t.data:t)})}break;case 709:{var s={ownerId:e.actor,albumId:e.source};t.getJSON("http://webpager.renren.com/api/realtimeUGC/getAlbum",s,function(t){t.type=o[e.stype].tag,n("ok"==t.result?t.data:t)})}break;case 601:{var s={ownerId:e.actor,blogId:e.source};t.getJSON("http://webpager.renren.com/api/realtimeUGC/getBlog",s,function(t){t.type=o[e.stype].tag,n("ok"==t.result?t.data:t)})}break;case 102:case 103:case 104:case 2004:{var s={ownerId:e.actor,shareId:e.source};t.getJSON("http://webpager.renren.com/api/realtimeUGC/getShare",s,function(t){t.type=o[e.stype].tag,n("ok"==t.result?t.data:t)})}break;default:{t.getJSON("http://notify.renren.com/get2.feed",e,function(t){t.type=o[e.stype].tag,n(t)})}}},ugcRealQuit:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop;{var r="groups="+e.source+"-"+e.stype+"-"+e.actor;t.ajax({url:"http://notify.renren.com/quitchat.notify?"+r,type:"post",dataType:"json",success:function(e){0==e?n(e):o(e)}})}},ugcItemRemove:function(e,n,o){o="function"==typeof o?o:t.noop;t.getJSON(e,"",function(e){0==e?o(e):onerror(e)})},processRemindNotice:function(e,n,o){o="function"==typeof o?o:t.noop;t.getJSON(e,"",function(e){0==e?o(e):onerror(e)})},sendUgcReply:function(e,n,r){n="function"==typeof n?n:t.noop,r="function"==typeof r?r:t.noop;var i,a=e.ugcInfo.feedType,s=e.ugcInfo.stype;switch(a){case"status":case"photo":case"blog":case"share":i={content:e.content,type:a,entryId:e.ugcInfo.source,entryOwnerId:e.ugcInfo.actor,replyTo:e.replyTo||"",whisper:0},t.ajax({url:"http://comment.renren.com/comment/xoa2/create",type:"post",data:i,dataType:"json",success:function(e){0==e.code?n(e):r(e)}});break;case"album":i={content:e.content,type:a,entryId:e.ugcInfo.source,entryOwnerId:e.ugcInfo.actor,replyTo:e.replyTo||"",whisper:0,isLinked:!0},t.ajax({url:"http://comment.renren.com/comment/xoa2/create",type:"post",data:i,dataType:"json",success:function(e){0==e.code?n(e):r(e)}});break;default:i={c:e.content,t:o[e.ugcInfo.stype].n,source:e.ugcInfo.source,owner:e.ugcInfo.actor,replyName:e.replyName||"",replyTo:e.replyTo||"",secondaryReplyId:e.fromId||"",isWhisper:!1};var c=502==s?"&nfrom=0101011010000":"";t.ajax({url:"http://status.renren.com/feedcommentreply.do?from=wp&fromu="+e.fromId+"&tou="+i.replyTo+"&source="+i.source+"&fowner="+i.owner+"&t="+i.t+"&stype="+s+c,type:"post",data:i,dataType:"json",success:function(e){0==e.code||1031==e.code||1030==e.code?n(e):r(e)}})}},getRecent:function(e,n){e="function"==typeof e?e:t.noop,n="function"==typeof n?n:t.noop,r("http://webpager.renren.com/api/getRecent",{},function(t){0==t.code?e(t):n(t)},function(){n()})},deleteRecent:function(e,n,o,r){o="function"==typeof o?o:t.noop,r="function"==typeof r?r:t.noop;{var i={ownerId:nx.user.id,targetId:e,chatType:"muc"==n?2:1};t.getJSON("http://webpager.renren.com/api/deleteRecent",i,function(e){0==e.code?o(e):r(e)})}},sendUserAgent:function(e,t){i("http://admin.renren.com/webservice/customerservice/send",e,function(e){t(e)})},setSendMethod:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop;{var r=e?"true":"false";t.getJSON("http://webpager.renren.com/api/settings/setSendMethod?isEnterSend="+r,function(e){0==e.code?n(e):o(e)})}},settingSetshield:function(e,n,o){switch(n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop,e.flag){case 1:{i("http://webpager.renren.com/api/settings/setshield",e,function(e){n(e)})}break;case 2:var r=0==e.receive?"http://webpager.renren.com/api/settings/blockugc/add":"http://webpager.renren.com/api/settings/blockugc/del";t.ajax({url:r,type:"get",data:{ugcId:e.targetId},dataType:"json",success:function(e){0==e.code?n(e):o(e)}})}},setBeep:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop;{var r=e?"true":"false";t.getJSON("http://webpager.renren.com/api/settings/setBeep?isBeep="+r,function(e){0==e.code?n(e):o(e)})}},setBlockStranger:function(e,n,o){n="function"==typeof n?n:t.noop,o="function"==typeof o?o:t.noop;{var r=e?"true":"false";t.getJSON("http://webpager.renren.com/api/settings/setBlockStranger?isBlockStranger="+r,function(e){0==e.code?n(e):o(e)})}},isStranger:function(e,n){n="function"==typeof n?n:t.noop;t.getJSON("http://friend.renren.com/friends/api/getrelation?gid="+e,function(e){var t={code:0,msg:"操作成功",isFriend:e};n(t)})},searchPeople:function(e,n,o,i,a){i="function"==typeof i?i:t.noop,a="function"==typeof a?a:t.noop;var s={kw:e,st:n,lt:o},c=r("http://friend.renren.com/friends/api/searchfriendsbywebpage",s,function(e){0==e.code?i(e):a(e)},function(){a()});return c},searchAll:function(e,n,o,i,a){i="function"==typeof i?i:t.noop,a="function"==typeof a?a:t.noop;var s={kw:e,st:n,lt:o},c=r("http://friend.renren.com/friends/api/searchrelationbywebpage",s,function(e){0==e.code?i(e):a(e)},function(){a()});return c},loadSound:function(){var e="http://a.xnimg.cn/nx/webpager/res/wpsound.swf",t='<object width="10" height="10" id="webpagersound" type="application/x-shockwave-flash" data="'+e+'"><param name="flashvars" value="soundUrl=http://a.xnimg.cn/nx/webpager/res/msg.mp3"><param name="allowScriptAccess" value="always" /><param name="movie" value="'+e+'" /><param name="scale" value="noscale" /><param name="salign" value="lt" /></object>',n=document.createElement("div");n.innerHTML=t,document.body.appendChild(n)},playSound:function(){var e=document.getElementById("webpagersound");e||(this.loadSound(),e=document.getElementById("webpagersound")),e.playMessageSound&&e.playMessageSound()},getLastRecent:function(e,n,o,i){o="function"==typeof o?o:t.noop,i="function"==typeof i?i:t.noop,r("http://webpager.renren.com/api/getlastrecent",{ids:e.join(","),type:n},function(e){0==e.code?o(e):i(e)},function(){i()})}}}),define("util/util",function(require,e){e.init=function(){},e={htmlFilter:function(e){return e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")}}}),define("message/index",function(require,e){var t=(require("jquery"),require("message/webAPI"));e.webAPI=t.webAPI,e.storage=WPC.PersistMgr,e.messager=WPC.CometMgr,e.report=WPC.report,e.init=function(){WPC.CometMgr.init(),WPC.PersistMgr.init(),WPC.CometMgr.addEvent("group_message",function(e){t.webAPI.sendReport(e,function(){})}),WPC.CometMgr.addEvent("chat_message",function(e){t.webAPI.sendReport(e,function(){})})}});